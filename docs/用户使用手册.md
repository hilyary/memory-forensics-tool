# 析镜 LensAnalysis - 用户使用手册

> 基于Volatility 3的图形化内存取证工具

## 目录

1. [快速开始](#1-快速开始)
2. [界面介绍](#2-界面介绍)
3. [镜像管理](#3-镜像管理)
4. [符号表管理](#4-符号表管理)
5. [插件分析](#5-插件分析)
6. [CTF工具](#6-ctf工具)
7. [报告导出](#7-报告导出)
8. [代理设置](#8-代理设置)
9. [常见问题](#9-常见问题)

---

## 1. 快速开始

### 1.1 启动应用

```bash
# 进入项目目录
cd LensAnalysis

# 启动应用
python main.py
```

### 1.2 首次使用流程

1. **启动应用** - 运行 `python main.py`
2. **加载镜像** - 点击"加载镜像"按钮选择内存镜像文件
3. **选择系统类型** - 自动检测或手动选择（Windows/Linux/macOS）
4. **安装符号表** - 如有提示，安装对应系统的符号表
5. **开始分析** - 使用左侧功能菜单执行各项分析

![应用主界面](screenshots/main_screen.png)
*图1：应用主界面*

---

## 2. 界面介绍

### 2.1 主界面布局

```
┌─────────────────────────────────────────────────┐
│  析镜 LensAnalysis          [导出报告] [设置]  │
├──────────┬──────────────────────────────────────┤
│          │                                      │
│  左侧栏  │          主内容区域                  │
│          │                                      │
│  - 镜像  │  [分析结果显示区域]                   │
│  - 插件  │                                      │
│  - CTF   │                                      │
│  - 工具  │                                      │
│          │                                      │
└──────────┴──────────────────────────────────────┘
```

### 2.2 左侧功能菜单

| 分类 | 功能 | 说明 |
|------|------|------|
| **镜像管理** | 镜像信息 | 查看当前加载的镜像信息 |
| | 加载镜像 | 加载新的内存镜像文件 |
| **Windows分析** | 进程列表 | 查看所有运行的进程 |
| | 进程树 | 以树形结构显示进程关系 |
| | 进程扫描 | 扫描隐藏/终止的进程 |
| | DLL列表 | 查看进程加载的DLL |
| | 句柄列表 | 查看进程打开的句柄 |
| | 命令行参数 | 查看进程命令行 |
| | 网络连接 | 查看网络连接（含时间戳）|
| | 注册表配置单元 | 列出注册表配置单元 |
| | 恶意代码查找 | 查找注入的代码 |
| | 密码哈希转储 | 提取Windows密码哈希 |
| **Linux分析** | 进程列表 | 查看Linux进程 |
| | Bash历史 | 查看Bash命令历史 |
| | 打开文件列表 | 查看进程打开的文件 |
| | 内核模块 | 查看已加载的内核模块 |
| **macOS分析** | 进程列表 | 查看macOS进程 |
| | 网络状态 | 查看网络连接 |
| | 内核扩展 | 查看Kext信息 |
| | 打开文件 | 查看文件描述符 |
| **CTF工具** | Flag搜索 | 自动搜索CTF Flag |
| | 正则搜索 | 自定义正则表达式搜索 |
| | 字符串提取 | 提取可打印字符串 |
| **符号表管理** | 符号表状态 | 查看已安装的符号表 |
| | 下载符号表 | 下载系统符号表 |
| | 安装符号表 | 手动安装符号表文件 |
| **工具** | 代理设置 | 配置下载代理 |
| | 清除缓存 | 清理分析缓存 |

---

## 3. 镜像管理

### 3.1 加载内存镜像

**步骤**：

1. 点击左侧边栏的 **"加载镜像"** 按钮
2. 在弹出的文件选择对话框中选择内存镜像文件
3. 选择操作系统类型：
   - **自动检测** - 自动识别系统类型（推荐）
   - **Windows** - 手动指定为Windows镜像
   - **Linux** - 手动指定为Linux镜像
   - **macOS** - 手动指定为macOS镜像

**支持的镜像格式**：
- `.raw` - 原始内存镜像
- `.vmem` - VMware虚拟机内存
- `.dmp` - Windows崩溃转储
- `.lime` - Linux内存转储
- `.mem` - Memoryss获取的镜像

### 3.2 查看镜像信息

点击左侧菜单的 **"镜像信息"** 可查看：
- 镜像名称
- 文件大小
- MD5哈希值
- 文件路径
- 操作系统类型
- 符号表状态

---

## 4. 符号表管理

### 4.1 什么是符号表？

符号表是分析内存镜像必需的系统调试信息文件。没有符号表时，许多分析功能无法正常工作。

### 4.2 查看符号表状态

点击 **"符号表状态"** 查看：
- Windows符号表：已安装的PDB文件数量
- Linux符号表：已安装的内核版本数量
- macOS符号表：已安装的Darwin版本数量

### 4.3 下载Windows符号表

**自动下载**：
1. 加载Windows镜像后，如果缺少符号表会自动提示
2. 点击提示框中的 **"下载符号表"** 按钮
3. 等待下载完成（可能需要几分钟）

**符号表会自动从微软官方服务器下载并转换为ISF格式。**

### 4.4 下载Linux/macOS符号表

1. 点击 **"下载符号表"**
2. 系统会自动检测镜像的内核版本
3. 从GitHub仓库下载对应的符号表

### 4.5 手动安装符号表

如果自动下载失败，可以手动安装：

1. 准备符号表文件（`.json.xz`或`.json`格式）
2. 点击 **"安装符号表"**
3. 选择符号表文件
4. 等待安装完成

---

## 5. 插件分析

### 5.1 查看所有插件

点击 **"全部插件"** 可查看当前系统支持的所有插件，按功能分类：
- 进程分析
- 网络分析
- 注册表分析
- 文件系统
- 恶意代码检测
- 加密相关
- 系统信息

### 5.2 执行插件

**方法一：通过分类菜单**
1. 在左侧菜单找到对应插件
2. 点击插件名称
3. 等待分析完成

**方法二：通过全部插件**
1. 点击 **"全部插件"**
2. 找到需要的插件
3. 点击 **"执行"** 按钮

### 5.3 查看分析结果

分析结果以表格形式展示，支持：
- **排序** - 点击表头按列排序
- **搜索** - 在搜索框输入关键词过滤
- **导出** - 点击导出按钮保存结果

### 5.4 常用插件说明

#### Windows插件

| 插件 | 功能 | 输出信息 |
|------|------|----------|
| **pslist** | 进程列表 | PID、进程名、PPID、线程数、句柄数 |
| **pstree** | 进程树 | 进程层级关系 |
| **psscan** | 进程扫描 | 包含已终止/隐藏的进程 |
| **netscan** | 网络连接 | 协议、本地地址、远程地址、状态、**时间戳** |
| **dlllist** | DLL列表 | 进程加载的动态链接库 |
| **handles** | 句柄列表 | 进程打开的对象句柄 |
| **cmdline** | 命令行 | 进程启动的完整命令行 |
| **malfind** | 恶意代码 | 检测进程内存中的注入代码 |
| **hashdump** | 密码哈希 | 提取Windows账户密码哈希 |

#### Linux插件

| 插件 | 功能 | 输出信息 |
|------|------|----------|
| **linux_pslist** | 进程列表 | PID、进程名、UID、GID |
| **linux_pstree** | 进程树 | Linux进程层级关系 |
| **linux_bash** | Bash历史 | 用户执行的命令历史 |
| **linux_lsof** | 打开文件 | 进程打开的文件描述符 |
| **linux_lsmod** | 内核模块 | 已加载的内核模块 |

#### macOS插件

| 插件 | 功能 | 输出信息 |
|------|------|----------|
| **mac_pslist** | 进程列表 | macOS进程信息 |
| **mac_netstat** | 网络状态 | 网络连接信息 |
| **mac_lsmod** | 内核扩展 | 已加载的Kext |
| **mac_lsof** | 打开文件 | 文件描述符信息 |

---

## 6. CTF工具

### 6.1 Flag搜索

自动搜索常见的CTF Flag格式：

**支持的模式**：
- `flag{...}`
- `FLAG{...}`
- `ctf{...}`
- `key{...}`
- 以及更多...

**使用方法**：
1. 点击 **"Flag搜索"**
2. 选择搜索范围：
   - **快速模式** - 只扫描特定内存区域（推荐）
   - **深度模式** - 扫描全部内存（较慢）
3. 等待搜索完成
4. 查看搜索结果

### 6.2 正则搜索

使用自定义正则表达式搜索内存：

**使用方法**：
1. 点击 **"正则搜索"**
2. 输入正则表达式，例如：
   - `\d{3}-\d{4}-\d{4}` - 搜索电话号码格式
   - `[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}` - 搜索邮箱地址
   - `password\s*=\s*["\']?[^"'\s]+` - 搜索password配置
3. 选择搜索模式（快速/深度）
4. 开始搜索

**提示**：搜索结果会自动保存，可以随时查看历史搜索记录。

### 6.3 字符串提取

提取内存中的可打印字符串：

**使用方法**：
1. 点击 **"字符串提取"**
2. 设置最小字符串长度（默认4）
3. 选择输出编码（ASCII/Unicode）
4. 开始提取

---

## 7. 报告导出

### 7.1 导出当前结果

**方法**：
1. 在分析结果页面点击 **"导出"** 按钮
2. 选择导出格式：
   - **Markdown** - `.md`格式
   - **HTML** - `.html`格式（可浏览器查看）
   - **Word** - `.docx`格式
3. 选择保存位置
4. 等待导出完成

### 7.2 生成完整报告

生成包含所有分析结果的完整报告：

1. 点击顶部工具栏的 **"生成报告"** 按钮
2. 选择要包含的分析模块
3. 选择报告格式
4. 点击生成

---

## 8. 代理设置

如果访问GitHub或微软符号服务器较慢，可以配置代理：

### 8.1 设置代理

1. 点击左侧菜单 **"代理设置"**
2. 填写代理信息：
   - **代理类型**：HTTP/HTTPS/SOCKS5
   - **代理地址**：例如 `127.0.0.1`
   - **代理端口**：例如 `7890`
   - **用户名**：可选（如果代理需要认证）
   - **密码**：可选
3. 点击 **"测试连接"** 验证代理配置
4. 点击 **"保存"** 保存配置

### 8.2 删除代理

1. 打开 **"代理设置"**
2. 点击 **"删除代理"** 按钮
3. 确认删除

---

## 9. 常见问题

### Q1: 加载镜像时提示"符号表未安装"

**A**: 需要下载对应系统的符号表：
- Windows：点击提示中的下载按钮，或使用"符号表管理"中的"下载符号表"
- Linux/macOS：使用"下载符号表"功能，系统会自动下载对应版本

### Q2: 插件执行没有结果

**可能原因**：
1. **缺少符号表** - 安装对应系统的符号表
2. **镜像类型不匹配** - 确认镜像的操作系统类型正确
3. **镜像损坏** - 尝试重新获取内存镜像

### Q3: 网络连接时间显示问题

**说明**: `netscan` 插件支持显示网络连接的时间戳信息，包括：
- 创建时间
- 最后更新时间

如果时间显示异常，可能是符号表版本不匹配导致的。

### Q4: 下载符号表失败

**解决方案**：
1. 检查网络连接
2. 配置代理（如果需要）
3. 尝试手动下载符号表文件后使用"安装符号表"功能

### Q5: 分析速度很慢

**优化建议**：
1. 使用缓存功能 - 相同分析会直接读取缓存
2. 关闭不必要的后台程序
3. 增加系统内存
4. 使用快速模式而非深度模式

### Q6: 如何查找记事本编辑的文件？

**方法**：
1. 使用 **"进程列表"** 找到 `notepad.exe` 进程
2. 记下进程的PID
3. 使用 **"句柄列表"** 输入PID，查看该进程打开的文件
4. 或使用 **"DLL列表"** 查看记事本加载的模块

### Q7: Windows符号表自动下载失败？

**说明**: 本工具已实现workaround绕过Volatility3的PDB解析bug。如果仍然失败：
1. 确保网络连接正常
2. 尝试配置代理
3. 查看日志文件了解详细错误

### Q8: 如何查看命令执行历史？

**根据系统选择**：
- **Windows**: 使用 `cmdline` 插件（命令行参数）或 `consoles` 插件
- **Linux**: 使用 `linux_bash` 插件查看Bash历史
- **macOS**: 使用 `mac_bash` 插件

---

## 附录

### A. 键盘快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + K` | 快速搜索 |
| `Escape` | 关闭对话框 |
| `Ctrl/Cmd + F` | 在结果中搜索 |

### B. 支持的Volatility版本

- Volatility 3 Framework 2.27.0

### C. 数据存储位置

| 类型 | 位置 |
|------|------|
| 缓存 | `~/Library/Application Support/LensAnalysis/cache/` (macOS)<br>`%APPDATA%\LensAnalysis\cache\` (Windows)<br>`~/.local/share/LensAnalysis/cache/` (Linux) |
| 日志 | `logs/` 目录（项目根目录下）|
| 报告 | `reports/` 目录（项目根目录下）|

### D. 技术支持

如有问题或建议，请通过以下方式联系：

- **邮箱**: hil_yary@163.com
- **GitHub**: https://github.com/hilyary/LensAnalysis
- **个人博客**: https://hilyary.github.io

---

**析镜 LensAnalysis** - 让内存取证更简单

最后更新：2026年2月2日
