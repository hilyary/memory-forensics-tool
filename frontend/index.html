<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>析镜 LensAnalysis - 内存取证分析工具</title>
    <style>
        /* 防止白屏 */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        #app {
            width: 100vw;
            height: 100vh;
        }
        .splash-screen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #f1f5f9 100%) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 10000 !important;
        }
        .splash-screen.hidden {
            display: none !important;
        }
        /* 注册表面包屑样式 */
        .registry-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-secondary, #f8fafc);
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-secondary, #64748b);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .registry-breadcrumb:not(.hidden) {
            display: flex;
        }

        /* Volatility 3 安装对话框 */
        .vol3-install-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease-out;
        }
        .vol3-install-dialog {
            background: var(--bg-primary, #ffffff);
            border-radius: 16px;
            padding: 40px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: slideUp 0.3s ease-out;
        }
        .vol3-install-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .vol3-install-icon svg {
            width: 48px;
            height: 48px;
        }
        .vol3-install-dialog h2 {
            margin: 0 0 16px;
            font-size: 24px;
            color: var(--text-primary, #1e293b);
        }
        .vol3-install-dialog p {
            margin: 0 0 12px;
            color: var(--text-secondary, #64748b);
            line-height: 1.6;
        }
        .vol3-install-note {
            font-size: 14px;
            color: var(--text-tertiary, #94a3b8);
            padding: 12px;
            background: var(--bg-secondary, #f8fafc);
            border-radius: 8px;
            margin: 16px 0;
        }
        .vol3-install-actions {
            display: flex;
            gap: 12px;
            margin: 24px 0;
        }
        .vol3-install-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .vol3-install-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }
        .vol3-install-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        .vol3-install-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .vol3-install-btn.secondary {
            background: var(--bg-secondary, #f1f5f9);
            color: var(--text-secondary, #64748b);
        }
        .vol3-install-btn.secondary:hover {
            background: var(--bg-tertiary, #e2e8f0);
        }
        .vol3-install-btn .installing {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .vol3-install-btn .installing::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        .vol3-install-hint {
            font-size: 12px;
            color: var(--text-tertiary, #94a3b8);
        }
        .vol3-install-hint code {
            background: var(--bg-secondary, #f1f5f9);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 11px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 启动画面 -->
        <div class="splash-screen" id="splashScreen">
            <div class="splash-bg-pattern"></div>
            <div class="splash-content">
                <div class="splash-logo-wrapper">
                    <img src="assets/LensAnalysis-horizontal.png" alt="析镜 LensAnalysis" class="splash-logo-img">
                </div>
                <div class="splash-title-group">
                    <h1 class="splash-title">析镜</h1>
                    <p class="splash-version">v1.0.0</p>
                </div>
                <p class="splash-subtitle">一款基于 Volatility 3 的内存取证分析平台</p>
                <p class="splash-author">Created by <strong>hilyary</strong></p>
                <a href="https://hilyary.github.io/" target="_blank" class="splash-github">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 1.911 1.089 1.834 2.807 1.304 3.492.997.106-.775.418-1.305.762-1.604zm6.555-7.425c0-.801-.314-1.454-.701-1.966.069-.171.302-.867.133-1.966-.291-1.095-1.484-1.646-1.951-1.646-.533 0-.971.193-1.364.57-.476.079-1.075.338-1.442.57-.367-.232-.687-.427-.916-.57-.079-.044-.168-.089-.259-.128-.091.039-.18.084-.259.128-.229.143-.549.338-.916.57-.367.232-.966.491-1.442.57-.393-.377-.831-.57-1.364-.57-.467 0-1.66.551-1.951 1.646-.387 1.099.064 1.795.133 1.966-.387.512-.701 1.165-.701 1.966 0 1.535 1.123 2.79 2.625 2.79 1.502 0 2.625-1.255 2.625-2.79z"/>
                    </svg>
                    <span>hilyary.github.io</span>
                </a>
                <div class="splash-divider"></div>
                <div class="splash-loader">
                    <div class="loader-bar">
                        <div class="loader-progress"></div>
                    </div>
                    <p class="splash-status" id="splashStatus">正在初始化...</p>
                </div>
            </div>
        </div>

        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <img class="logo-icon" src="assets/LensAnalysis-icon.svg" alt="析镜" width="28" height="28">
                    <div class="logo-info">
                        <span class="logo-text">析镜</span>
                        <span class="logo-version">v1.0.0</span>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="status-indicator">
                    <span class="status-dot" id="systemStatusDot"></span>
                    <span class="status-text" id="systemStatusText">初始化中...</span>
                </div>
            </div>

            <div class="header-right">
                <button class="header-btn" id="aboutBtn" title="关于">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <circle cx="12" cy="12" r="9"/>
                        <path d="M12 17v-5"/>
                        <circle cx="12" cy="9" r="1" fill="currentColor"/>
                    </svg>
                </button>
                <button class="header-btn" id="symbolManagerBtn" title="符号表管理">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </button>
                <button class="header-btn" id="clearCacheBtn" title="清除缓存">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    </svg>
                </button>
                <button class="header-btn" id="exportBtn" title="导出报告">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 左侧边栏 -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <div class="section-title">镜像管理</div>
                    <button class="sidebar-btn primary" id="loadImageBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                        </svg>
                        <span>加载镜像</span>
                    </button>
                    <button class="sidebar-btn" id="symbolManagerBtn2" title="符号表管理">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                        <span>符号表管理</span>
                    </button>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">进程分析</div>
                    <button class="sidebar-btn" id="processAnalysisBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        <span>进程分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="processSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="pslist" data-os="windows" title="列出正在运行的进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            <span>进程列表</span>
                            <small>PsList</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="pstree" data-os="windows" title="以树形结构显示进程关系">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="5" r="3"/>
                                <circle cx="5" cy="19" r="3"/>
                                <circle cx="19" cy="19" r="3"/>
                                <path d="M12 8v4"/>
                                <path d="M5 16V8l7-4"/>
                                <path d="M19 16V8l-7-4"/>
                            </svg>
                            <span>进程树</span>
                            <small>PsTree</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="psscan" data-os="windows" title="扫描所有进程（包括隐藏/终止的）">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <path d="M11 8v6M8 11h6"/>
                            </svg>
                            <span>进程扫描</span>
                            <small>PsScan</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="dlllist" data-os="windows" title="列出进程加载的DLL">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            <span>DLL列表</span>
                            <small>DllList</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="handles" data-os="windows" title="列出进程打开的句柄">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v12M8 12h8"/>
                            </svg>
                            <span>句柄列表</span>
                            <small>Handles</small>
                        </button>
                    </div>
                    <button class="sidebar-btn" data-plugin="envars" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 9h16"/>
                            <path d="M4 15h16"/>
                            <path d="M10 3L8 21"/>
                            <path d="M16 3l-2 18"/>
                        </svg>
                        <span>环境变量</span>
                    </button>
                    <button class="sidebar-btn" data-plugin="getsids" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        <span>SIDs</span>
                    </button>
                </div>

                <button class="sidebar-btn" data-plugin="netscan" data-os="windows">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="2" y1="12" x2="22" y2="12"/>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                    <span>网络连接</span>
                </button>

                <button class="sidebar-btn" data-plugin="svcscan" data-os="windows">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                        <line x1="8" y1="21" x2="16" y2="21"/>
                        <line x1="12" y1="17" x2="12" y2="21"/>
                        <path d="M6 9h.01M10 9h.01M14 9h.01M18 9h.01"/>
                    </svg>
                    <span>服务扫描</span>
                </button>

                <button class="sidebar-btn" data-plugin="hivelist" data-os="windows">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    <span>注册表列表</span>
                </button>

                <button class="sidebar-btn" data-plugin="certificates" data-os="windows" title="列出注册表证书存储中的证书">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        <path d="M12 8v8"/>
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 16l3 3M9 19l3-3"/>
                    </svg>
                    <span>证书列表</span>
                </button>

                <button class="sidebar-btn" data-plugin="filescan" data-os="windows">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                        <polyline points="13,2 13,9 20,9"/>
                    </svg>
                    <span>文件扫描</span>
                </button>

                <!-- Windows 恶意软件检测 -->
                <div class="sidebar-section" data-os="windows">
                    <button class="sidebar-btn" id="malwareAnalysisBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                            <path d="M12 8v8"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        <span>恶意软件检测</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="malwareAnalysisSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="malfind" data-os="windows" title="列出可能包含注入代码的进程内存范围">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                                <path d="M12 8v8"/>
                            </svg>
                            <span>恶意代码</span>
                            <small>Malfind</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="drivermodule" data-os="windows" title="确定是否有任何已加载的驱动程序被rootkit隐藏">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="8" rx="1"/>
                                <rect x="2" y="14" width="20" height="8" rx="1"/>
                                <line x1="6" y1="6" x2="6" y2="6"/>
                                <line x1="6" y1="18" x2="6" y2="18"/>
                            </svg>
                            <span>驱动模块检测</span>
                            <small>DriverModule</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="hollowprocesses" data-os="windows" title="列出空心进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <circle cx="12" cy="12" r="6"/>
                                <circle cx="12" cy="12" r="2"/>
                            </svg>
                            <span>空心进程</span>
                            <small>HollowProcesses</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="ldrmodules" data-os="windows" title="列出Windows内存镜像中加载的模块">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            <span>LDR模块</span>
                            <small>LdrModules</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="svcdiff" data-os="windows" title="比较通过列表遍历与扫描找到的服务以查找rootkit">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/>
                                <rect x="9" y="3" width="6" height="4" rx="1"/>
                                <path d="M9 12h6"/>
                                <path d="M9 16h6"/>
                            </svg>
                            <span>服务差异检测</span>
                            <small>SvcDiff</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="unhooked_system_calls" data-os="windows" title="检测Windows进程中挂钩的ntdll.dll存根函数">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                                <path d="M12 8v8"/>
                                <path d="M12 16l3 3"/>
                                <path d="M12 16l-3 3"/>
                            </svg>
                            <span>系统调用检测</span>
                            <small>UnhookedCalls</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="processghosting" data-os="windows" title="列出DeletePending位已设置或FILE_OBJECT设置为0或Vads为DeleteOnClose的进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v8"/>
                                <path d="M8 12h8"/>
                            </svg>
                            <span>进程幽灵检测</span>
                            <small>ProcessGhosting</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="malware_psxview" data-os="windows" title="通过四种方法列出所有进程，可能有助于识别试图隐藏自己的进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <circle cx="11" cy="11" r="3"/>
                            </svg>
                            <span>进程隐藏检测</span>
                            <small>PsXView</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="pebmasquerade" data-os="windows" title="通过比较EPROCESS和PEB数据检测潜在的进程名称欺骗">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 12l2 2 4-4"/>
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v4"/>
                                <path d="M12 16v4"/>
                            </svg>
                            <span>PEB伪装检测</span>
                            <small>PebMasquerade</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="callbacks" data-os="windows" title="检测恶意回调">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <path d="M9 12l2 2 4-4"/>
                            </svg>
                            <span>回调检测</span>
                            <small>Callbacks</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="skeleton_key_check" data-os="windows" title="Skeleton Key检测">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                            </svg>
                            <span>Skeleton Key</span>
                            <small>SkeletonKey</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mutantscan" data-os="windows" title="互斥体扫描">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 8v8"/>
                                <path d="M8 12h8"/>
                            </svg>
                            <span>互斥体扫描</span>
                            <small>MutantScan</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="suspicious_threads" data-os="windows" title="可疑线程检测">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6"/>
                                <path d="M12 22s8-4 8-10V5l-8-3"/>
                            </svg>
                            <span>可疑线程</span>
                            <small>SuspiciousThreads</small>
                        </button>
                    </div>
                </div>

                <!-- Linux 进程分析 -->
                <div class="sidebar-section" data-os="linux">
                    <button class="sidebar-btn" id="linuxProcessAnalysisBtn" data-os="linux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        <span>进程分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="linuxProcessSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="linux_pslist" data-os="linux" title="Linux进程列表">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            <span>进程列表</span>
                            <small>PsList</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_pstree" data-os="linux" title="进程树">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="5" r="3"/>
                                <circle cx="5" cy="19" r="3"/>
                                <circle cx="19" cy="19" r="3"/>
                                <path d="M12 8v4"/>
                                <path d="M5 16V8l7-4"/>
                                <path d="M19 16V8l-7-4"/>
                            </svg>
                            <span>进程树</span>
                            <small>Pstree</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_psscan" data-os="linux" title="进程扫描">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <path d="M11 8v6M8 11h6"/>
                            </svg>
                            <span>进程扫描</span>
                            <small>Psscan</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_psaux" data-os="linux" title="进程详情">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span>进程详情</span>
                            <small>Psaux</small>
                        </button>
                    </div>
                    <button class="sidebar-btn" data-plugin="linux_bash" data-os="linux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4,17 10,11 4,5"/>
                            <line x1="12" y1="19" x2="20" y2="19"/>
                        </svg>
                        <span>Bash历史</span>
                    </button>
                    <button class="sidebar-btn" data-plugin="linux_envars" data-os="linux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 9h16"/>
                            <path d="M4 15h16"/>
                            <path d="M10 3L8 21"/>
                            <path d="M16 3l-2 18"/>
                        </svg>
                        <span>环境变量</span>
                    </button>
                </div>

                <!-- Linux 网络分析 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">网络分析</div>
                    <button class="sidebar-btn" data-plugin="linux_sockstat" data-os="linux" title="进程网络连接">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        <span>进程网络连接</span>
                    </button>
                    <button class="sidebar-btn" data-plugin="linux_ip_addr" data-os="linux" title="网络地址">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                            <path d="M9 10a1 1 0 1 1 2 0 1 1 0 0 1-2 0z"/>
                            <path d="M12 10a1 1 0 1 1 2 0 1 1 0 0 1-2 0z"/>
                            <path d="M15 10a1 1 0 1 1 2 0 1 1 0 0 1-2 0z"/>
                        </svg>
                        <span>网络地址</span>
                    </button>
                    <button class="sidebar-btn" data-plugin="linux_ip_link" data-os="linux" title="网络接口">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="8" rx="2"/>
                            <rect x="2" y="14" width="20" height="8" rx="2"/>
                            <line x1="6" y1="6" x2="6" y2="6"/>
                            <line x1="6" y1="18" x2="6" y2="18"/>
                        </svg>
                        <span>网络接口</span>
                    </button>
                </div>

                <!-- Linux 文件系统 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">文件系统</div>
                    <button class="sidebar-btn" id="linuxFilesystemBtn" data-os="linux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                            <polyline points="13,2 13,9 20,9"/>
                        </svg>
                        <span>文件系统</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="linuxFilesystemSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="linux_elfs" data-os="linux" title="列出所有进程的所有内存映射 ELF 文件">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>
                            <span>ELF文件列表</span>
                            <small>Elfs</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_lsof" data-os="linux" title="列出每个进程的打开文件">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                            </svg>
                            <span>打开文件列表</span>
                            <small>Lsof</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_mountinfo" data-os="linux" title="显示文件系统挂载信息">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M16.2 7.8l-.2 2.5-2.1.2"/>
                                <polygon points="14.5 9.5 9.5 14.5 14.5 19.5 19.5 14.5 14.5 9.5"/>
                            </svg>
                            <span>挂载信息</span>
                            <small>MountInfo</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_pagecache_files" data-os="linux" title="列出页缓存中的文件">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                            </svg>
                            <span>页缓存文件</span>
                            <small>PageCache</small>
                        </button>
                    </div>
                </div>

                <!-- Linux 内存分析 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">内存分析</div>
                    <button class="sidebar-btn" data-plugin="linux_maps" data-os="linux" title="内存映射">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <line x1="3" y1="9" x2="21" y2="9"/>
                            <line x1="3" y1="15" x2="21" y2="15"/>
                        </svg>
                        <span>内存映射</span>
                    </button>
                </div>

                <!-- Linux 恶意软件检测 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">恶意软件检测</div>
                    <button class="sidebar-btn" id="linuxMalwareBtn" data-os="linux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            <path d="M9 12l2 2 4-4"/>
                        </svg>
                        <span>恶意软件</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="linuxMalwareSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_malfind" data-os="linux" title="列出可能包含注入代码的进程内存范围">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            <span>恶意代码查找</span>
                            <small>Malfind</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_check_afinfo" data-os="linux" title="验证网络协议的操作函数指针">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="2"/>
                                <path d="M16.24 7.76l-2.12 6.36-6.36 2.12 2.12-6.36 6.36-2.12z"/>
                            </svg>
                            <span>协议族检查</span>
                            <small>Check_afinfo</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_check_creds" data-os="linux" title="检查是否有进程共享凭据结构">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                            </svg>
                            <span>凭据检查</span>
                            <small>Check_creds</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_check_idt" data-os="linux" title="检查IDT是否被更改">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 23 12 13 2"/>
                                <polyline points="13 2 9 12 13 12"/>
                            </svg>
                            <span>IDT检查</span>
                            <small>Check_idt</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_check_modules" data-os="linux" title="将模块列表与sysfs信息进行比较">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
                                <rect x="9" y="9" width="6" height="6"/>
                                <line x1="9" y1="1" x2="9" y2="4"/>
                                <line x1="15" y1="1" x2="15" y2="4"/>
                                <line x1="9" y1="20" x2="9" y2="23"/>
                                <line x1="15" y1="20" x2="15" y2="23"/>
                                <line x1="20" y1="9" x2="23" y2="9"/>
                                <line x1="20" y1="15" x2="23" y2="15"/>
                                <line x1="1" y1="9" x2="4" y2="9"/>
                                <line x1="1" y1="15" x2="4" y2="15"/>
                            </svg>
                            <span>内核模块检查</span>
                            <small>Check_modules</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_check_syscall" data-os="linux" title="检查系统调用表是否有挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3z"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                                <line x1="12" y1="16" x2="12" y2="16"/>
                            </svg>
                            <span>系统调用检查</span>
                            <small>Check_syscall</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_hidden_modules" data-os="linux" title="扫描内存以查找隐藏的内核模块">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span>隐藏模块检测</span>
                            <small>Hidden_modules</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_keyboard_notifiers" data-os="linux" title="解析键盘通知器调用链">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="4" width="20" height="16" rx="2"/>
                                <path d="M7 8h3a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v0a1 1 0 0 1 1-1z"/>
                                <path d="M14 8h3a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1h-3a1 1 0 0 1-1-1v0a1 1 0 0 1 1-1z"/>
                                <path d="M7 15h1a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v0a1 1 0 0 1 1-1z"/>
                                <path d="M15 15h2a1 1 0 0 1 1 1v0a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v0a1 1 0 0 1 1-1z"/>
                            </svg>
                            <span>键盘通知器</span>
                            <small>Keyboard_notifiers</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_netfilter" data-os="linux" title="列出Netfilter挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                <path d="M22 6l-10 7L2 6"/>
                            </svg>
                            <span>Netfilter检查</span>
                            <small>Netfilter</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_tty_check" data-os="linux" title="检查tty设备是否有挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                                <line x1="7" y1="2" x2="7" y2="22"/>
                                <line x1="17" y1="2" x2="17" y2="22"/>
                                <line x1="2" y1="12" x2="22" y2="12"/>
                                <line x1="2" y1="7" x2="22" y2="7"/>
                                <line x1="2" y1="17" x2="22" y2="17"/>
                            </svg>
                            <span>TTY检查</span>
                            <small>TTY_check</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="linux_malware_modxview" data-os="linux" title="集中lsmod、check_modules和hidden_modules结果">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="8" y1="6" x2="21" y2="6"/>
                                <line x1="8" y1="12" x2="21" y2="12"/>
                                <line x1="8" y1="18" x2="21" y2="18"/>
                                <line x1="3" y1="6" x2="3.01" y2="6"/>
                                <line x1="3" y1="12" x2="3.01" y2="12"/>
                                <line x1="3" y1="18" x2="3.01" y2="18"/>
                            </svg>
                            <span>模块综合视图</span>
                            <small>Modxview</small>
                        </button>
                    </div>
                </div>

                <!-- Linux 内核分析 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">内核分析</div>
                    <button class="sidebar-btn" data-plugin="linux_lsmod" data-os="linux" title="内核模块">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="8" rx="2"/>
                            <rect x="2" y="14" width="20" height="8" rx="2"/>
                            <line x1="6" y1="6" x2="6" y2="6"/>
                            <line x1="6" y1="18" x2="6" y2="18"/>
                        </svg>
                        <span>内核模块</span>
                    </button>
                    <button class="sidebar-btn" data-plugin="linux_kmsg" data-os="linux" title="内核消息">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        <span>内核消息</span>
                    </button>
                </div>

                <!-- Linux CTF工具 -->
                <div class="sidebar-section" data-os="linux">
                    <div class="section-title">CTF工具</div>
                    <button class="sidebar-btn accent" id="searchFlagBtnLinux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                            <path d="M11 8v6M8 11h6"/>
                        </svg>
                        <span>搜索Flag</span>
                    </button>
                    <button class="sidebar-btn" id="customFlagBtnLinux">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                            <polyline points="12 8 12 16 12 8"/>
                        </svg>
                        <span>自定义Flag</span>
                    </button>
                </div>

                <!-- macOS 进程分析 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">进程分析</div>
                    <button class="sidebar-btn" id="macProcessBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        <span>进程分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macProcessSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_pslist" data-os="macos" title="列出所有正在运行的进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="16"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                            <span>PsList - 进程列表</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_pstree" data-os="macos" title="以树形结构显示进程关系">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="5" r="3"/>
                                <circle cx="5" cy="19" r="3"/>
                                <circle cx="19" cy="19" r="3"/>
                                <path d="M12 8v4"/>
                                <path d="M5 16V8l7-4"/>
                                <path d="M19 16V8l-7-4"/>
                            </svg>
                            <span>PsTree - 进程树</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_psaux" data-os="macos" title="显示进程命令行参数">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="9"/>
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 3v9M9 12l3 3 3-3"/>
                            </svg>
                            <span>PsAux - 进程参数</span>
                        </button>
                    </div>
                </div>

                <!-- macOS Shell历史 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">Shell/环境</div>
                    <button class="sidebar-btn" data-plugin="mac_bash" data-os="macos" title="恢复bash命令历史">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4,17 10,11 4,5"/>
                            <line x1="12" y1="19" x2="20" y2="19"/>
                        </svg>
                        <span>Bash - 命令历史</span>
                    </button>
                </div>

                <!-- macOS 网络分析 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">网络分析</div>
                    <button class="sidebar-btn" id="macNetworkBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                        </svg>
                        <span>网络分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macNetworkSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_netstat" data-os="macos" title="列出所有进程的所有网络连接">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M2 12h20M12 2v20"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span>NetStat - 网络连接</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_ifconfig" data-os="macos" title="列出所有设备的网络接口信息">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="8" rx="2"/>
                                <circle cx="16" cy="6" r="2"/>
                                <circle cx="12" cy="6" r="2"/>
                                <circle cx="8" cy="6" r="2"/>
                                <line x1="2" y1="10" x2="22" y2="10"/>
                                <line x1="12" y1="10" x2="12" y2="22"/>
                            </svg>
                            <span>IfConfig - 网络接口</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_socket_filters" data-os="macos" title="枚举内核套接字过滤器">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="22 3 2 3 10 12.46 10 19 14 21 18 12.46 22 3"/>
                                <line x1="10" y1="12" x2="14" y2="21"/>
                                <circle cx="16" cy="5" r="2"/>
                            </svg>
                            <span>Socket Filters - 套接字过滤器</span>
                        </button>
                    </div>
                </div>

                <!-- macOS 文件系统 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">文件系统</div>
                    <button class="sidebar-btn" id="macFileSystemBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                            <polyline points="13,2 13,9 20,9"/>
                        </svg>
                        <span>文件系统</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macFileSystemSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_lsof" data-os="macos" title="列出所有进程的所有打开文件描述符">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <line x1="10" y1="13" x2="10" y2="17"/>
                            </svg>
                            <span>Lsof - 打开文件</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_list_files" data-os="macos" title="列出所有进程的所有打开文件描述符">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                                <line x1="8" y1="8" x2="16" y2="16"/>
                                <polyline points="16,8 8,8 8,16"/>
                            </svg>
                            <span>List Files - 文件列表</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_mount" data-os="macos" title="包含一系列插件的模块，生成Mac的mount命令中通常找到的数据">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M16.2 7.8l-.2 2.5-2.1.2"/>
                                <polygon points="14.5 9.5 9.5 14.5 14.5 19.5 19.5 14.5 14.5 9.5"/>
                            </svg>
                            <span>Mount - 挂载信息</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_vfsevents" data-os="macos" title="列出正在过滤文件系统事件的进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 20h9"/>
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                <path d="M15 5l4 4"/>
                            </svg>
                            <span>VFSevents - VFS事件</span>
                        </button>
                    </div>
                </div>

                <!-- macOS 内存分析 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">内存分析</div>
                    <button class="sidebar-btn" id="macMemoryBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                        </svg>
                        <span>内存分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macMemorySubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_maps" data-os="macos" title="列出可能包含注入代码的进程内存范围">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/>
                                <line x1="3" y1="15" x2="21" y2="15"/>
                                <line x1="9" y1="3" x2="9" y2="21"/>
                                <line x1="15" y1="3" x2="15" y2="21"/>
                            </svg>
                            <span>Maps - 内存映射</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_malfind" data-os="macos" title="列出可能包含注入代码的进程内存范围">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                                <path d="M12 8v8"/>
                                <circle cx="12" cy="12" r="2"/>
                            </svg>
                            <span>Malfind - 恶意代码</span>
                        </button>
                    </div>
                </div>

                <!-- macOS 内核分析 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">内核分析</div>
                    <button class="sidebar-btn" id="macKernelBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                            <polyline points="14,2 14,9 20,9"/>
                        </svg>
                        <span>内核分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macKernelSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_lsmod" data-os="macos" title="列出已加载的内核模块">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <line x1="10" y1="13" x2="10" y2="17"/>
                            </svg>
                            <span>Lsmod - 内核模块</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_dmesg" data-os="macos" title="打印内核日志缓冲区">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                <line x1="9" y1="10" x2="15" y2="10"/>
                                <line x1="9" y1="14" x2="13" y2="14"/>
                            </svg>
                            <span>DMesg - 内核消息</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_kevents" data-os="macos" title="列出进程注册的事件处理程序">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                                <line x1="12" y1="2" x2="12" y2="22"/>
                                <circle cx="12" cy="12" r="2"/>
                                <circle cx="12" cy="6" r="1" fill="currentColor"/>
                            </svg>
                            <span>Kevents - 内核事件</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_timers" data-os="macos" title="检查恶意内核定时器">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 15 15"/>
                                <line x1="12" y1="2" x2="12" y2="6"/>
                                <line x1="12" y1="18" x2="12" y2="22"/>
                                <line x1="6" y1="12" x2="18" y2="12"/>
                                <circle cx="12" cy="12" r="1" fill="currentColor"/>
                            </svg>
                            <span>Timers - 定时器</span>
                        </button>
                    </div>
                </div>

                <!-- macOS 安全分析 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">安全分析</div>
                    <button class="sidebar-btn" id="macSecurityBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        <span>安全分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macSecuritySubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_kauth_scopes" data-os="macos" title="列出kauth范围及其状态">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <circle cx="12" cy="11" r="3"/>
                                <path d="M12 8v6"/>
                            </svg>
                            <span>Kauth Scopes - Kauth作用域</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_kauth_listeners" data-os="macos" title="列出kauth监听器及其状态">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                <path d="M9 12l2 2 4-4"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span>Kauth Listeners - Kauth监听器</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_trustedbsd" data-os="macos" title="检查恶意trustedbsd模块">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
                                <path d="M12 12v9"/>
                                <circle cx="12" cy="12" r="2"/>
                            </svg>
                            <span>TrustedBSD - TrustedBSD模块</span>
                        </button>
                    </div>
                </div>

                <!-- macOS 系统检查 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">系统检查</div>
                    <button class="sidebar-btn" id="macSystemCheckBtn" data-os="macos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9 12l2 2 4-4"/>
                            <circle cx="12" cy="12" r="6"/>
                        </svg>
                        <span>系统检查</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="submenu hidden" id="macSystemCheckSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="mac_check_syscall" data-os="macos" title="检查系统调用表是否有挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                            </svg>
                            <span>Check Syscall - 系统调用检查</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_check_sysctl" data-os="macos" title="检查sysctl处理程序是否有挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                <path d="M11 8v6M8 11h6"/>
                                <rect x="9" y="9" width="4" height="4"/>
                            </svg>
                            <span>Check Sysctl - Sysctl检查</span>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="mac_check_trap_table" data-os="macos" title="检查mach陷阱表是否有挂钩">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                <polyline points="2 7 12 12 22 7"/>
                                <path d="M12 12v10"/>
                                <circle cx="12" cy="7" r="2"/>
                            </svg>
                            <span>Check Trap Table - 陷阱表检查</span>
                        </button>
                    </div>
                </div>

                <!-- macOS CTF工具 -->
                <div class="sidebar-section" data-os="macos">
                    <div class="section-title">CTF工具</div>
                    <button class="sidebar-btn accent" id="searchFlagBtnMac">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                            <path d="M11 8v6M8 11h6"/>
                        </svg>
                        <span>搜索Flag</span>
                    </button>
                    <button class="sidebar-btn" id="customFlagBtnMac">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                            <polyline points="12 8 12 16 12 8"/>
                        </svg>
                        <span>自定义Flag</span>
                    </button>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">凭证提取</div>
                    <button class="sidebar-btn" id="credentialExtractionBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                        <span>凭证提取</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="credentialExtractionSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="hashdump" data-os="windows" title="提取Windows密码哈希">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
                            </svg>
                            <span>密码哈希</span>
                            <small>Hashdump</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="lsadump" data-os="windows" title="提取LSA密钥">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                            </svg>
                            <span>LSA密钥</span>
                            <small>Lsadump</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="cachedump" data-os="windows" title="提取域缓存凭据">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                                <line x1="12" y1="18" x2="12" y2="12"/>
                                <line x1="9" y1="15" x2="15" y2="15"/>
                            </svg>
                            <span>域缓存</span>
                            <small>Cachedump</small>
                        </button>
                    </div>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">命令历史</div>
                    <button class="sidebar-btn" id="commandHistoryBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="4,17 10,11 4,5"/>
                            <line x1="12" y1="19" x2="20" y2="19"/>
                        </svg>
                        <span>命令历史</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="commandHistorySubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="cmdline" data-os="windows" title="进程命令行参数">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="4,17 10,11 4,5"/>
                                <line x1="12" y1="19" x2="20" y2="19"/>
                            </svg>
                            <span>命令行参数</span>
                            <small>CmdLine</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="cmdscan" data-os="windows" title="CMD命令历史">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="4,17 10,11 4,5"/>
                                <line x1="12" y1="19" x2="20" y2="19"/>
                            </svg>
                            <span>CMD历史</span>
                            <small>CmdScan</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="consoles" data-os="windows" title="控制台历史">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                <line x1="8" y1="21" x2="16" y2="21"/>
                                <line x1="12" y1="17" x2="12" y2="21"/>
                                <polyline points="6,9 12,15 18,9"/>
                            </svg>
                            <span>控制台历史</span>
                            <small>Consoles</small>
                        </button>
                    </div>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">进程检测</div>
                    <button class="sidebar-btn" id="processDetectionBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                        <span>进程检测</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="processDetectionSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="psxview" data-os="windows" title="检测隐藏进程">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span>进程隐藏检测</span>
                            <small>PsXView</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="ldrmodules" data-os="windows" title="检测隐藏DLL">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                            </svg>
                            <span>DLL隐藏检测</span>
                            <small>LdrModules</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="sessions" data-os="windows" title="会话信息">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                            </svg>
                            <span>会话信息</span>
                            <small>Sessions</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="threads" data-os="windows" title="线程信息">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6"/>
                            </svg>
                            <span>线程信息</span>
                            <small>Threads</small>
                        </button>
                    </div>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">程序痕迹</div>
                    <button class="sidebar-btn" id="programTraceBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span>程序痕迹</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="programTraceSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="userassist" data-os="windows" title="用户程序运行记录">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span>用户辅助</span>
                            <small>UserAssist</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="scheduled_tasks" data-os="windows" title="计划任务记录">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            <span>计划任务</span>
                            <small>ScheduledTasks</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="amcache" data-os="windows" title="应用程序缓存">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                                <circle cx="12" cy="14" r="3"/>
                            </svg>
                            <span>应用缓存</span>
                            <small>AmCache</small>
                        </button>
                    </div>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">系统分析</div>
                    <button class="sidebar-btn" id="systemAnalysisBtn" data-os="windows">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        <span>系统分析</span>
                        <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <!-- 隐藏的子菜单 -->
                    <div class="submenu hidden" id="systemAnalysisSubmenu">
                        <button class="sidebar-btn submenu-item" data-plugin="privileges" data-os="windows" title="列出进程权限">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 9.9-1"/>
                            </svg>
                            <span>进程权限</span>
                            <small>Privs</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="vadinfo" data-os="windows" title="虚拟地址描述符信息">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                                <circle cx="12" cy="11" r="3"/>
                            </svg>
                            <span>内存区域</span>
                            <small>VadInfo</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="modscan" data-os="windows" title="扫描内核模块">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                <polyline points="14,2 14,9 20,9"/>
                            </svg>
                            <span>模块扫描</span>
                            <small>ModScan</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="ssdt" data-os="windows" title="系统服务描述符表">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                <line x1="8" y1="21" x2="16" y2="21"/>
                                <line x1="12" y1="17" x2="12" y2="21"/>
                                <path d="M6 9l2 2 4-4"/>
                            </svg>
                            <span>SSDT</span>
                            <small>SSDT</small>
                        </button>
                        <button class="sidebar-btn submenu-item" data-plugin="driverscan" data-os="windows" title="扫描系统驱动">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="2" width="20" height="8" rx="2"/>
                                <circle cx="16" cy="6" r="2"/>
                                <circle cx="12" cy="6" r="2"/>
                                <circle cx="8" cy="6" r="2"/>
                            </svg>
                            <span>驱动扫描</span>
                            <small>DriverScan</small>
                        </button>
                    </div>
                </div>

                <div class="sidebar-section" data-os="windows">
                    <div class="section-title">CTF工具</div>
                    <button class="sidebar-btn accent" id="searchFlagBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                            <path d="M11 8v6M8 11h6"/>
                        </svg>
                        <span>搜索Flag</span>
                    </button>
                    <button class="sidebar-btn" id="customFlagBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                            <polyline points="12 8 12 16 12 8"/>
                        </svg>
                        <span>自定义Flag</span>
                    </button>
                </div>
            </aside>

            <!-- 主内容区 -->
            <main class="content">
                <!-- 欢迎页 -->
                <div class="welcome-panel" id="welcomePanel">
                    <div class="welcome-content">
                        <img class="welcome-icon" src="assets/LensAnalysis-horizontal.png" alt="析镜 LensAnalysis">
                        <p class="welcome-subtitle">一款基于 Volatility 3 的图形化内存分析平台</p>
                        <button class="welcome-btn" id="welcomeLoadBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                            </svg>
                            <span>加载内存镜像</span>
                        </button>
                        <p class="welcome-author">Created by <strong>hilyary</strong></p>
                        <div class="welcome-footer">
                            <a href="https://hilyary.github.io/" target="_blank" class="github-link">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 1.911 1.089 1.834 2.807 1.304 3.492.997.106-.775.418-1.305.762-1.604zm6.555-7.425c0-.801-.314-1.454-.701-1.966.069-.171.302-.867.133-1.966-.291-1.095-1.484-1.646-1.951-1.646-.533 0-.971.193-1.364.57-.476.079-1.075.338-1.442.57-.367-.232-.687-.427-.916-.57-.079-.044-.168-.089-.259-.128-.091.039-.18.084-.259.128-.229.143-.549.338-.916.57-.367.232-.966.491-1.442.57-.393-.377-.831-.57-1.364-.57-.467 0-1.66.551-1.951 1.646-.387 1.099.064 1.795.133 1.966-.387.512-.701 1.165-.701 1.966 0 1.535 1.123 2.79 2.625 2.79 1.502 0 2.625-1.255 2.625-2.79z"/>
                                </svg>
                                <span>hilyary.github.io</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 镜像信息面板 -->
                <div class="image-info-panel hidden" id="imageInfoPanel">
                    <div class="info-card">
                        <div class="info-header">
                            <h3>当前镜像</h3>
                            <div class="image-status">
                                <span class="status-dot active"></span>
                                <span>已加载</span>
                            </div>
                        </div>
                        <div class="info-body">
                            <div class="info-item">
                                <span class="info-label">文件名</span>
                                <span class="info-value" id="imageName">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">大小</span>
                                <span class="info-value" id="imageSize">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">哈希</span>
                                <span class="info-value" id="imageHash">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">路径</span>
                                <span class="info-value" id="imagePath">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 结果展示区 -->
                <div class="results-panel hidden" id="resultsPanel">
                    <div class="results-header">
                        <h2 id="resultsTitle">分析结果</h2>
                        <div class="results-actions">
                            <!-- 注册表返回按钮 -->
                            <button class="action-btn hidden" id="registryBackBtn" title="返回上一级">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                                返回
                            </button>
                            <!-- 注册表面包屑 -->
                            <div class="registry-breadcrumb hidden" id="registryBreadcrumb"></div>
                            <button class="action-btn" id="exportResults">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                导出数据
                            </button>
                        </div>
                    </div>

                    <div class="results-stats" id="resultsStats">
                        <div class="stat-item">
                            <span class="stat-value" id="resultCount">0</span>
                            <span class="stat-label">记录数</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="executionTime">-</span>
                            <span class="stat-label">执行时间</span>
                        </div>
                        <div class="stat-item" id="cacheStat" style="display:none;">
                            <span class="stat-value" style="color:var(--success);">缓存</span>
                            <span class="stat-label">来源</span>
                        </div>
                    </div>

                    <!-- 搜索和筛选工具栏 -->
                    <div class="results-toolbar" id="resultsToolbar">
                        <div class="toolbar-left">
                            <div class="search-box">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" id="tableSearch" placeholder="搜索..." />
                                <button class="search-btn hidden" id="searchBtn" title="搜索">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="m21 21-4.35-4.35"/>
                                    </svg>
                                </button>
                            </div>
                            <button class="toolbar-btn" id="filterBtn" title="筛选">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-right">
                            <button class="toolbar-btn" id="viewModeBtn" title="切换视图模式">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                </svg>
                                <span id="viewModeText">滚动</span>
                            </button>
                            <button class="toolbar-btn primary-btn hidden" id="dumpAllBtn" title="下载所有进程">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span id="dumpAllText">全部下载 (0)</span>
                            </button>
                            <button class="toolbar-btn accent-btn hidden" id="extractEventlogBtn" title="提取所有事件日志文件">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                                    <polyline points="14,2 14,9 20,9"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <line x1="10" y1="9" x2="10" y2="21"/>
                                </svg>
                                <span id="extractEventlogText">提取事件日志</span>
                            </button>
                        </div>
                    </div>

                    <!-- 分页控件 -->
                    <div class="results-pagination hidden" id="resultsPagination">
                        <div class="pagination-info">
                            <span id="paginationInfo">显示 1-10 共 0 条</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" id="firstPageBtn" title="首页">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="11 17 6 12 11 7"/>
                                    <polyline points="18 17 13 12 18 7"/>
                                </svg>
                            </button>
                            <button class="pagination-btn" id="prevPageBtn" title="上一页">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"/>
                                </svg>
                            </button>
                            <input type="number" class="pagination-input" id="pageInput" min="1" value="1" />
                            <span class="pagination-total">/ <span id="totalPages">1</span></span>
                            <button class="pagination-btn" id="nextPageBtn" title="下一页">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"/>
                                </svg>
                            </button>
                            <button class="pagination-btn" id="lastPageBtn" title="末页">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="13 17 18 12 13 7"/>
                                    <polyline points="6 17 11 12 6 7"/>
                                </svg>
                            </button>
                            <select class="pagination-size" id="pageSizeSelect">
                                <option value="20">20条/页</option>
                                <option value="50">50条/页</option>
                                <option value="100">100条/页</option>
                                <option value="200">200条/页</option>
                            </select>
                        </div>
                    </div>

                    <div class="results-table-container" id="resultsTableContainer">
                        <table class="results-table" id="resultsTable">
                            <thead id="resultsTableHead"></thead>
                            <tbody id="resultsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>

        <!-- 加载指示器 -->
        <div class="loading-overlay hidden" id="loadingOverlay">
            <div class="loading-card">
                <svg class="loading-spinner" viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-dasharray="80" stroke-dashoffset="60">
                        <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
                    </circle>
                </svg>
                <p class="loading-text" id="loadingText">分析中...</p>
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loadingProgress"></div>
                </div>
                <p class="loading-hint" id="loadingHint">请稍候，正在处理...</p>
            </div>
        </div>

        <!-- 自定义确认对话框 -->
        <div class="confirm-overlay hidden" id="confirmOverlay">
            <div class="confirm-card">
                <div class="confirm-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4"/>
                        <path d="M12 8h.01"/>
                    </svg>
                </div>
                <h3 class="confirm-title" id="confirmTitle">确认</h3>
                <p class="confirm-message" id="confirmMessage">是否继续？</p>
                <div class="confirm-buttons">
                    <button class="confirm-btn cancel-btn" id="confirmCancel">取消</button>
                    <button class="confirm-btn confirm-primary-btn" id="confirmOk">确定</button>
                </div>
            </div>
        </div>

        <!-- 符号表管理对话框 -->
        <div class="confirm-overlay hidden" id="symbolManagerOverlay">
            <div class="confirm-card" style="max-width: 600px;">
                <!-- 标题栏 -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="url(#gradient1)" stroke-width="2" width="32" height="32">
                            <defs>
                                <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                        <div>
                            <h3 class="confirm-title" style="margin: 0; font-size: 18px;">符号表管理</h3>
                        </div>
                    </div>
                </div>

                <!-- 符号表状态列表 -->
                <div id="symbolStatusList" style="margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48" style="margin-bottom: 12px; opacity: 0.3;">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        </svg>
                        <p>正在加载符号表状态...</p>
                    </div>
                </div>

                <!-- GitHub 自动下载按钮 -->
                <div id="githubDownloadSection" style="background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; align-items: start;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" width="20" height="20" style="flex-shrink: 0; margin-top: 2px;">
                            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77V5.77c0-5.42-3.87-7.99-9-7a2 2 0 0 0-2 2c0 5.42-5.07 8.5-9 8.5"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="font-weight: 600; color: #303133; margin-bottom: 6px;">自动下载符号表</div>
                                <button id="proxySettingsBtn" title="代理设置" style="display: inline-flex; align-items: center; justify-content: center; gap: 4px; padding: 7px 14px; background: white; border: 1px solid #dcdfe6; border-radius: 6px; color: #606266; font-size: 13px; cursor: pointer; transition: all 0.2s;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                        <path d="M8 11h8"/>
                                    </svg>
                                    <span>代理设置</span>
                                </button>
                            </div>
                            <div style="font-size: 13px; color: #606266; line-height: 1.6; margin-bottom: 10px;">
                                从 GitHub 自动下载 Linux/macOS 符号表，或从微软官方符号服务器下载 Windows 符号表。需要先加载内存镜像才能自动检测内核版本。
                            </div>
                            <div id="githubDownloadButtons">
                                <button class="confirm-btn confirm-primary-btn" id="downloadLinuxSymbols" style="margin-right: 8px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    下载 Linux 符号表
                                </button>
                                <button class="confirm-btn confirm-primary-btn" id="downloadMacSymbols" style="margin-right: 8px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    下载 macOS 符号表
                                </button>
                                <button class="confirm-btn confirm-primary-btn" id="downloadWindowsSymbols">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                    </svg>
                                    下载 Windows 符号表
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作说明 -->
                <div style="background: #f8f9fa; border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; align-items: start;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#667eea" stroke-width="2" width="20" height="20" style="flex-shrink: 0; margin-top: 2px;">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #303133; margin-bottom: 6px;">什么是符号表？</div>
                            <div style="font-size: 13px; color: #606266; line-height: 1.6;">
                                符号表包含了操作系统内核的数据结构定义。分析内存镜像时，Volatility 需要匹配对应内核版本的符号表才能正确解析数据。
                            </div>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e4e7ed;">
                                <div style="font-size: 12px; color: #909399;">
                                    💡 提示：符号表来源：<a href="https://github.com/Abyss-W4tcher/volatility3-symbols" target="_blank" style="color: #667eea; text-decoration: none;">volatility3-symbols</a> (GitHub)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="confirm-buttons">
                    <button class="confirm-btn cancel-btn" id="symbolManagerClose">关闭</button>
                    <button class="confirm-btn confirm-primary-btn" id="symbolUploadBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" style="vertical-align: middle; margin-right: 4px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                        </svg>
                        安装符号表
                    </button>
                </div>
            </div>
        </div>

        <!-- 代理设置对话框 -->
        <div class="confirm-overlay hidden" id="proxySettingsOverlay">
            <div class="confirm-card" style="max-width: 450px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="url(#gradient2)" stroke-width="2" width="28" height="28">
                        <defs>
                            <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        <path d="M8 11h8M8 15h8"/>
                    </svg>
                    <h3 class="confirm-title" style="margin: 0;">代理设置</h3>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; color: #606266; margin-bottom: 6px;">代理类型</label>
                    <select id="proxyType" style="width: 100%; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 6px; font-size: 14px; background: white;">
                        <option value="http">HTTP</option>
                        <option value="https">HTTPS</option>
                        <option value="socks5">SOCKS5</option>
                    </select>
                </div>

                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <div style="flex: 2;">
                        <label style="display: block; font-size: 13px; color: #606266; margin-bottom: 6px;">代理地址</label>
                        <input type="text" id="proxyHost" placeholder="127.0.0.1" value="127.0.0.1" style="width: 100%; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div style="flex: 1;">
                        <label style="display: block; font-size: 13px; color: #606266; margin-bottom: 6px;">端口</label>
                        <input type="number" id="proxyPort" placeholder="7890" value="7890" min="1" max="65535" style="width: 100%; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-size: 13px; color: #606266; margin-bottom: 6px;">用户名（可选）</label>
                    <input type="text" id="proxyUsername" placeholder="如果代理需要认证" style="width: 100%; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 6px; font-size: 14px;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 13px; color: #606266; margin-bottom: 6px;">密码（可选）</label>
                    <input type="password" id="proxyPassword" placeholder="如果代理需要认证" style="width: 100%; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 6px; font-size: 14px;">
                </div>

                <!-- 当前代理状态 -->
                <div id="proxyStatus" style="margin-bottom: 16px; padding: 10px; background: #f5f7fa; border-radius: 6px; font-size: 13px; color: #909399;"></div>

                <!-- 测试代理结果 -->
                <div id="proxyTestResult" style="margin-bottom: 16px; padding: 10px; background: #f0f9ff; border-radius: 6px; font-size: 13px; color: #606266; display: none;"></div>

                <div class="confirm-buttons">
                    <button class="confirm-btn cancel-btn" id="proxyCancelBtn">取消</button>
                    <button class="confirm-btn cancel-btn" id="proxyClearBtn" style="margin-right: auto;">清除</button>
                    <button class="confirm-btn cancel-btn" id="proxyTestBtn" style="background: #e6f7ff; border-color: #91d5ff; color: #1890ff;">测试代理</button>
                    <button class="confirm-btn confirm-primary-btn" id="proxySaveBtn">保存</button>
                </div>
            </div>
        </div>

        <!-- 使用条款弹窗 -->
        <div class="confirm-overlay hidden" id="termsOverlay">
            <div class="terms-dialog">
                <!-- 标题栏 -->
                <div class="terms-titlebar">
                    <h2>开源协议与使用条款</h2>
                </div>

                <!-- 内容区域 -->
                <div class="terms-body">
                    <div class="terms-section">
                        <h3>本软件采用 GPL v3 开源协议</h3>
                        <p>本项目在 GPL v3 协议的基础上，增加以下补充条款：</p>
                    </div>

                    <div class="terms-section">
                        <h3>一、商业使用限制</h3>
                        <p>虽然 GPL v3 协议允许商业使用，但本项目有额外的商业使用限制：</p>
                        <ul class="terms-list">
                            <li class="terms-deny">未经作者书面许可，禁止将本软件用于任何商业用途</li>
                            <li class="terms-deny">包括：直接销售、集成到商业产品、提供付费服务等</li>
                        </ul>
                    </div>

                    <div class="terms-section">
                        <h3>二、允许的使用</h3>
                        <p>本软件仅用于合法的内存取证和安全研究目的：</p>
                        <ul class="terms-list">
                            <li>✓ 个人学习和研究</li>
                            <li>✓ CTF 竞赛等安全竞赛活动</li>
                            <li>✓ 授权的安全测试和渗透测试</li>
                            <li>✓ 学术研究和教学</li>
                            <li>✓ 应急响应和数字取证（需有合法授权）</li>
                        </ul>
                    </div>

                    <div class="terms-section">
                        <h3>三、禁止的行为</h3>
                        <ul class="terms-list">
                            <li class="terms-deny">✗ 未经授权访问他人计算机系统</li>
                            <li class="terms-deny">✗ 窃取他人隐私信息</li>
                            <li class="terms-deny">✗ 破坏计算机系统或数据</li>
                            <li class="terms-deny">✗ 任何形式的网络攻击活动</li>
                            <li class="terms-deny">✗ 其他违反法律法规的行为</li>
                        </ul>
                    </div>

                    <div class="terms-section">
                        <h3>四、免责声明</h3>
                        <ul class="terms-list">
                            <li>1. 软件按"现状"提供，作者不对软件的准确性、完整性、可靠性做任何保证。</li>
                            <li>2. 使用本软件所产生的一切后果由使用者自行承担，作者不承担任何责任。</li>
                            <li>3. 因使用本软件导致的任何直接或间接损失，作者概不负责。</li>
                        </ul>
                    </div>

                    <div class="terms-section terms-section-project">
                        <h3>五、联系信息</h3>
                        <p><strong>项目：</strong>析镜 LensAnalysis</p>
                        <p><strong>邮箱：</strong>hil_yary@163.com</p>
                        <p><strong>GitHub：</strong><a href="https://github.com/hilyary/LensAnalysis" target="_blank">https://github.com/hilyary/LensAnalysis</a></p>
                        <p class="terms-note">完整协议请查看项目根目录的 LICENSE 文件</p>
                    </div>

                    <div class="terms-warning-box">
                        <strong>重要提示：</strong>使用本软件即表示您已阅读、理解并同意受 GPL v3 协议及补充条款的约束。请确保您的使用行为符合当地法律法规。
                    </div>
                </div>

                <!-- 底部按钮 -->
                <div class="terms-buttons-area">
                    <button class="terms-button terms-button-cancel" id="declineTermsBtn">拒绝并退出</button>
                    <button class="terms-button terms-button-accept" id="acceptTermsBtn">我已阅读并同意</button>
                </div>
            </div>
        </div>

        <!-- 关于对话框 -->
        <div class="confirm-overlay hidden" id="aboutOverlay">
            <div class="about-dialog">
                <!-- 关闭按钮 -->
                <button class="about-close-btn" id="aboutCloseBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>

                <!-- 左侧：品牌信息 -->
                <div class="about-left">
                    <img src="assets/LensAnalysis-icon.png" alt="LensAnalysis" class="about-logo">
                    <h1 class="about-title">析镜</h1>
                    <p class="about-subtitle">LensAnalysis</p>
                    <div class="about-version">v1.0.0</div>
                    <div class="about-description">基于 Volatility 3 的内存取证分析平台</div>
                    <div class="about-creator">
                        created by <a href="https://github.com/hilyary/LensAnalysis" target="_blank" style="color: var(--accent);">hilyary</a>
                    </div>
                </div>

                <!-- 中间：功能列表 -->
                <div class="about-center">
                    <div class="about-section-title">主要功能</div>
                    <div class="about-feature-list">
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                            <span>多平台内存镜像分析</span>
                        </div>
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 6v6l4 2"/>
                            </svg>
                            <span>进程、网络、文件系统取证</span>
                        </div>
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <span>自定义 Flag 搜索</span>
                        </div>
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            <span>多格式报告导出</span>
                        </div>
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            <span>注册表分析</span>
                        </div>
                        <div class="about-feature-item">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                            </svg>
                            <span>自动安装符号表</span>
                        </div>
                    </div>
                </div>

                <!-- 右侧：二维码 -->
                <div class="about-right">
                    <div class="about-section-title">加入用户交流群</div>
                    <img src="assets/qq群.png" alt="QQ群二维码" class="about-qrcode-img">
                    <a href="https://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=yT-w6936waz74E_a7MNcNhuxsBkwZHbA&authKey=ueeWx7PLk58Ojig%2Burgx1LWd9HE84AeLXX%2Bo1Klhccpf3RfOev9RJl1jOJ7J96u8&noverify=0&group_code=1038310324" target="_blank" class="about-qrcode-link">
                        QQ群: 1038310324
                    </a>
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                        <a href="#" id="viewTermsBtn" style="display: flex; align-items: center; gap: 6px; color: var(--text-muted); font-size: 0.85rem; text-decoration: none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            使用条款与免责声明
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 只读条款对话框（关于页面中使用） -->
        <div class="confirm-overlay hidden" id="termsReadOnlyOverlay">
            <div class="terms-readonly-dialog">
                <!-- 标题栏 -->
                <div class="terms-readonly-header">
                    <h2>GPL v3 开源协议与补充条款</h2>
                    <button class="terms-readonly-close" onclick="document.getElementById('termsReadOnlyOverlay').classList.add('hidden')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- 内容区域 -->
                <div class="terms-readonly-body">
                    <div class="terms-readonly-content-full">
                        <div class="license-section">
                            <h3>版权所有 (c) 2026 hilyary</h3>
                            <p>本程序采用 <strong>GNU General Public License Version 3 (GPL v3)</strong> 开源协议。</p>
                            <p>本项目在 GPL v3 协议的基础上，增加以下补充条款：</p>
                        </div>

                        <div class="license-section">
                            <h3>一、GPL v3 协议要点</h3>
                            <p>按照 GPL v3 协议，您可以：</p>
                            <ul>
                                <li>✓ 自由使用、复制、修改和分发本软件</li>
                                <li>✓ 将本软件用于商业目的（但需遵守下方的商业使用限制）</li>
                                <li>✓ 要求修改版本必须以相同协议（GPL v3）开源</li>
                                <li>✓ 要求保留原作者信息和版权声明</li>
                            </ul>
                        </div>

                        <div class="license-section">
                            <h3>二、商业使用限制（补充条款）</h3>
                            <p>虽然 GPL v3 协议允许商业使用，但本项目有额外的商业使用限制：</p>
                            <div class="license-subsection">
                                <h4>未经作者书面许可，禁止商业使用：</h4>
                                <ul class="terms-list-deny">
                                    <li>直接销售本软件或其修改版本</li>
                                    <li>将本软件集成到商业产品中</li>
                                    <li>利用本软件提供付费服务</li>
                                    <li>其他任何形式的商业获利行为</li>
                                </ul>
                            </div>
                            <div class="license-subsection">
                                <h4>如需商业使用授权，请联系：</h4>
                                <p><strong>邮箱：</strong>hil_yary@163.com</p>
                                <p><strong>GitHub：</strong><a href="https://github.com/hilyary/LensAnalysis" target="_blank">https://github.com/hilyary/LensAnalysis</a></p>
                            </div>
                        </div>

                        <div class="license-section">
                            <h3>三、合法使用声明</h3>
                            <p>本软件仅用于合法的内存取证和安全研究目的：</p>
                            <div class="license-subsection">
                                <h4>✅ 允许的用途：</h4>
                                <ul>
                                    <li>个人学习和研究</li>
                                    <li>CTF 竞赛等安全竞赛活动</li>
                                    <li>授权的安全测试和渗透测试</li>
                                    <li>学术研究和教学</li>
                                    <li>应急响应和数字取证（需有合法授权）</li>
                                </ul>
                            </div>
                            <div class="license-subsection">
                                <h4>❌ 禁止的用途：</h4>
                                <ul class="terms-list-deny">
                                    <li>未经授权访问他人计算机系统</li>
                                    <li>窃取他人隐私信息</li>
                                    <li>破坏计算机系统或数据</li>
                                    <li>任何形式的网络攻击活动</li>
                                    <li>其他违反法律法规的行为</li>
                                </ul>
                            </div>
                        </div>

                        <div class="license-section">
                            <h3>四、免责声明</h3>
                            <ol>
                                <li>软件按"现状"提供，作者不对软件的准确性、完整性、可靠性做任何保证。</li>
                                <li>使用本软件所产生的一切后果由使用者自行承担，作者不承担任何责任。</li>
                                <li>因使用本软件导致的任何直接或间接损失，作者概不负责。</li>
                            </ol>
                        </div>

                        <div class="license-section">
                            <h3>五、署名要求</h3>
                            <ul>
                                <li>任何形式的分发、修改或衍生作品，必须明确标注原作者信息</li>
                                <li>不得将修改后的版本作为原作者官方版本发布</li>
                                <li>不得移除或修改软件中的版权声明</li>
                            </ul>
                        </div>

                        <div class="license-section">
                            <h3>六、知识产权</h3>
                            <ol>
                                <li>本软件的所有知识产权归原作者所有</li>
                                <li>Volatility 3 框架的知识产权归其原作者所有</li>
                                <li>本软件使用的第三方库受各自的开源协议约束</li>
                            </ol>
                        </div>

                        <div class="license-footer">
                            <p><strong>使用本软件即表示您已阅读、理解并同意受 GPL v3 协议及补充条款的约束。</strong></p>
                            <p>请确保您的使用行为符合当地法律法规。</p>
                            <p class="license-note">完整协议请查看项目根目录的 LICENSE 文件</p>
                            <p class="license-note">最后更新日期：2026年2月2日</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 系统类型选择对话框 -->
        <div class="confirm-overlay hidden" id="osTypeSelectOverlay">
            <div class="confirm-card" style="max-width: 550px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="url(#osHeaderGrad)" stroke-width="1.5" width="36" height="36">
                        <defs>
                            <linearGradient id="osHeaderGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <!-- Monitor/Desktop icon -->
                        <rect x="2" y="3" width="20" height="13" rx="2" fill="url(#osHeaderGrad)" fill-opacity="0.15"/>
                        <rect x="2" y="3" width="20" height="13" rx="2" stroke="url(#osHeaderGrad)" stroke-width="1.5"/>
                        <!-- Screen content - small icons -->
                        <rect x="5" y="6" width="4" height="4" rx="0.5" fill="url(#osHeaderGrad)" fill-opacity="0.6"/>
                        <circle cx="13" cy="8" r="2" fill="url(#osHeaderGrad)" fill-opacity="0.6"/>
                        <path d="M17 6l2 2-2 2" stroke="url(#osHeaderGrad)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        <!-- Stand -->
                        <line x1="8" y1="19" x2="16" y2="19" stroke="url(#osHeaderGrad)" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="12" y1="16" x2="12" y2="19" stroke="url(#osHeaderGrad)" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <h2 style="margin: 0; font-size: 18px; color: #303133;">选择操作系统类型</h2>
                </div>

                <p style="color: #606266; margin-bottom: 20px; line-height: 1.6;">
                    如果不确定系统类型，可以选择"自动检测"。如果已知道系统类型，直接选择可跳过检测步骤。
                </p>

                <!-- 自动检测按钮（突出显示） -->
                <div style="margin-bottom: 16px;">
                    <button class="os-type-btn auto-detect-btn" onclick="window.forensicsApp.selectOsType('auto')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="40" height="40">
                            <defs>
                                <linearGradient id="autoIconGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e0e7ff;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <!-- Animated search/clock icon -->
                            <circle cx="12" cy="12" r="9" stroke="url(#autoIconGrad)" stroke-width="2"/>
                            <circle cx="12" cy="12" r="7" stroke="url(#autoIconGrad)" stroke-width="1.5" stroke-dasharray="2 2"/>
                            <path d="M12 7v5l3.5 2" stroke="url(#autoIconGrad)" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="12" r="1.5" fill="url(#autoIconGrad)"/>
                            <!-- Magnifying glass effect -->
                            <circle cx="18" cy="18" r="4" stroke="url(#autoIconGrad)" stroke-width="1.5"/>
                            <line x1="21" y1="21" x2="19.5" y2="19.5" stroke="url(#autoIconGrad)" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <span>自动检测（推荐）</span>
                    </button>
                </div>

                <div style="display: flex; align-items: center; gap: 8px; margin: 16px 0;">
                    <div style="flex: 1; height: 1px; background: #dcdfe6;"></div>
                    <span style="color: #909399; font-size: 14px;">或手动选择</span>
                    <div style="flex: 1; height: 1px; background: #dcdfe6;"></div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <button class="os-type-btn" data-os="Windows" onclick="window.forensicsApp.selectOsType('Windows')">
                        <div class="os-icon windows-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                                <rect x="1" y="1" width="10" height="10" rx="1"/>
                                <rect x="13" y="1" width="10" height="10" rx="1"/>
                                <rect x="1" y="13" width="10" height="10" rx="1"/>
                                <rect x="13" y="13" width="10" height="10" rx="1"/>
                            </svg>
                        </div>
                        <span>Windows</span>
                    </button>
                    <button class="os-type-btn" data-os="Linux" onclick="window.forensicsApp.selectOsType('Linux')">
                        <div class="os-icon linux-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
                                <rect x="3" y="4" width="18" height="14" rx="2"/>
                                <path d="M6 8h12M6 11h9M6 14h7" stroke="#FCC624" stroke-width="2" stroke-linecap="round"/>
                                <path d="M3 18h18M8 21h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <span>Linux</span>
                    </button>
                    <button class="os-type-btn" data-os="macOS" onclick="window.forensicsApp.selectOsType('macOS')">
                        <div class="os-icon macos-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                                <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                            </svg>
                        </div>
                        <span>macOS</span>
                    </button>
                </div>

                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button class="confirm-btn cancel-btn" onclick="window.forensicsApp.closeOsTypeSelect()">取消</button>
                </div>
            </div>
        </div>

        <style>
            .os-type-btn {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                padding: 20px;
                background: #f5f7fa;
                border: 2px solid #dcdfe6;
                border-radius: 12px;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .os-type-btn:hover {
                background: #ecf5ff;
                border-color: #409eff;
                transform: translateY(-3px);
                box-shadow: 0 6px 16px rgba(64, 158, 255, 0.2);
            }
            .os-type-btn:hover svg {
                transform: scale(1.08);
            }
            .os-type-btn svg {
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .os-type-btn span {
                font-size: 14px;
                font-weight: 500;
                color: #303133;
            }
            .auto-detect-btn {
                background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                border: none;
            }
            .auto-detect-btn:hover {
                background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
                transform: translateY(-3px);
                box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
            }
            .auto-detect-btn:hover svg {
                transform: scale(1.05) rotate(5deg);
            }
            .auto-detect-btn span {
                color: #ffffff;
                font-weight: 600;
            }
            .auto-detect-btn svg {
                stroke: #ffffff;
            }
            /* OS图标样式 */
            .os-icon {
                width: 56px;
                height: 56px;
                border-radius: 14px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            }
            .windows-icon {
                background: linear-gradient(145deg, #00A4EF 0%, #0078D4 50%, #005A9E 100%);
                color: #ffffff;
                box-shadow: 0 4px 12px rgba(0, 120, 212, 0.35);
            }
            .linux-icon {
                background: linear-gradient(145deg, #FFD54F 0%, #FCC624 50%, #E6B800 100%);
                color: #ffffff;
                box-shadow: 0 4px 12px rgba(252, 198, 36, 0.4);
            }
            .macos-icon {
                background: linear-gradient(145deg, #666666 0%, #444444 50%, #222222 100%);
                color: #ffffff;
                box-shadow: 0 4px 12px rgba(68, 68, 68, 0.35);
            }
            .os-type-btn:hover .windows-icon {
                background: linear-gradient(145deg, #1DB2FF 0%, #00A4EF 50%, #0078D4 100%);
                transform: scale(1.08) translateY(-2px);
                box-shadow: 0 8px 20px rgba(0, 120, 212, 0.45);
            }
            .os-type-btn:hover .linux-icon {
                background: linear-gradient(145deg, #FFE082 0%, #FFD54F 50%, #FBC02D 100%);
                transform: scale(1.08) translateY(-2px);
                box-shadow: 0 8px 20px rgba(252, 198, 36, 0.5);
            }
            .os-type-btn:hover .macos-icon {
                background: linear-gradient(145deg, #888888 0%, #666666 50%, #444444 100%);
                transform: scale(1.08) translateY(-2px);
                box-shadow: 0 8px 20px rgba(68, 68, 68, 0.45);
            }
        </style>

        <!-- 通知组件 -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script>
        (function() {
            'use strict';


            class ForensicsApp {
                constructor() {
                    this.currentImage = null;
                    this.currentResults = null;
                    this.executionStartTime = null;
                    this.isWebView = false;
                    this.api = null;

                    // 分页和筛选
                    this.filteredResults = null;
                    this.currentPage = 1;
                    this.pageSize = 20;
                    this.viewMode = 'scroll'; // 'scroll' or 'pagination'
                    this.sortColumn = null;
                    this.sortDirection = 'asc';
                    this.searchTerm = '';
                    this.filters = []; // 筛选条件数组

                    // 已执行的插件及其结果（用于报告生成）
                    this.executedPlugins = [];

                    // 导出报告状态
                    this._isGeneratingReport = false;
                }

                async init() {
                    // 隐藏启动画面
                    const splashScreen = document.getElementById('splashScreen');
                    const splashStatus = document.querySelector('.splash-status');

                    // 模拟加载步骤
                    const loadingSteps = [
                        '正在初始化...',
                        '加载 Volatility 3 插件...',
                        '准备分析环境...',
                        '就绪！'
                    ];

                    let stepIndex = 0;
                    const loadingInterval = setInterval(() => {
                        if (stepIndex < loadingSteps.length && splashStatus) {
                            splashStatus.textContent = loadingSteps[stepIndex];
                            stepIndex++;
                        }
                    }, 500);

                    // 延迟后隐藏启动画面
                    setTimeout(() => {
                        clearInterval(loadingInterval);
                        if (splashScreen) {
                            splashScreen.classList.add('hidden');
                            // 动画结束后移除元素
                            setTimeout(() => {
                                splashScreen.style.display = 'none';
                            }, 500);
                        }
                    }, 2500);

                    // 调试面板（可选）
                    const debugInfo = document.getElementById('debugInfo');

                    const updateDebug = (msg) => {
                        if (debugInfo) debugInfo.innerHTML += msg + '<br>';
                    };

                    updateDebug('=== 析镜 LensAnalysis 初始化 ===');
                    updateDebug('1. window.pywebview: ' + !!window.pywebview);
                    updateDebug('2. window.pywebview.api: ' + !!(window.pywebview && window.pywebview.api));

                    this.bindEvents();

                    // 等待 pywebview ready 事件
                    document.addEventListener('pywebviewready', async () => {
                        updateDebug('✅ pywebviewready 事件触发!');
                        this.isWebView = true;
                        this.api = window.pywebview.api;
                        updateDebug('模式: 完整模式');
                        updateDebug('API: ' + (this.api ? '可用' : '不可用'));

                        // 检测 Volatility 3 是否已安装
                        const vol3Installed = await this.checkVolatility3();
                        if (vol3Installed) {
                            this.setSystemStatus('Volatility 3 就绪', 'active');
                        } else {
                            this.setSystemStatus('等待 Volatility 3', 'warning');
                        }
                    });

                    // 备用检测
                    setTimeout(async () => {
                        if (!this.isWebView && window.pywebview && window.pywebview.api) {
                            updateDebug('✅ 直接检测到 pywebview.api');
                            this.isWebView = true;
                            this.api = window.pywebview.api;

                            // 检测 Volatility 3
                            const vol3Installed = await this.checkVolatility3();
                            if (vol3Installed) {
                                this.setSystemStatus('Volatility 3 就绪', 'active');
                            } else {
                                this.setSystemStatus('等待 Volatility 3', 'warning');
                            }
                            updateDebug('模式: 完整模式');
                        } else if (!this.isWebView) {
                            updateDebug('⚠️ 使用演示模式');
                            updateDebug('未检测到 pywebview API');
                            this.setSystemStatus('演示模式', 'warning');
                        }
                    }, 1000);

                    updateDebug('初始化完成，等待 API...');
                }

                bindEvents() {
                    // 加载镜像按钮
                    const loadImageBtn = document.getElementById('loadImageBtn');
                    const welcomeLoadBtn = document.getElementById('welcomeLoadBtn');

                    if (loadImageBtn) {
                        loadImageBtn.addEventListener('click', () => this.loadImage());
                    }
                    if (welcomeLoadBtn) {
                        welcomeLoadBtn.addEventListener('click', () => this.loadImage());
                    }

                    // 插件按钮
                    document.querySelectorAll('.sidebar-btn[data-plugin]').forEach(btn => {
                        const plugin = btn.dataset.plugin;
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation(); // 阻止事件冒泡
                            this.runPlugin(plugin);
                        });
                    });

                    // 进程分析子菜单
                    const processAnalysisBtn = document.getElementById('processAnalysisBtn');
                    const processSubmenu = document.getElementById('processSubmenu');

                    if (processAnalysisBtn && processSubmenu) {
                        processAnalysisBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = processSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                processSubmenu.classList.remove('hidden');
                                processAnalysisBtn.classList.add('expanded');
                            } else {
                                processSubmenu.classList.add('hidden');
                                processAnalysisBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 恶意软件检测子菜单
                    const malwareAnalysisBtn = document.getElementById('malwareAnalysisBtn');
                    const malwareAnalysisSubmenu = document.getElementById('malwareAnalysisSubmenu');

                    if (malwareAnalysisBtn && malwareAnalysisSubmenu) {
                        malwareAnalysisBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = malwareAnalysisSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                malwareAnalysisSubmenu.classList.remove('hidden');
                                malwareAnalysisBtn.classList.add('expanded');
                            } else {
                                malwareAnalysisSubmenu.classList.add('hidden');
                                malwareAnalysisBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Linux 进程分析子菜单
                    const linuxProcessAnalysisBtn = document.getElementById('linuxProcessAnalysisBtn');
                    const linuxProcessSubmenu = document.getElementById('linuxProcessSubmenu');

                    if (linuxProcessAnalysisBtn && linuxProcessSubmenu) {
                        linuxProcessAnalysisBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = linuxProcessSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                linuxProcessSubmenu.classList.remove('hidden');
                                linuxProcessAnalysisBtn.classList.add('expanded');
                            } else {
                                linuxProcessSubmenu.classList.add('hidden');
                                linuxProcessAnalysisBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Linux 文件系统子菜单
                    const linuxFilesystemBtn = document.getElementById('linuxFilesystemBtn');
                    const linuxFilesystemSubmenu = document.getElementById('linuxFilesystemSubmenu');

                    if (linuxFilesystemBtn && linuxFilesystemSubmenu) {
                        linuxFilesystemBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = linuxFilesystemSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                linuxFilesystemSubmenu.classList.remove('hidden');
                                linuxFilesystemBtn.classList.add('expanded');
                            } else {
                                linuxFilesystemSubmenu.classList.add('hidden');
                                linuxFilesystemBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Linux 恶意软件检测子菜单
                    const linuxMalwareBtn = document.getElementById('linuxMalwareBtn');
                    const linuxMalwareSubmenu = document.getElementById('linuxMalwareSubmenu');

                    if (linuxMalwareBtn && linuxMalwareSubmenu) {
                        linuxMalwareBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = linuxMalwareSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                linuxMalwareSubmenu.classList.remove('hidden');
                                linuxMalwareBtn.classList.add('expanded');
                            } else {
                                linuxMalwareSubmenu.classList.add('hidden');
                                linuxMalwareBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 进程分析子菜单
                    const macProcessBtn = document.getElementById('macProcessBtn');
                    const macProcessSubmenu = document.getElementById('macProcessSubmenu');
                    if (macProcessBtn && macProcessSubmenu) {
                        macProcessBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macProcessSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macProcessSubmenu.classList.remove('hidden');
                                macProcessBtn.classList.add('expanded');
                            } else {
                                macProcessSubmenu.classList.add('hidden');
                                macProcessBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 网络分析子菜单
                    const macNetworkBtn = document.getElementById('macNetworkBtn');
                    const macNetworkSubmenu = document.getElementById('macNetworkSubmenu');
                    if (macNetworkBtn && macNetworkSubmenu) {
                        macNetworkBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macNetworkSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macNetworkSubmenu.classList.remove('hidden');
                                macNetworkBtn.classList.add('expanded');
                            } else {
                                macNetworkSubmenu.classList.add('hidden');
                                macNetworkBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 文件系统子菜单
                    const macFileSystemBtn = document.getElementById('macFileSystemBtn');
                    const macFileSystemSubmenu = document.getElementById('macFileSystemSubmenu');
                    if (macFileSystemBtn && macFileSystemSubmenu) {
                        macFileSystemBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macFileSystemSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macFileSystemSubmenu.classList.remove('hidden');
                                macFileSystemBtn.classList.add('expanded');
                            } else {
                                macFileSystemSubmenu.classList.add('hidden');
                                macFileSystemBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 内存分析子菜单
                    const macMemoryBtn = document.getElementById('macMemoryBtn');
                    const macMemorySubmenu = document.getElementById('macMemorySubmenu');
                    if (macMemoryBtn && macMemorySubmenu) {
                        macMemoryBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macMemorySubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macMemorySubmenu.classList.remove('hidden');
                                macMemoryBtn.classList.add('expanded');
                            } else {
                                macMemorySubmenu.classList.add('hidden');
                                macMemoryBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 内核分析子菜单
                    const macKernelBtn = document.getElementById('macKernelBtn');
                    const macKernelSubmenu = document.getElementById('macKernelSubmenu');
                    if (macKernelBtn && macKernelSubmenu) {
                        macKernelBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macKernelSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macKernelSubmenu.classList.remove('hidden');
                                macKernelBtn.classList.add('expanded');
                            } else {
                                macKernelSubmenu.classList.add('hidden');
                                macKernelBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 安全分析子菜单
                    const macSecurityBtn = document.getElementById('macSecurityBtn');
                    const macSecuritySubmenu = document.getElementById('macSecuritySubmenu');
                    if (macSecurityBtn && macSecuritySubmenu) {
                        macSecurityBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macSecuritySubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macSecuritySubmenu.classList.remove('hidden');
                                macSecurityBtn.classList.add('expanded');
                            } else {
                                macSecuritySubmenu.classList.add('hidden');
                                macSecurityBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // macOS 系统检查子菜单
                    const macSystemCheckBtn = document.getElementById('macSystemCheckBtn');
                    const macSystemCheckSubmenu = document.getElementById('macSystemCheckSubmenu');
                    if (macSystemCheckBtn && macSystemCheckSubmenu) {
                        macSystemCheckBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = macSystemCheckSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                macSystemCheckSubmenu.classList.remove('hidden');
                                macSystemCheckBtn.classList.add('expanded');
                            } else {
                                macSystemCheckSubmenu.classList.add('hidden');
                                macSystemCheckBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 系统分析子菜单
                    const systemAnalysisBtn = document.getElementById('systemAnalysisBtn');
                    const systemAnalysisSubmenu = document.getElementById('systemAnalysisSubmenu');

                    if (systemAnalysisBtn && systemAnalysisSubmenu) {
                        systemAnalysisBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = systemAnalysisSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                systemAnalysisSubmenu.classList.remove('hidden');
                                systemAnalysisBtn.classList.add('expanded');
                            } else {
                                systemAnalysisSubmenu.classList.add('hidden');
                                systemAnalysisBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 凭证提取子菜单
                    const credentialExtractionBtn = document.getElementById('credentialExtractionBtn');
                    const credentialExtractionSubmenu = document.getElementById('credentialExtractionSubmenu');

                    if (credentialExtractionBtn && credentialExtractionSubmenu) {
                        credentialExtractionBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = credentialExtractionSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                credentialExtractionSubmenu.classList.remove('hidden');
                                credentialExtractionBtn.classList.add('expanded');
                            } else {
                                credentialExtractionSubmenu.classList.add('hidden');
                                credentialExtractionBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 程序痕迹子菜单
                    const programTraceBtn = document.getElementById('programTraceBtn');
                    const programTraceSubmenu = document.getElementById('programTraceSubmenu');

                    if (programTraceBtn && programTraceSubmenu) {
                        programTraceBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = programTraceSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                programTraceSubmenu.classList.remove('hidden');
                                programTraceBtn.classList.add('expanded');
                            } else {
                                programTraceSubmenu.classList.add('hidden');
                                programTraceBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 命令历史子菜单
                    const commandHistoryBtn = document.getElementById('commandHistoryBtn');
                    const commandHistorySubmenu = document.getElementById('commandHistorySubmenu');

                    if (commandHistoryBtn && commandHistorySubmenu) {
                        commandHistoryBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = commandHistorySubmenu.classList.contains('hidden');
                            if (isHidden) {
                                commandHistorySubmenu.classList.remove('hidden');
                                commandHistoryBtn.classList.add('expanded');
                            } else {
                                commandHistorySubmenu.classList.add('hidden');
                                commandHistoryBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // Windows 进程检测子菜单
                    const processDetectionBtn = document.getElementById('processDetectionBtn');
                    const processDetectionSubmenu = document.getElementById('processDetectionSubmenu');

                    if (processDetectionBtn && processDetectionSubmenu) {
                        processDetectionBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isHidden = processDetectionSubmenu.classList.contains('hidden');
                            if (isHidden) {
                                processDetectionSubmenu.classList.remove('hidden');
                                processDetectionBtn.classList.add('expanded');
                            } else {
                                processDetectionSubmenu.classList.add('hidden');
                                processDetectionBtn.classList.remove('expanded');
                            }
                        });
                    }

                    // 初始化：默认显示 Windows 插件
                    this.updatePluginVisibility('Windows');

                    // CTF功能
                    const searchFlagBtn = document.getElementById('searchFlagBtn');
                    if (searchFlagBtn) {
                        searchFlagBtn.addEventListener('click', () => this.searchFlag());
                    }

                    // Linux CTF功能
                    const searchFlagBtnLinux = document.getElementById('searchFlagBtnLinux');
                    if (searchFlagBtnLinux) {
                        searchFlagBtnLinux.addEventListener('click', () => this.searchFlag());
                    }

                    // macOS CTF功能
                    const searchFlagBtnMac = document.getElementById('searchFlagBtnMac');
                    if (searchFlagBtnMac) {
                        searchFlagBtnMac.addEventListener('click', () => this.searchFlag());
                    }

                    // 自定义Flag搜索
                    const customFlagBtn = document.getElementById('customFlagBtn');
                    if (customFlagBtn) {
                        customFlagBtn.addEventListener('click', () => this.customFlagSearch());
                    }

                    // Linux 自定义Flag搜索
                    const customFlagBtnLinux = document.getElementById('customFlagBtnLinux');
                    if (customFlagBtnLinux) {
                        customFlagBtnLinux.addEventListener('click', () => this.customFlagSearch());
                    }

                    // macOS 自定义Flag搜索
                    const customFlagBtnMac = document.getElementById('customFlagBtnMac');
                    if (customFlagBtnMac) {
                        customFlagBtnMac.addEventListener('click', () => this.customFlagSearch());
                    }

                    // 导出功能
                    const exportBtn = document.getElementById('exportBtn');
                    const exportResults = document.getElementById('exportResults');
                    if (exportBtn) exportBtn.addEventListener('click', () => this.generateReport());
                    if (exportResults) exportResults.addEventListener('click', () => this.exportCurrentResults());

                    // 符号表管理
                    const symbolManagerBtn = document.getElementById('symbolManagerBtn');
                    const symbolManagerBtn2 = document.getElementById('symbolManagerBtn2');
                    const symbolManagerClose = document.getElementById('symbolManagerClose');
                    const symbolUploadBtn = document.getElementById('symbolUploadBtn');
                    const downloadLinuxSymbols = document.getElementById('downloadLinuxSymbols');
                    const downloadMacSymbols = document.getElementById('downloadMacSymbols');

                    // 关于按钮
                    const aboutBtn = document.getElementById('aboutBtn');
                    const aboutCloseBtn = document.getElementById('aboutCloseBtn');

                    // 代理设置按钮
                    const proxySettingsBtn = document.getElementById('proxySettingsBtn');
                    const proxyCancelBtn = document.getElementById('proxyCancelBtn');
                    const proxySaveBtn = document.getElementById('proxySaveBtn');
                    const proxyClearBtn = document.getElementById('proxyClearBtn');
                    const proxyTestBtn = document.getElementById('proxyTestBtn');

                    // 关于按钮事件
                    if (aboutBtn) {
                        aboutBtn.addEventListener('click', () => this.openAboutDialog());
                    }
                    if (aboutCloseBtn) {
                        aboutCloseBtn.addEventListener('click', () => this.closeAboutDialog());
                    }

                    // 使用条款弹窗事件
                    const acceptTermsBtn = document.getElementById('acceptTermsBtn');
                    const declineTermsBtn = document.getElementById('declineTermsBtn');
                    const viewTermsBtn = document.getElementById('viewTermsBtn');

                    if (acceptTermsBtn) {
                        acceptTermsBtn.addEventListener('click', async () => {
                            // 保存用户已同意协议到文件
                            const api = window.pywebview && window.pywebview.api;
                            if (api) {
                                await api.save_terms_accepted();
                            }

                            // 同时保存到 localStorage 作为备用
                            localStorage.setItem('lensAnalysis_termsAccepted', 'true');
                            localStorage.setItem('lensAnalysis_termsAcceptedDate', new Date().toISOString());

                            this.closeTermsDialog();

                            // 检查是否是首次同意条款
                            const isFirstLaunch = !localStorage.getItem('lensAnalysis_hasLaunchedBefore');
                            if (isFirstLaunch) {
                                // 标记已经启动过
                                localStorage.setItem('lensAnalysis_hasLaunchedBefore', 'true');
                                // 首次启动，延迟弹出关于页面
                                setTimeout(() => {
                                    this.openAboutDialog();
                                }, 500);
                            }
                        });
                    }

                    if (declineTermsBtn) {
                        declineTermsBtn.addEventListener('click', () => {
                            // 拒绝协议，关闭应用
                            if (window.pywebview) {
                                window.pywebview.api.quit_app();
                            } else {
                                alert('您需要同意使用条款才能使用本软件。');
                                this.closeTermsDialog();
                            }
                        });
                    }

                    if (viewTermsBtn) {
                        viewTermsBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.openTermsReadOnlyDialog();
                        });
                    }

                    // 检查是否需要显示使用条款弹窗（首次启动或未同意）
                    // 放在最后执行，确保启动界面已完全显示
                    const checkAndShowTerms = async () => {
                        const api = window.pywebview && window.pywebview.api;
                        let needsTerms = false;

                        if (api) {
                            // 使用后端 API 检查
                            try {
                                const result = await api.check_terms_accepted();
                                needsTerms = result.status !== 'success' || !result.accepted;
                            } catch (e) {
                                // API 调用失败，降级使用 localStorage
                                needsTerms = !localStorage.getItem('lensAnalysis_termsAccepted');
                            }
                        } else {
                            // 降级使用 localStorage
                            needsTerms = !localStorage.getItem('lensAnalysis_termsAccepted');
                        }

                        if (needsTerms) {
                            setTimeout(() => {
                                this.openTermsDialog();
                            }, 1000);
                        }
                    };

                    // 延迟检查，确保启动动画完成
                    setTimeout(checkAndShowTerms, 500);

                    if (symbolManagerBtn) {
                        symbolManagerBtn.addEventListener('click', () => this.openSymbolManager());
                    }
                    if (symbolManagerBtn2) {
                        symbolManagerBtn2.addEventListener('click', () => this.openSymbolManager());
                    }
                    if (symbolManagerClose) {
                        symbolManagerClose.addEventListener('click', () => this.closeSymbolManager());
                    }
                    if (symbolUploadBtn) {
                        symbolUploadBtn.addEventListener('click', () => this.uploadSymbolFile());
                    }
                    if (downloadLinuxSymbols) {
                        downloadLinuxSymbols.addEventListener('click', () => this.downloadSymbols('linux'));
                    }
                    if (downloadMacSymbols) {
                        downloadMacSymbols.addEventListener('click', () => this.downloadSymbols('mac'));
                    }
                    const downloadWindowsSymbols = document.getElementById('downloadWindowsSymbols');
                    if (downloadWindowsSymbols) {
                        downloadWindowsSymbols.addEventListener('click', () => this.downloadWindowsSymbols());
                    }

                    // 代理设置事件
                    if (proxySettingsBtn) {
                        proxySettingsBtn.addEventListener('click', () => this.openProxySettings());
                    }
                    if (proxyCancelBtn) {
                        proxyCancelBtn.addEventListener('click', () => this.closeProxySettings());
                    }
                    if (proxySaveBtn) {
                        proxySaveBtn.addEventListener('click', () => this.saveProxyConfig());
                    }
                    if (proxyClearBtn) {
                        proxyClearBtn.addEventListener('click', () => this.clearProxyConfig());
                    }
                    if (proxyTestBtn) {
                        proxyTestBtn.addEventListener('click', () => this.testProxy());
                    }

                    // 缓存管理
                    const clearCacheBtn = document.getElementById('clearCacheBtn');
                    if (clearCacheBtn) clearCacheBtn.addEventListener('click', () => this.clearCache());

                    // 搜索和筛选
                    const tableSearch = document.getElementById('tableSearch');
                    const searchBtn = document.getElementById('searchBtn');
                    if (tableSearch) {
                        // 检查是否是页缓存文件插件（数据量大，需要手动搜索）
                        const needsManualSearch = () => {
                            return this.currentPluginId === 'linux_pagecache_files';
                        };

                        if (needsManualSearch()) {
                            // 页缓存文件：显示搜索按钮，禁用实时搜索
                            if (searchBtn) searchBtn.classList.remove('hidden');
                            tableSearch.placeholder = '输入搜索内容后点击按钮...';

                            // 搜索按钮点击事件
                            if (searchBtn) {
                                searchBtn.addEventListener('click', () => {
                                    this.handleSearch(tableSearch.value);
                                });
                            }

                            // 回车键搜索
                            tableSearch.addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') {
                                    this.handleSearch(tableSearch.value);
                                }
                            });
                        } else {
                            // 其他插件：使用实时搜索
                            if (searchBtn) searchBtn.classList.add('hidden');
                            tableSearch.placeholder = '搜索...';
                            const debouncedSearch = this.debounce((value) => this.handleSearch(value), 300);
                            tableSearch.addEventListener('input', (e) => debouncedSearch(e.target.value));
                        }
                    }

                    const filterBtn = document.getElementById('filterBtn');
                    if (filterBtn) {
                        filterBtn.addEventListener('click', () => this.showFilterDialog());
                    }

                    // 分页控制
                    const firstPageBtn = document.getElementById('firstPageBtn');
                    const prevPageBtn = document.getElementById('prevPageBtn');
                    const nextPageBtn = document.getElementById('nextPageBtn');
                    const lastPageBtn = document.getElementById('lastPageBtn');
                    const pageInput = document.getElementById('pageInput');
                    const pageSizeSelect = document.getElementById('pageSizeSelect');
                    const viewModeBtn = document.getElementById('viewModeBtn');

                    if (firstPageBtn) firstPageBtn.addEventListener('click', () => this.goToPage(1));
                    if (prevPageBtn) prevPageBtn.addEventListener('click', () => this.goToPage(this.currentPage - 1));
                    if (nextPageBtn) nextPageBtn.addEventListener('click', () => this.goToPage(this.currentPage + 1));
                    if (lastPageBtn) lastPageBtn.addEventListener('click', () => this.goToPage(this.getTotalPages()));
                    if (pageInput) pageInput.addEventListener('change', (e) => this.goToPage(parseInt(e.target.value) || 1));
                    if (pageSizeSelect) pageSizeSelect.addEventListener('change', (e) => this.changePageSize(parseInt(e.target.value)));
                    if (viewModeBtn) viewModeBtn.addEventListener('click', () => this.toggleViewMode());
                    const dumpAllBtn = document.getElementById('dumpAllBtn');
                    if (dumpAllBtn) dumpAllBtn.addEventListener('click', () => this.dumpAllProcesses());
                    const extractEventlogBtn = document.getElementById('extractEventlogBtn');
                    if (extractEventlogBtn) extractEventlogBtn.addEventListener('click', () => this.extractEventlogs());
                }

                updatePluginVisibility(osType) {
                    /** 根据操作系统类型显示/隐藏插件
                     * @param {string} osType - 'Windows', 'Linux', 'macOS', 'mac', 或 'Unknown'
                     */
                    const osMap = {
                        'Windows': 'windows',
                        'Linux': 'linux',
                        'macOS': 'macos',
                        'mac': 'macos',  // 后端可能返回 'mac'
                        'Mac': 'macos',  // 兼容大小写
                        'MACOS': 'macos',  // 兼容大写
                        'MAC': 'macos',  // 兼容大写
                        'Unknown': 'windows'  // 默认显示 Windows 插件
                    };

                    const targetOS = osMap[osType] || 'windows';

                    // 更新所有 sidebar-section 的可见性
                    document.querySelectorAll('.sidebar-section').forEach(section => {
                        const sectionOS = section.getAttribute('data-os');

                        if (sectionOS) {
                            // 此 section 有 data-os 属性
                            if (sectionOS === targetOS) {
                                section.style.display = 'block';
                            } else {
                                section.style.display = 'none';
                            }
                        } else {
                            // 没有 data-os 属性的 section 保持可见（如：镜像管理、CTF工具）
                            section.style.display = 'block';
                        }
                    });

                    // 更新所有 sidebar-btn 的可见性（用于子菜单项）
                    document.querySelectorAll('.sidebar-btn[data-os]').forEach(btn => {
                        const btnOS = btn.getAttribute('data-os');
                        if (btnOS === targetOS) {
                            btn.style.display = 'flex';
                        } else {
                            btn.style.display = 'none';
                        }
                    });

                    console.log(`[Plugin Visibility] OS类型: ${osType}, 显示插件: ${targetOS}`);
                }

                async loadImage() {
                    // 先弹出系统类型选择对话框
                    this.openOsTypeSelect();
                }

                // 打开系统类型选择对话框
                openOsTypeSelect() {
                    const overlay = document.getElementById('osTypeSelectOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                    }
                }

                // 关闭系统类型选择对话框
                closeOsTypeSelect() {
                    const overlay = document.getElementById('osTypeSelectOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                // 选择系统类型并加载镜像
                async selectOsType(osType) {
                    this.closeOsTypeSelect();

                    // 动态检测 API（每次调用时检查）
                    const api = window.pywebview && window.pywebview.api;

                    if (api) {
                        try {
                            // 如果选择自动检测，显示不同的提示
                            const displayName = osType === 'auto' ? '自动检测中...' : osType;
                            this.toast('info', '加载镜像', osType === 'auto' ? '正在自动检测系统类型并加载镜像...' : `正在加载${osType}镜像，请稍候...`);

                            // 如果选择自动检测，传递null；否则传递选择的系统类型
                            const result = await api.load_memory_image_dialog(osType === 'auto' ? null : osType);

                            if (result.status === 'success') {
                                this.currentImage = result.data;
                                document.getElementById('imageName').textContent = this.currentImage.name;
                                document.getElementById('imageSize').textContent = this.currentImage.size;
                                document.getElementById('imageHash').textContent = this.currentImage.hash;
                                document.getElementById('imagePath').textContent = this.currentImage.path;

                                // 显示操作系统类型（只在成功检测时显示标签）
                                const osType = this.currentImage.os_type || 'Unknown';
                                // 保存当前镜像的OS类型，供其他功能使用
                                this.currentImageOS = osType;
                                if (osType !== 'Unknown') {
                                    const osBadge = document.createElement('span');
                                    osBadge.className = 'os-badge';
                                    osBadge.textContent = osType;
                                    document.getElementById('imageName').appendChild(osBadge);
                                }

                                // 根据OS类型更新插件可见性（Unknown 会默认显示 Windows 插件）
                                this.updatePluginVisibility(osType);

                                document.getElementById('welcomePanel').classList.add('hidden');
                                document.getElementById('imageInfoPanel').classList.remove('hidden');
                                this.setSystemStatus('Volatility 3 就绪', 'active');

                                // 提示消息中不显示 Unknown
                                const displayOsType = osType === 'Unknown' ? '' : ` [${osType}]`;
                                this.toast('success', '镜像加载成功', `已加载${displayOsType} 镜像：` + this.currentImage.name);

                                // 加载完整的符号表状态（包含PDB匹配信息）
                                await this.loadSymbolStatus();

                                // 检查是否需要提示下载符号表
                                const osTypeLower = osType.toLowerCase();
                                const needsSymbols = (osTypeLower === 'linux' || osTypeLower === 'mac' || osTypeLower === 'macos' || osTypeLower === 'windows');

                                // 获取当前OS的符号表匹配状态
                                const currentOsKey = osTypeLower === 'mac' || osTypeLower === 'macos' ? 'mac' : osTypeLower;
                                const symbolInfo = this._symbolStatus?.os_types?.[currentOsKey] || {};
                                let hasMatchingSymbol = false;

                                if (osTypeLower === 'windows' && symbolInfo.pdb_info) {
                                    hasMatchingSymbol = symbolInfo.pdb_info.symbol_exists;
                                } else if ((osTypeLower === 'linux' || osTypeLower === 'mac' || osTypeLower === 'macos') && symbolInfo.kernel_version) {
                                    hasMatchingSymbol = symbolInfo.kernel_symbol_exists;
                                    // 调试日志
                                    console.log(`符号表检查: osType=${osTypeLower}, currentOsKey=${currentOsKey}, kernel_version=${symbolInfo.kernel_version}, kernel_symbol_exists=${symbolInfo.kernel_symbol_exists}, hasMatchingSymbol=${hasMatchingSymbol}`);
                                }

                                if (needsSymbols && !hasMatchingSymbol) {
                                    // 没有匹配的符号表，显示弹窗提示并打开管理界面
                                    setTimeout(() => {
                                        this.showSymbolWarning(osTypeLower);

                                        // 延迟后打开符号表管理对话框
                                        setTimeout(() => {
                                            this.openSymbolManager();
                                        }, 300);
                                    }, 300);
                                }
                            } else {
                                this.toast('error', '加载失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '加载失败', e.message);
                        }
                    } else {
                        // API 不可用，提示用户
                        this.toast('error', '系统错误', '无法连接到后端服务，请确保应用程序正常运行');
                    }
                }

                _promptForSymbol(symbolInfo) {
                    // 保存符号表信息供后续使用
                    this._pendingSymbolInfo = symbolInfo;

                    // 显示右上角 toast 消息提示
                    const osTypeName = symbolInfo.os_type === 'mac' ? 'macOS' : (symbolInfo.os_type.charAt(0).toUpperCase() + symbolInfo.os_type.slice(1));
                    this.toast('warning', '缺少符号表', `检测到 ${osTypeName} 内核版本: ${symbolInfo.kernel_version}\n请安装对应的符号表后再进行分析`, 10000);

                    // 延迟后打开符号表管理对话框
                    setTimeout(() => {
                        this.openSymbolManager();
                    }, 500);
                }

                async runPlugin(pluginId, params = null) {
                    const debugInfo = document.getElementById('debugInfo');
                    const log = (msg) => {
                        if (debugInfo) debugInfo.innerHTML += msg + '<br>';
                    };

                    log('执行插件: ' + pluginId);
                    if (params) log('参数: ' + JSON.stringify(params));

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像');
                        return;
                    }

                    this.setActivePlugin(pluginId);
                    this.executionStartTime = Date.now();

                    // 清除上一个插件的下载按钮状态
                    this.hideDumpAllButton();
                    this.hideExtractEventlogButton();

                    // 显示分析中状态
                    this.showAnalyzingStatus(pluginId);

                    // 强制等待 API 可用，最多等待 5 秒
                    let api = null;
                    for (let i = 0; i < 10; i++) {
                        api = window.pywebview && window.pywebview.api;
                        if (api) break;
                        log('等待 API... (' + (i + 1) + '/10)');
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }

                    if (api) {
                        log('✅ API 可用，调用后端分析...');
                        try {
                            const result = params ?
                                await api.run_analysis_with_params(pluginId, params) :
                                await api.run_analysis(pluginId);
                            log('后端返回状态: ' + result.status);

                            if (result.status === 'success') {
                                const results = result.data.results || [];
                                this.currentResults = results;
                                this.displayResults(results, pluginId);
                                const executionTime = ((Date.now() - this.executionStartTime) / 1000).toFixed(2);
                                this.toast('success', '分析完成', `${pluginId} 耗时 ${executionTime}秒，找到 ${results.length} 条记录`);
                                log('✅ 完成! 找到 ' + results.length + ' 条记录');

                                // 保存插件执行结果（用于报告生成）
                                this._saveExecutedPlugin(pluginId, results, executionTime);

                                // 显示信息提示（如果有）
                                if (result.data._info) {
                                    setTimeout(() => {
                                        this.toast('info', '信息', result.data._info, 5000);
                                    }, 500);
                                }
                            } else {
                                this.hideAnalyzingStatus();
                                log('❌ 分析失败: ' + (result.message || '未知错误'));

                                // 构建错误结果显示
                                const errorResults = [{
                                    _error: result.error_type || 'unknown',
                                    _message: result.message || '未知错误'
                                }];
                                this.currentResults = errorResults;
                                this.displayResults(errorResults, pluginId);

                                // 检查是否为不兼容插件错误
                                if (result.code === 'INCOMPATIBLE_PLUGIN') {
                                    this.toast('warning', '插件不兼容', result.message || '此插件不支持当前操作系统', 5000);
                                } else if (result.error_type === 'not_supported') {
                                    this.toast('warning', '插件不支持', '此插件不支持当前系统版本', 5000);
                                } else if (result.error_type === 'symbol_not_found') {
                                    this.toast('warning', '符号表错误', '未找到匹配的符号表', 5000);
                                } else {
                                    this.toast('error', '分析失败', result.message || '未知错误');
                                }
                            }
                        } catch (e) {
                            this.hideAnalyzingStatus();
                            log('❌ 调用异常: ' + e.message);
                            this.toast('error', '调用失败', e.message);
                        }
                    } else {
                        this.hideAnalyzingStatus();
                        log('❌ API 不可用，请确保应用正常运行');
                        this.toast('error', 'API 不可用', '请重新启动应用');
                    }
                }

                showAnalyzingStatus(pluginId) {
                    const panel = document.getElementById('resultsPanel');
                    const emptyState = document.getElementById('resultsEmpty');
                    const tableContainer = document.getElementById('resultsTableContainer');

                    if (panel) panel.classList.remove('hidden');
                    if (emptyState) emptyState.classList.add('hidden');
                    if (tableContainer) tableContainer.classList.add('hidden');

                    // 恢复默认的 results-header 和 results-stats（Flag搜索可能隐藏了它们）
                    const defaultHeader = panel?.querySelector('.results-header');
                    const defaultStats = panel?.querySelector('.results-stats');
                    if (defaultHeader) defaultHeader.style.display = '';
                    if (defaultStats) defaultStats.style.display = '';

                    // 清空 Flag 搜索结果
                    const flagResults = document.getElementById('flag-search-results');
                    if (flagResults) flagResults.remove();

                    // 更新标题
                    const titleEl = document.getElementById('resultsTitle');
                    if (titleEl) titleEl.textContent = this.getPluginDisplayName(pluginId);

                    // 显示分析中状态
                    const tbody = document.getElementById('resultsTableBody');
                    if (tbody) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="100%" style="text-align:center;padding:60px 20px;">
                                    <div style="display:inline-flex;flex-direction:column;align-items:center;gap:16px;">
                                        <svg style="width:48px;height:48px;animation:spin 1s linear infinite;" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" stroke-dasharray="32" stroke-dashoffset="24" stroke-opacity="0.3"/>
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" stroke-dasharray="8" stroke-dashoffset="0" stroke-linecap="round"/>
                                        </svg>
                                        <div style="font-size:16px;font-weight:500;color:var(--text-secondary);">
                                            正在分析 ${this.getPluginDisplayName(pluginId)}...
                                        </div>
                                        <div style="font-size:13px;color:var(--text-muted);">
                                            请稍候，这可能需要几秒钟
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }

                    // 更新统计
                    const countEl = document.getElementById('resultCount');
                    const timeEl = document.getElementById('executionTime');
                    if (countEl) countEl.textContent = '-';
                    if (timeEl) timeEl.textContent = '-';
                }

                hideAnalyzingStatus() {
                    // 此方法在 displayResults 中会被自动调用
                }

                _saveExecutedPlugin(pluginId, results, executionTime) {
                    // 保存已执行的插件及其结果
                    const existingIndex = this.executedPlugins.findIndex(p => p.pluginId === pluginId);
                    const pluginInfo = {
                        pluginId: pluginId,
                        displayName: this.getPluginDisplayName(pluginId),
                        results: results,
                        count: results.length,
                        executionTime: executionTime,
                        timestamp: new Date().toISOString()
                    };

                    if (existingIndex >= 0) {
                        // 更新已存在的插件结果
                        this.executedPlugins[existingIndex] = pluginInfo;
                    } else {
                        // 添加新的插件结果
                        this.executedPlugins.push(pluginInfo);
                    }

                    console.log(`已保存插件结果: ${pluginId}, 总计: ${this.executedPlugins.length} 个插件`);
                }

                async searchFlag() {

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像');
                        return;
                    }

                    if (this.isWebView) {
                        try {
                            // Windows 系统检测 strings 工具
                            const checkData = await window.pywebview.api.check_strings_tool();

                            if (checkData.status === 'success' && checkData.platform === 'Windows' && !checkData.has_strings) {
                                // Windows 上没有 strings 工具，弹出询问对话框
                                const downloadChoice = confirm(
                                    '检测到 Windows 系统未安装 strings 工具。\n\n' +
                                    '安装 strings 工具后可以大幅提升 Flag 搜索速度：\n' +
                                    '• 使用 strings 工具：约 5-10 秒\n' +
                                    '• 使用 Python 读取：约 30-60 秒\n\n' +
                                    '是否立即从微软官方下载并安装？'
                                );

                                if (downloadChoice) {
                                    // 用户选择下载
                                    this.toast('info', '正在下载', '正在下载 strings 工具，请稍候...');

                                    const downloadData = await window.pywebview.api.download_strings_tool();

                                    if (downloadData.status === 'success') {
                                        this.toast('success', '下载成功', 'strings 工具已安装，Flag 搜索将更快');
                                    } else {
                                        this.toast('warning', '下载失败', downloadData.message + '\n将继续使用 Python 方式搜索');
                                    }
                                } else {
                                    this.toast('info', '使用 Python 搜索', 'Flag 搜索可能较慢（约 30-60 秒）');
                                }
                            }

                            const result = await window.pywebview.api.search_flag();

                            if (result.status === 'searching') {
                                this.toast('info', '正在搜索', 'Flag搜索正在进行中，请稍候...');
                                return;
                            }

                            if (result.status === 'success') {
                                const isCached = result.data.cached;
                                const message = isCached
                                    ? `从缓存加载: 找到 ${result.data.count} 个可能的 Flag`
                                    : `搜索完成: 找到 ${result.data.count} 个可能的 Flag`;

                                this.toast('success', '搜索完成', message);

                                // 显示搜索结果界面
                                this.displayFlagResults(result.data.flags, result.data.count, isCached, null);
                            } else {
                                this.toast('error', '搜索失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '搜索失败', e.message);
                        }
                    } else {
                        setTimeout(() => {
                            this.toast('success', '搜索完成', '找到 2 个可能的 Flag');
                            // 模拟结果
                            this.displayFlagResults([
                                { offset: '0x12345678', matched_string: 'flag{test_flag_123}' },
                                { offset: '0x87654321', matched_string: 'CTF{another_flag}' }
                            ], 2, false, null);
                        }, 600);
                    }
                }

                displayFlagResults(flags, count, isCached, searchPattern = null) {
                    // 显示Flag搜索结果界面
                    const mainContent = document.querySelector('main.content');
                    const resultsPanel = document.getElementById('resultsPanel');
                    const existingResults = document.getElementById('flag-search-results');

                    // 隐藏"全部提取文件"等操作按钮（Flag搜索不需要这些）
                    this.hideDumpAllButton();

                    // 确定插件ID和显示名称
                    const pluginId = searchPattern ? `flag_search_custom:${searchPattern}` : 'flag_search_default';
                    const displayName = searchPattern ? `Flag搜索: ${searchPattern}` : 'Flag搜索（默认）';

                    // 保存到已执行插件列表
                    const pluginInfo = {
                        pluginId: pluginId,
                        displayName: displayName,
                        results: flags,
                        count: count,
                        executionTime: 0, // Flag搜索没有执行时间
                        timestamp: new Date().toISOString(),
                        isFlagSearch: true
                    };

                    // 检查是否已存在相同插件ID的记录
                    const existingIndex = this.executedPlugins.findIndex(p => p.pluginId === pluginId);
                    if (existingIndex >= 0) {
                        // 更新已存在的记录
                        this.executedPlugins[existingIndex] = pluginInfo;
                    } else {
                        // 添加新记录
                        this.executedPlugins.push(pluginInfo);
                    }

                    console.log(`已保存Flag搜索结果: ${pluginId}, 总计: ${this.executedPlugins.length} 个插件`);

                    // 确保结果面板可见
                    if (resultsPanel) {
                        resultsPanel.classList.remove('hidden');
                        const welcomePanel = document.getElementById('welcomePanel');
                        if (welcomePanel) {
                            welcomePanel.classList.add('hidden');
                        }

                        // 隐藏默认的 results-header, results-stats, resultsTableContainer
                        const defaultHeader = resultsPanel.querySelector('.results-header');
                        const defaultStats = resultsPanel.querySelector('.results-stats');
                        const tableContainer = document.getElementById('resultsTableContainer');
                        const emptyState = document.getElementById('resultsEmpty');

                        if (defaultHeader) defaultHeader.style.display = 'none';
                        if (defaultStats) defaultStats.style.display = 'none';
                        if (tableContainer) tableContainer.classList.add('hidden');
                        if (emptyState) emptyState.classList.add('hidden');
                    }

                    // 移除旧的结果
                    if (existingResults) {
                        existingResults.remove();
                    }

                    // 创建结果容器
                    const resultsDiv = document.createElement('div');
                    resultsDiv.id = 'flag-search-results';
                    resultsDiv.className = 'plugin-result';
                    resultsDiv.innerHTML = `
                        <div class="flag-search-header">
                            <div class="flag-search-title">
                                <div class="title-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="M21 21l-4.35-4.35"/>
                                        <path d="M11 8v6M8 11h6"/>
                                    </svg>
                                </div>
                                <div class="title-text">
                                    <h2>Flag 搜索结果</h2>
                                    <p>${searchPattern ? `自定义搜索: ${searchPattern}` : 'CTF 竞赛旗帜查找'}</p>
                                </div>
                            </div>
                            <div class="flag-search-stats">
                                <div class="stat-card ${count > 0 ? 'success' : 'empty'}">
                                    <span class="stat-number">${count}</span>
                                    <span class="stat-label">找到 Flag</span>
                                </div>
                            </div>
                        </div>
                        <div class="flag-search-content">
                            ${flags.length === 0 ? `
                                <div class="no-results">
                                    <div class="no-results-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="64" height="64">
                                            <circle cx="11" cy="11" r="8"/>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                        </svg>
                                    </div>
                                    <h3>未找到常见格式的 Flag</h3>
                                    <p>内存镜像中不包含标准格式的旗帜</p>
                                </div>
                            ` : `
                                <table class="flag-table">
                                    <thead>
                                        <tr>
                                            <th width="25%">偏移地址</th>
                                            <th width="75%">匹配内容</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${flags.map(flag => `
                                            <tr>
                                                <td class="monospace">${this.escapeHtml(flag.offset || flag.address || 'N/A')}</td>
                                                <td class="monospace highlight">${this.escapeHtml(flag.matched_string || flag.content || '')}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            `}
                        </div>
                    `;

                    // 直接添加到 resultsPanel，不清空它
                    if (resultsPanel) {
                        resultsPanel.appendChild(resultsDiv);
                    } else if (mainContent) {
                        mainContent.appendChild(resultsDiv);
                    }
                }

                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                async customFlagSearch() {
                    // 检查是否正在搜索
                    if (this._isFlagSearching) {
                        this.toast('warning', '正在搜索', 'Flag搜索正在进行中，请稍候...');
                        return;
                    }

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像');
                        return;
                    }

                    // 加载搜索历史并显示对话框
                    const historyResult = await window.pywebview.api.get_flag_search_history();

                    if (historyResult.status === 'success') {
                        this.showCustomFlagDialog(historyResult.data.history || []);
                    } else {
                        this.toast('error', '加载历史失败', historyResult.message || '未知错误');
                    }
                }

                showCustomFlagDialog(history) {
                    // 移除旧对话框
                    const oldDialog = document.getElementById('customFlagDialog');
                    if (oldDialog) oldDialog.remove();

                    // 创建对话框
                    const dialog = document.createElement('div');
                    dialog.id = 'customFlagDialog';
                    dialog.className = 'custom-flag-dialog';
                    dialog.innerHTML = `
                        <div class="dialog-overlay"></div>
                        <div class="dialog-container">
                            <div class="dialog-header">
                                <div class="dialog-title">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="24" height="24">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="M21 21l-4.35-4.35"/>
                                        <path d="M11 8v6M8 11h6"/>
                                    </svg>
                                    <div>
                                        <h2>自定义 Flag 搜索</h2>
                                        <p>输入正则表达式搜索特定格式的旗帜</p>
                                    </div>
                                </div>
                                <button class="dialog-close" onclick="document.getElementById('customFlagDialog')?.remove()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>

                            <div class="dialog-body">
                                <!-- 搜索输入区 -->
                                <div class="search-input-area">
                                    <div class="input-group">
                                        <input type="text" id="customPatternInput" class="search-input"
                                               placeholder="输入正则表达式 (例如: flag\\{[^}]+\\})"
                                               onkeypress="if(event.key === 'Enter') window.forensicsApp.executeCustomFlagSearch()">
                                        <button class="search-btn" onclick="window.forensicsApp.executeCustomFlagSearch()">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                                <circle cx="11" cy="11" r="8"/>
                                                <path d="M21 21l-4.35-4.35"/>
                                                <path d="M11 8v6M8 11h6"/>
                                            </svg>
                                            搜索
                                        </button>
                                    </div>
                                    <div class="input-hint">
                                        💡 支持正则表达式：<code>flag\{[^}]+\}</code>, <code>\d{32}</code>, <code>[A-F0-9]{32}</code>
                                    </div>
                                </div>

                                <!-- 搜索历史 -->
                                <div class="search-history">
                                    <div class="history-header">
                                        <h3>搜索历史</h3>
                                        <span class="history-count">${history.length} 条记录</span>
                                    </div>
                                    ${history.length === 0 ? `
                                        <div class="history-empty">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                                                <circle cx="12" cy="12" r="10"/>
                                                <path d="M12 6v6l4 2"/>
                                            </svg>
                                            <p>暂无搜索历史</p>
                                        </div>
                                    ` : `
                                        <div class="history-list">
                                            ${history.map(item => `
                                                <div class="history-item" data-cache-key="${item.cache_key}">
                                                    <div class="history-info" onclick="window.forensicsApp.loadFlagSearchResult('${item.cache_key}')">
                                                        <div class="history-pattern">${this.escapeHtml(item.display_name)}</div>
                                                        <div class="history-meta">
                                                            <span class="history-count">${item.count} 个结果</span>
                                                            <span class="history-time">${this.formatTime(item.timestamp)}</span>
                                                        </div>
                                                    </div>
                                                    <div class="history-actions">
                                                        <button class="icon-btn" onclick="window.forensicsApp.loadFlagSearchResult('${item.cache_key}')" title="查看结果">
                                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                                                <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                                                                <path d="M2.058 7.513a10.951 10.951 0 0 1 15.884-3.286"/>
                                                                <path d="M2.058 16.487a10.951 10.951 0 0 1 15.884 3.286"/>
                                                            </svg>
                                                        </button>
                                                        <button class="icon-btn danger" onclick="window.forensicsApp.deleteFlagSearchResult('${item.cache_key}')" title="删除">
                                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                                                <polyline points="3 6 5 6 21 6"></polyline>
                                                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(dialog);

                    // 聚焦输入框
                    setTimeout(() => {
                        const input = document.getElementById('customPatternInput');
                        if (input) input.focus();
                    }, 100);
                }

                async executeCustomFlagSearch() {
                    // 防止重复搜索
                    if (this._isFlagSearching) {
                        this.toast('warning', '搜索中', 'Flag搜索正在进行中，请稍候...');
                        return;
                    }

                    const input = document.getElementById('customPatternInput');
                    if (!input) return;

                    const pattern = input.value.trim();
                    if (!pattern) {
                        this.toast('warning', '输入为空', '请输入搜索模式');
                        return;
                    }

                    // 设置搜索状态
                    this._isFlagSearching = true;

                    // 先检查缓存中是否有相同关键词的结果
                    const cacheKey = 'custom:' + pattern;
                    if (this.isWebView) {
                        try {
                            // 尝试从缓存获取结果
                            const cachedResult = await window.pywebview.api.get_cached_flag_result(cacheKey);

                            if (cachedResult.status === 'success' && cachedResult.data) {
                                // 找到缓存结果，直接显示
                                document.getElementById('customFlagDialog')?.remove();
                                this.toast('success', '从缓存加载', `找到 ${cachedResult.data.count} 个匹配结果`);
                                this.displayFlagResults(cachedResult.data.flags, cachedResult.data.count, false, pattern);
                                this._isFlagSearching = false;
                                return;
                            }
                        } catch (e) {
                            // 缓存检查失败，继续执行搜索
                            console.log('缓存检查失败，执行搜索:', e.message);
                        }
                    }

                    // 显示开始搜索提示
                    this.toast('info', '开始搜索', `正在搜索: ${pattern}`);

                    // 执行搜索
                    if (this.isWebView) {
                        try {
                            const result = await window.pywebview.api.search_flag([pattern], false);

                            if (result.status === 'searching') {
                                // 搜索中 - 显示提示但不关闭弹窗
                                this.toast('warning', '正在搜索', 'Flag搜索正在进行中，请稍候...');
                                this._isFlagSearching = false;
                                return;
                            }

                            // 搜索完成或从缓存加载 - 关闭弹窗
                            document.getElementById('customFlagDialog')?.remove();

                            if (result.status === 'success') {
                                const isCached = result.data.cached;
                                const message = isCached
                                    ? `从缓存加载: 找到 ${result.data.count} 个匹配项`
                                    : `搜索完成: 找到 ${result.data.count} 个匹配项`;

                                this.toast('success', '搜索完成', message);
                                this.displayFlagResults(result.data.flags, result.data.count, false, pattern);
                            } else {
                                this.toast('error', '搜索失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            // 发生错误 - 关闭弹窗
                            document.getElementById('customFlagDialog')?.remove();
                            this.toast('error', '搜索失败', e.message);
                        } finally {
                            // 重置搜索状态
                            this._isFlagSearching = false;
                        }
                    }
                }

                async loadFlagSearchResult(cacheKey) {
                    if (this.isWebView) {
                        try {
                            // 关闭对话框
                            document.getElementById('customFlagDialog')?.remove();

                            // 使用新的后端 API 直接获取缓存结果
                            const result = await window.pywebview.api.get_cached_flag_result(cacheKey);

                            if (result.status === 'success') {
                                this.toast('success', '已加载', `从缓存加载: ${result.data.count} 个结果`);
                                // 从 cacheKey 提取 pattern
                                const pattern = cacheKey.startsWith('custom:') ? cacheKey.substring(7) : null;
                                this.displayFlagResults(result.data.flags, result.data.count, true, pattern);
                            } else if (result.status === 'searching') {
                                this.toast('info', '正在搜索', '搜索正在进行中...');
                            } else {
                                this.toast('error', '加载失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '加载失败', e.message);
                        }
                    }
                }

                async _loadCachedFlagResult(cacheKey) {
                    // 这个方法现在通过 get_cached_flag_result 后端 API 实现
                    return null;
                }

                async deleteFlagSearchResult(cacheKey) {
                    // 显示自定义确认对话框
                    const confirmed = await this.showDeleteConfirmDialog();
                    if (!confirmed) return;

                    if (this.isWebView) {
                        try {
                            const result = await window.pywebview.api.delete_flag_search_result(cacheKey);

                            if (result.status === 'success') {
                                this.toast('success', '已删除', '搜索记录已删除');
                                // 刷新对话框
                                const historyResult = await window.pywebview.api.get_flag_search_history();
                                if (historyResult.status === 'success') {
                                    this.showCustomFlagDialog(historyResult.data.history || []);
                                }
                            } else {
                                this.toast('error', '删除失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '删除失败', e.message);
                        }
                    }
                }

                showDeleteConfirmDialog() {
                    return new Promise((resolve) => {
                        // 移除旧对话框
                        const oldDialog = document.getElementById('deleteConfirmDialog');
                        if (oldDialog) oldDialog.remove();

                        // 创建对话框
                        const dialog = document.createElement('div');
                        dialog.id = 'deleteConfirmDialog';
                        dialog.className = 'delete-confirm-dialog';
                        dialog.innerHTML = `
                            <div class="dialog-overlay"></div>
                            <div class="dialog-container">
                                <div class="dialog-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="32" height="32">
                                        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </div>
                                <h3>确认删除</h3>
                                <p>确定要删除这条搜索记录吗？<br>删除后将无法恢复。</p>
                                <div class="dialog-actions">
                                    <button class="btn-cancel" onclick="document.getElementById('deleteConfirmDialog')?.dispatchEvent(new CustomEvent('cancel'))">
                                        取消
                                    </button>
                                    <button class="btn-delete" onclick="document.getElementById('deleteConfirmDialog')?.dispatchEvent(new CustomEvent('confirm'))">
                                        删除
                                    </button>
                                </div>
                            </div>
                        `;

                        document.body.appendChild(dialog);

                        // 添加事件监听
                        dialog.addEventListener('confirm', () => {
                            dialog.remove();
                            resolve(true);
                        });

                        dialog.addEventListener('cancel', () => {
                            dialog.remove();
                            resolve(false);
                        });

                        // 点击遮罩关闭
                        dialog.querySelector('.dialog-overlay').addEventListener('click', () => {
                            dialog.remove();
                            resolve(false);
                        });
                    });
                }

                formatTime(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diff = now - date;

                    if (diff < 60000) {
                        return '刚刚';
                    } else if (diff < 3600000) {
                        return Math.floor(diff / 60000) + '分钟前';
                    } else if (diff < 86400000) {
                        return Math.floor(diff / 3600000) + '小时前';
                    } else {
                        return date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    }
                }

                promptForInput(title, message, defaultValue = '') {
                    return new Promise((resolve) => {
                        if (this.isWebView) {
                            // 在 PyWebView 中使用自定义对话框
                            const dialog = document.createElement('div');
                            dialog.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;';
                            dialog.innerHTML = `
                                <div style="background:white;padding:24px;border-radius:12px;max-width:400px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,0.2);">
                                    <h3 style="margin:0 0 16px 0;color:#0f172a;font-size:18px;">${title}</h3>
                                    <p style="margin:0 0 16px 0;color:#64748b;font-size:14px;">${message}</p>
                                    <input type="text" id="customFlagInput" value="${defaultValue}" style="width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:6px;font-size:14px;margin-bottom:16px;box-sizing:border-box;" placeholder="正则表达式">
                                    <div style="display:flex;gap:8px;justify-content:flex-end;">
                                        <button id="cancelBtn" style="padding:8px 16px;background:#f1f5f9;border:none;border-radius:6px;color:#64748b;cursor:pointer;font-size:14px;">取消</button>
                                        <button id="confirmBtn" style="padding:8px 16px;background:#3b82f6;border:none;border-radius:6px;color:white;cursor:pointer;font-size:14px;">搜索</button>
                                    </div>
                                </div>
                            `;
                            document.body.appendChild(dialog);

                            const input = dialog.querySelector('#customFlagInput');
                            const cancelBtn = dialog.querySelector('#cancelBtn');
                            const confirmBtn = dialog.querySelector('#confirmBtn');

                            const close = (result) => {
                                document.body.removeChild(dialog);
                                resolve(result);
                            };

                            cancelBtn.onclick = () => close(null);
                            confirmBtn.onclick = () => close(input.value);
                            input.onkeydown = (e) => {
                                if (e.key === 'Enter') close(input.value);
                                if (e.key === 'Escape') close(null);
                            };
                            setTimeout(() => input.focus(), 100);
                        } else {
                            // 非 WebView 环境
                            const result = window.prompt(message, defaultValue);
                            resolve(result);
                        }
                    });
                }

                _showReportExportDialog() {
                    return new Promise((resolve) => {
                        // 创建弹窗
                        const overlay = document.createElement('div');
                        overlay.id = 'reportExportOverlay';
                        overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;';

                        const dialog = document.createElement('div');
                        dialog.style.cssText = 'background:white;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.2);width:600px;max-width:90vw;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;';

                        // 格式选择状态
                        window.__selectedExportFormat = 'markdown';

                        dialog.innerHTML = `
                            <div style="padding:24px;border-bottom:1px solid #eee;">
                                <h3 style="margin:0;font-size:18px;color:var(--text-primary);">导出报告</h3>
                            </div>

                            <div style="padding:24px;overflow-y:auto;flex:1;">
                                <!-- 格式选择 -->
                                <div style="margin-bottom:24px;">
                                    <label style="display:block;font-weight:600;margin-bottom:12px;color:var(--text-primary);">报告格式</label>
                                    <div style="display:flex;gap:12px;">
                                        <div class="format-option" data-format="markdown" style="flex:1;cursor:pointer;border:2px solid var(--primary);background:var(--primary);border-radius:8px;padding:14px;transition:all 0.2s;">
                                            <div style="display:flex;align-items:center;gap:10px;">
                                                <input type="radio" name="reportFormat" value="markdown" checked style="margin:0;">
                                                <div style="flex:1;">
                                                    <div style="font-size:15px;font-weight:600;color:white;">Markdown 文档</div>
                                                    <div style="font-size:12px;color:rgba(255,255,255,0.8);margin-top:2px;">.md 格式，纯文本</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="format-option" data-format="docx" style="flex:1;cursor:pointer;border:2px solid #e0e0e0;background:white;border-radius:8px;padding:14px;transition:all 0.2s;">
                                            <div style="display:flex;align-items:center;gap:10px;">
                                                <input type="radio" name="reportFormat" value="docx" style="margin:0;">
                                                <div style="flex:1;">
                                                    <div style="font-size:15px;font-weight:600;color:var(--text-primary);">Word 文档</div>
                                                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">.docx 格式，数据量大时较慢</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 插件选择 -->
                                <div>
                                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                                        <label style="font-weight:600;color:var(--text-primary);">选择要包含的分析结果</label>
                                        <button id="toggleAllPlugins" style="padding:4px 12px;font-size:13px;background:var(--primary);color:white;border:none;border-radius:4px;cursor:pointer;">全选</button>
                                    </div>
                                    <div id="pluginList" style="max-height:200px;overflow-y:auto;border:1px solid #ddd;border-radius:4px;padding:8px;">
                                    </div>
                                </div>
                            </div>

                            <div style="padding:16px 24px;border-top:1px solid #eee;display:flex;justify-content:flex-end;gap:12px;">
                                <button id="cancelExport" style="padding:8px 20px;background:transparent;border:1px solid #ddd;border-radius:6px;cursor:pointer;font-size:14px;">取消</button>
                                <button id="confirmExport" style="padding:8px 20px;background:var(--primary);color:white;border:none;border-radius:6px;cursor:pointer;font-size:14px;">导出</button>
                            </div>
                        `;

                        overlay.appendChild(dialog);
                        document.body.appendChild(overlay);

                        // 格式选择 - 点击整个div都能选择
                        const formatOptions = dialog.querySelectorAll('.format-option');
                        formatOptions.forEach(option => {
                            option.addEventListener('click', (e) => {
                                const radio = option.querySelector('input[type="radio"]');
                                if (radio) {
                                    radio.checked = true;
                                    window.__selectedExportFormat = radio.value;

                                    // 更新样式
                                    formatOptions.forEach(opt => {
                                        const r = opt.querySelector('input[type="radio"]');
                                        if (r && r.checked) {
                                            opt.style.borderColor = 'var(--primary)';
                                            opt.style.background = 'var(--primary)';
                                            const title = opt.querySelector('.format-title, div > div:first-child');
                                            const desc = opt.querySelector('.format-desc, div > div:last-child');
                                            if (title) { title.style.color = 'white'; }
                                            if (desc) { desc.style.color = 'rgba(255,255,255,0.8)'; }
                                        } else {
                                            opt.style.borderColor = '#e0e0e0';
                                            opt.style.background = 'white';
                                            const title = opt.querySelector('.format-title, div > div:first-child');
                                            const desc = opt.querySelector('.format-desc, div > div:last-child');
                                            if (title) { title.style.color = 'var(--text-primary)'; }
                                            if (desc) { desc.style.color = 'var(--text-muted)'; }
                                        }
                                    });
                                }
                            });
                        });

                        // 生成插件列表 - 卡片式，一行两个
                        const pluginList = dialog.querySelector('#pluginList');
                        pluginList.style.cssText = 'display:grid;grid-template-columns:repeat(2, 1fr);gap:16px;align-items:start;';

                        this.executedPlugins.forEach(p => {
                            const card = document.createElement('div');
                            card.className = 'plugin-card';
                            card.dataset.pluginId = p.pluginId;
                            card.style.cssText = `
                                position: relative;
                                border: 1px solid #e8e8e8;
                                background: white;
                                border-radius: 12px;
                                padding: 16px;
                                cursor: pointer;
                                transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
                                box-shadow: 0 1px 3px rgba(0,0,0,0.04);
                            `;

                            card.innerHTML = `
                                <input type="checkbox" value="${p.pluginId}" checked style="position:absolute;top:16px;left:16px;margin:0;width:18px;height:18px;cursor:pointer;">
                                <div style="margin-left:32px;">
                                    <div style="font-weight:500;font-size:15px;color:#1a1a1a;margin-bottom:6px;letter-spacing:0.3px;">${p.displayName}</div>
                                    <div style="font-size:12px;color:#999;font-family:monospace;margin-bottom:4px;">${p.pluginId}</div>
                                    <div style="font-size:13px;color:#666;">${p.count} 条结果</div>
                                </div>
                            `;

                            card._pluginData = p;
                            pluginList.appendChild(card);

                            // 点击卡片切换选中状态
                            card.addEventListener('click', (e) => {
                                if (e.target.type !== 'checkbox') {
                                    const cb = card.querySelector('input[type="checkbox"]');
                                    cb.checked = !cb.checked;
                                }

                                if (card.querySelector('input[type="checkbox"]').checked) {
                                    card.style.borderColor = 'var(--primary)';
                                    card.style.background = 'linear-gradient(135deg, #f8fbff 0%, #f0f7ff 100%)';
                                    card.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.15)';
                                } else {
                                    card.style.borderColor = '#e8e8e8';
                                    card.style.background = 'white';
                                    card.style.boxShadow = '0 1px 3px rgba(0,0,0,0.04)';
                                }
                            });

                            // 初始状态设置
                            card.style.borderColor = 'var(--primary)';
                            card.style.background = 'linear-gradient(135deg, #f8fbff 0%, #f0f7ff 100%)';
                            card.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.15)';
                        });

                        const checkboxes = pluginList.querySelectorAll('input[type="checkbox"]');
                        const cards = pluginList.querySelectorAll('.plugin-card');
                        const toggleAllBtn = dialog.querySelector('#toggleAllPlugins');
                        const cancelBtn = dialog.querySelector('#cancelExport');
                        const confirmBtn = dialog.querySelector('#confirmExport');
                        let allSelected = true;

                        toggleAllBtn.addEventListener('click', () => {
                            allSelected = !allSelected;
                            checkboxes.forEach(cb => {
                                cb.checked = allSelected;
                                const card = cb.closest('.plugin-card');
                                if (allSelected) {
                                    card.style.borderColor = 'var(--primary)';
                                    card.style.background = 'linear-gradient(135deg, #f8fbff 0%, #f0f7ff 100%)';
                                    card.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.15)';
                                } else {
                                    card.style.borderColor = '#e8e8e8';
                                    card.style.background = 'white';
                                    card.style.boxShadow = '0 1px 3px rgba(0,0,0,0.04)';
                                }
                            });
                            toggleAllBtn.textContent = allSelected ? '取消全选' : '全选';
                        });

                        cancelBtn.addEventListener('click', () => {
                            overlay.remove();
                            resolve(null);
                        });

                        confirmBtn.addEventListener('click', () => {
                            const selectedPlugins = [];
                            checkboxes.forEach(cb => {
                                if (cb.checked) {
                                    const card = cb.closest('.plugin-card');
                                    if (card && card._pluginData) {
                                        selectedPlugins.push(card._pluginData);
                                    }
                                }
                            });

                            overlay.remove();

                            if (selectedPlugins.length === 0) {
                                this.toast('warning', '未选择', '请至少选择一个分析结果');
                                resolve(null);
                                return;
                            }

                            // Word格式提示
                            if (window.__selectedExportFormat === 'docx') {
                                const totalRecords = selectedPlugins.reduce((sum, p) => sum + (p.count || 0), 0);
                                if (totalRecords > 1000) {
                                    this.toast('info', '正在生成', `Word格式包含 ${totalRecords} 条记录，可能需要较长时间...`);
                                }
                            }

                            resolve({
                                format: window.__selectedExportFormat,
                                plugins: selectedPlugins
                            });
                        });

                        overlay.addEventListener('click', (e) => {
                            if (e.target === overlay) {
                                overlay.remove();
                                resolve(null);
                            }
                        });
                    });
                }

                async generateReport() {
                    // 检查是否正在生成报告
                    if (this._isGeneratingReport) {
                        this.toast('warning', '请稍候', '报告正在生成中，请等待完成后再试');
                        return;
                    }

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像并执行分析');
                        return;
                    }

                    // 从缓存加载插件列表
                    if (this.isWebView) {
                        try {
                            const result = await window.pywebview.api.get_cached_plugins();

                            if (result.status === 'error') {
                                this.toast('error', '加载失败', result.message || '无法获取缓存插件列表');
                                return;
                            }

                            const cachedPlugins = result.data.plugins || [];

                            if (cachedPlugins.length === 0) {
                                this.toast('warning', '无分析数据', '请先执行至少一个插件分析');
                                return;
                            }

                            // 使用缓存的插件列表
                            this.executedPlugins = cachedPlugins;

                        } catch (e) {
                            // 如果后端API不存在，使用内存中的列表
                            console.log('get_cached_plugins API不可用，使用内存中的插件列表:', e.message);
                            if (this.executedPlugins.length === 0) {
                                this.toast('warning', '无分析数据', '请先执行至少一个插件分析');
                                return;
                            }
                        }
                    } else {
                        if (this.executedPlugins.length === 0) {
                            this.toast('warning', '无分析数据', '请先执行至少一个插件分析');
                            return;
                        }
                    }

                    // 显示报告导出弹窗
                    const selectedPlugins = await this._showReportExportDialog();
                    if (!selectedPlugins) {
                        return; // 用户取消
                    }

                    // 设置生成中状态
                    this._isGeneratingReport = true;

                    // 显示生成中提示
                    const loadingToast = this._showLoadingToast('正在生成报告，请稍候...');

                    if (this.isWebView) {
                        try {
                            // 准备报告数据
                            const reportData = {
                                image_info: this.currentImage,
                                plugins: selectedPlugins.plugins.map(p => ({
                                    plugin_id: p.pluginId,
                                    display_name: p.displayName,
                                    results: p.results,
                                    count: p.count,
                                    execution_time: p.executionTime,
                                    timestamp: p.timestamp
                                })),
                                format: selectedPlugins.format,
                                generated_at: new Date().toISOString()
                            };

                            console.log('开始生成报告，格式:', selectedPlugins.format);
                            const result = await window.pywebview.api.generate_report_with_data(reportData);
                            console.log('报告生成结果:', result);

                            // 移除加载提示
                            this._hideLoadingToast(loadingToast);

                            if (result.status === 'success') {
                                this.toast('success', '报告已生成', `已导出 ${selectedPlugins.plugins.length} 个插件的分析结果\n文件: ${result.data.path}`);
                            } else {
                                this.toast('error', '生成失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            console.error('报告生成异常:', e);
                            this._hideLoadingToast(loadingToast);
                            this.toast('error', '生成失败', e.message || '未知错误');
                        } finally {
                            // 重置生成中状态
                            this._isGeneratingReport = false;
                        }
                    } else {
                        this._hideLoadingToast(loadingToast);
                        this._isGeneratingReport = false;
                        this.toast('success', '报告已生成', '/path/to/report.' + selectedPlugins.format);
                    }
                }

                async exportCurrentResults() {
                    if (!this.currentResults) {
                        this.toast('warning', '无数据', '请先执行分析');
                        return;
                    }

                    if (this.isWebView) {
                        try {
                            const result = await window.pywebview.api.export_results(this.currentResults, 'csv');
                            if (result.status === 'success') {
                                this.toast('success', '导出成功', `已导出 ${result.data.count} 条记录到 ${result.data.path}`);
                            } else {
                                this.toast('error', '导出失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '导出失败', e.message);
                        }
                    } else {
                        this.toast('success', '导出成功', '已导出 ' + this.currentResults.length + ' 条记录');
                    }
                }

                async clearCache() {
                    if (this.isWebView) {
                        try {
                            const result = await window.pywebview.api.clear_cache();
                            if (result.status === 'success') {
                                this.toast('success', '缓存已清除', result.message);
                            } else {
                                this.toast('error', '清除失败', result.message || '未知错误');
                            }
                        } catch (e) {
                            this.toast('error', '清除失败', e.message);
                        }
                    } else {
                        this.toast('success', '缓存已清除', '所有缓存数据已被删除');
                    }
                }

                // ==================== 符号表管理 ====================

                async openSymbolManager() {
                    const overlay = document.getElementById('symbolManagerOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                        // 先显示加载状态，然后异步加载实际数据
                        this.showSymbolStatusLoading();
                        await this.loadSymbolStatus();
                        // loadSymbolStatus 完成后会自动调用 updateDownloadButtons
                    }
                }

                // ==================== 关于对话框 ====================

                openAboutDialog() {
                    const overlay = document.getElementById('aboutOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                    }
                }

                closeAboutDialog() {
                    const overlay = document.getElementById('aboutOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                // ==================== 使用条款弹窗 ====================

                openTermsDialog() {
                    const overlay = document.getElementById('termsOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                    }
                }

                closeTermsDialog() {
                    const overlay = document.getElementById('termsOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                openTermsReadOnlyDialog() {
                    const overlay = document.getElementById('termsReadOnlyOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                    }
                }

                closeTermsReadOnlyDialog() {
                    const overlay = document.getElementById('termsReadOnlyOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                // ==================== 代理设置 ====================

                async openProxySettings() {
                    const overlay = document.getElementById('proxySettingsOverlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                        // 加载当前代理状态
                        await this.loadProxyStatus();
                    }
                }

                closeProxySettings() {
                    const overlay = document.getElementById('proxySettingsOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                async loadProxyStatus() {
                    if (!this.isWebView) return;

                    try {
                        const result = await window.pywebview.api.get_proxy_config();
                        if (result.status === 'success') {
                            this.displayProxyStatus(result.data);
                        }
                    } catch (e) {
                        console.error('加载代理状态失败:', e);
                    }
                }

                displayProxyStatus(proxyConfig) {
                    const statusDiv = document.getElementById('proxyStatus');
                    if (!statusDiv) return;

                    if (!proxyConfig || Object.keys(proxyConfig).length === 0) {
                        statusDiv.innerHTML = '<span style="color: #909399;">当前未设置代理</span>';
                        // 设置默认值
                        document.getElementById('proxyHost').value = '127.0.0.1';
                        document.getElementById('proxyPort').value = '7890';
                        document.getElementById('proxyType').value = 'http';
                        document.getElementById('proxyUsername').value = '';
                        document.getElementById('proxyPassword').value = '';
                        return;
                    }

                    // 显示当前代理配置
                    const hasAuth = proxyConfig.has_auth || (proxyConfig.username && proxyConfig.password);
                    const proxyText = `${proxyConfig.type}://${proxyConfig.host}:${proxyConfig.port}${hasAuth ? ' (已配置认证)' : ''}`;
                    statusDiv.innerHTML = `<span style="color: #67c23a;">当前代理: ${proxyText}</span>`;

                    // 填充表单
                    document.getElementById('proxyType').value = proxyConfig.type || 'http';
                    document.getElementById('proxyHost').value = proxyConfig.host || '127.0.0.1';
                    document.getElementById('proxyPort').value = proxyConfig.port || '7890';
                    document.getElementById('proxyUsername').value = proxyConfig.username || '';
                    document.getElementById('proxyPassword').value = proxyConfig.password || '';
                }

                async saveProxyConfig() {
                    if (!this.isWebView) {
                        this.showToast('代理设置功能仅在桌面应用中可用', 'warning');
                        return;
                    }

                    const proxyType = document.getElementById('proxyType').value;
                    const proxyHost = document.getElementById('proxyHost').value.trim();
                    const proxyPort = parseInt(document.getElementById('proxyPort').value);
                    const proxyUsername = document.getElementById('proxyUsername').value.trim();
                    const proxyPassword = document.getElementById('proxyPassword').value;

                    // 验证输入
                    if (!proxyHost) {
                        this.showToast('请输入代理地址', 'error');
                        return;
                    }

                    if (!proxyPort || proxyPort <= 0 || proxyPort > 65535) {
                        this.showToast('请输入有效的端口号 (1-65535)', 'error');
                        return;
                    }

                    try {
                        const result = await window.pywebview.api.set_proxy_config(
                            proxyType,
                            proxyHost,
                            proxyPort,
                            proxyUsername || null,
                            proxyPassword || null
                        );

                        if (result.status === 'success') {
                            this.showToast(result.message, 'success');
                            await this.loadProxyStatus();
                        } else {
                            this.showToast(result.message, 'error');
                        }
                    } catch (e) {
                        console.error('设置代理失败:', e);
                        this.showToast(`设置代理失败: ${e.message}`, 'error');
                    }
                }

                async clearProxyConfig() {
                    if (!this.isWebView) {
                        this.showToast('代理设置功能仅在桌面应用中可用', 'warning');
                        return;
                    }

                    try {
                        const result = await window.pywebview.api.delete_proxy_config();
                        if (result.status === 'success') {
                            this.showToast(result.message, 'success');
                            await this.loadProxyStatus();
                            // 隐藏测试结果
                            document.getElementById('proxyTestResult').style.display = 'none';
                        } else {
                            this.showToast(result.message, 'error');
                        }
                    } catch (e) {
                        console.error('清除代理失败:', e);
                        this.showToast(`清除代理失败: ${e.message}`, 'error');
                    }
                }

                async testProxy() {
                    if (!this.isWebView) {
                        this.showToast('代理测试功能仅在桌面应用中可用', 'warning');
                        return;
                    }

                    const resultDiv = document.getElementById('proxyTestResult');
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = '<span style="color: #1890ff;">正在测试代理连接...</span>';

                    try {
                        const result = await window.pywebview.api.test_proxy();
                        if (result.status === 'success') {
                            const data = result.data;
                            let html = `<div style="font-weight: 600; margin-bottom: 8px;">${result.message}</div>`;
                            html += `<div style="font-size: 12px; color: #909399; margin-bottom: 8px;">代理类型: ${data.proxy_type} | 地址: ${data.proxy_address}</div>`;
                            html += '<div style="border-top: 1px solid #d9d9d9; padding-top: 8px; margin-top: 8px;">';

                            for (const r of data.results) {
                                if (r.status === 'success') {
                                    html += `<div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span style="color: #52c41a;">✓ ${r.name}</span>
                                        <span style="color: #52c41a;">${r.time}</span>
                                    </div>`;
                                } else if (r.status === 'http_error') {
                                    html += `<div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span style="color: #faad14;">△ ${r.name}</span>
                                        <span style="color: #faad14;">HTTP ${r.code}</span>
                                    </div>`;
                                } else {
                                    html += `<div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                        <span style="color: #f5222d;">✗ ${r.name}</span>
                                        <span style="color: #f5222d;">${r.message || '连接失败'}</span>
                                    </div>`;
                                }
                            }
                            html += '</div>';

                            resultDiv.innerHTML = html;
                        } else {
                            resultDiv.innerHTML = `<span style="color: #f5222d;">${result.message}</span>`;
                        }
                    } catch (e) {
                        console.error('测试代理失败:', e);
                        resultDiv.innerHTML = `<span style="color: #f5222d;">测试失败: ${e.message}</span>`;
                    }
                }

                updateDownloadButtons(symbolStatus = null) {
                    // 根据当前镜像的 OS 类型和符号表状态动态显示下载按钮
                    const buttonsContainer = document.getElementById('githubDownloadButtons');
                    if (!buttonsContainer) return;

                    // 如果没有加载镜像，显示提示信息
                    if (!this.currentImage) {
                        buttonsContainer.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: #f4f4f5; border: 1px solid #e4e7ed; border-radius: 8px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="#909399" stroke-width="2" width="20" height="20">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="8" x2="12" y2="12"/>
                                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                                </svg>
                                <span style="color: #909399; font-size: 14px;">请先加载内存镜像</span>
                            </div>
                        `;
                        return;
                    }

                    const osType = this.currentImage?.os_type?.toLowerCase() || '';

                    // 从 symbolStatus 或当前状态获取符号表信息
                    const osTypes = symbolStatus?.os_types || this._symbolStatus?.os_types || {};

                    const currentOsKey = osType === 'mac' || osType === 'macos' ? 'mac' : osType;
                    const info = osTypes[currentOsKey] || {};

                    // 检查当前镜像的符号表是否匹配
                    let hasMatchingSymbol = false;
                    let matchInfoText = '';

                    if (osType === 'windows') {
                        // Windows检查PDB是否匹配
                        if (info.pdb_info) {
                            hasMatchingSymbol = info.pdb_info.symbol_exists;
                            matchInfoText = '该镜像符号表';
                        }
                    } else if ((osType === 'linux' || osType === 'macos' || osType === 'mac') && info.kernel_version) {
                        // Linux/macOS需要检查内核版本是否匹配
                        hasMatchingSymbol = info.kernel_symbol_exists;
                        matchInfoText = `内核版本 ${info.kernel_version}`;
                    }

                    // 如果有匹配的符号表，显示状态
                    if (hasMatchingSymbol) {
                        buttonsContainer.innerHTML = `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 12px 16px; background: #f0f9eb; border: 1px solid #c2e7b0; border-radius: 8px;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="#67c23a" stroke-width="2" width="20" height="20">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22,4 12,14.01 9,11.01"/>
                                </svg>
                                <span style="color: #67c23a; font-size: 14px;">
                                    已安装${matchInfoText}
                                </span>
                            </div>
                        `;
                        return;
                    }

                    // 没有符号表，显示下载按钮
                    let html = '';

                    if (osType === 'linux') {
                        html = `
                            <button class="confirm-btn confirm-primary-btn" onclick="window.forensicsApp.downloadSymbols('linux')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                下载 Linux 符号表
                            </button>
                        `;
                    } else if (osType === 'mac' || osType === 'macos') {
                        html = `
                            <button class="confirm-btn confirm-primary-btn" onclick="window.forensicsApp.downloadSymbols('mac')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                下载 macOS 符号表
                            </button>
                        `;
                    } else if (osType === 'windows') {
                        html = `
                            <button class="confirm-btn confirm-primary-btn" onclick="window.forensicsApp.downloadWindowsSymbols()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                从微软官方下载 Windows 符号表
                            </button>
                        `;
                    } else {
                        // 未检测到 OS 类型，显示三个按钮
                        html = `
                            <button class="confirm-btn confirm-primary-btn" id="downloadLinuxSymbols" style="margin-right: 8px;" onclick="window.forensicsApp.downloadSymbols('linux')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                下载 Linux 符号表
                            </button>
                            <button class="confirm-btn confirm-primary-btn" id="downloadMacSymbols" style="margin-right: 8px;" onclick="window.forensicsApp.downloadSymbols('mac')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                下载 macOS 符号表
                            </button>
                            <button class="confirm-btn confirm-primary-btn" id="downloadWindowsSymbols" onclick="window.forensicsApp.downloadWindowsSymbols()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" style="vertical-align: middle; margin-right: 4px;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                                </svg>
                                下载 Windows 符号表
                            </button>
                        `;
                    }

                    buttonsContainer.innerHTML = html;
                }

                closeSymbolManager() {
                    const overlay = document.getElementById('symbolManagerOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }

                async loadSymbolStatus() {
                    const statusList = document.getElementById('symbolStatusList');
                    if (!statusList) return;

                    if (!this.isWebView) {
                        statusList.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #999;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48" style="margin-bottom: 12px; opacity: 0.3;">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="8" x2="12" y2="12"/>
                                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                                </svg>
                                <p>符号表管理功能仅在桌面应用中可用</p>
                            </div>
                        `;
                        return;
                    }

                    try {
                        const result = await window.pywebview.api.get_symbol_status();
                        if (result.status === 'success') {
                            // 保存符号表状态供后续使用
                            this._symbolStatus = result.data;
                            this.displaySymbolStatus(result.data);
                            // 更新下载按钮状态
                            this.updateDownloadButtons(result.data);
                        } else {
                            statusList.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: #f56c6c;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="48" height="48" style="margin-bottom: 12px;">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="15" y1="9" x2="9" y2="15"/>
                                        <line x1="9" y1="9" x2="15" y2="15"/>
                                    </svg>
                                    <p>${result.message || '加载符号表状态失败'}</p>
                                </div>
                            `;
                        }
                    } catch (e) {
                        console.error('加载符号表状态失败:', e);
                        statusList.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: #f56c6c;">
                                <p>加载失败: ${e.message}</p>
                            </div>
                        `;
                    }
                }

                displaySymbolStatus(data) {
                    const statusList = document.getElementById('symbolStatusList');
                    if (!statusList) return;

                    const osIcons = {
                        windows: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M3 3h18v18H3zM3 9h18M9 21V3"/></svg>',
                        linux: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/></svg>',
                        mac: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>'
                    };

                    const osNames = {
                        windows: 'Windows',
                        linux: 'Linux',
                        mac: 'macOS'
                    };

                    const osDescriptions = {
                        windows: '分析 Windows 内存镜像所需',
                        linux: '分析 Linux 内存镜像所需',
                        mac: '分析 macOS 内存镜像所需'
                    };

                    const currentOs = data.current_os?.toLowerCase();

                    let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';

                    for (const [osType, info] of Object.entries(data.os_types)) {
                        const isCurrentOs = currentOs && (osType === currentOs || osType === 'mac' && currentOs === 'macos' || osType === 'macos' && currentOs === 'mac');

                        // 判断当前镜像的符号表是否匹配
                        let isMatch = false;
                        let matchInfo = '';

                        if (osType === 'windows') {
                            // Windows: 检查PDB是否匹配
                            if (info.pdb_info) {
                                isMatch = info.pdb_info.symbol_exists;
                                matchInfo = isMatch ? `${info.pdb_info.name} (${info.pdb_info.guid.slice(0, 8)}...)` : '';
                            }
                        } else if ((osType === 'linux' || osType === 'mac') && info.kernel_version) {
                            // Linux/macOS: 需要检查内核版本是否匹配
                            isMatch = info.kernel_symbol_exists;
                            matchInfo = `内核版本 ${info.kernel_version}`;
                        }

                        // 对于当前加载的镜像系统，显示符号表匹配状态；否则显示总体安装状态
                        let statusColor, statusText, detailText;
                        if (isCurrentOs) {
                            statusColor = isMatch ? '#67c23a' : '#e6a23c';
                            statusText = isMatch ? '已安装符号表' : '未安装符号表';
                            detailText = matchInfo;
                        } else {
                            statusColor = info.installed ? '#67c23a' : '#909399';
                            statusText = info.installed ? '已安装' : '未安装';
                            detailText = info.installed ? `${info.count} 个文件` : '';
                        }

                        html += `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: ${statusColor === '#67c23a' ? '#f0f9ff' : '#f8f9fa'}; border-radius: 8px; border-left: 3px solid ${statusColor};">
                                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                                    <div style="color: ${statusColor}; width: 32px; height: 32px; background: ${statusColor === '#67c23a' ? '#e8f5e9' : '#f5f5f5'}; border-radius: 6px; display: flex; align-items: center; justify-content: center;">
                                        ${osIcons[osType]}
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <div style="font-weight: 600; color: #303133; font-size: 14px;">${osNames[osType] || osType}</div>
                                            ${isCurrentOs ? '<span style="padding: 2px 6px; background: #409eff; color: white; font-size: 10px; border-radius: 3px;">当前</span>' : ''}
                                        </div>
                                        <div style="font-size: 12px; color: #909399; margin-top: 2px;">${osDescriptions[osType] || ''}</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="text-align: right;">
                                        <div style="font-size: 14px; color: ${statusColor}; font-weight: 600;">${statusText}</div>
                                        ${detailText ? `<div style="font-size: 11px; color: #606266; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${detailText}</div>` : ''}
                                    </div>
                                    <button onclick="window.forensicsApp.openSymbolDir('${osType}')" style="padding: 6px 12px; border: 1px solid #dcdfe6; background: white; border-radius: 4px; cursor: pointer; font-size: 12px; color: #606266; transition: all 0.2s; display: flex; align-items: center; gap: 4px;" onmouseover="this.style.borderColor='#667eea'; this.style.color='#667eea';" onmouseout="this.style.borderColor='#dcdfe6'; this.style.color='#606266';">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                            <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"/>
                                            <polyline points="8 12 12 16 16 12"/>
                                        </svg>
                                        打开目录
                                    </button>
                                </div>
                            </div>
                        `;
                    }

                    html += '</div>';
                    statusList.innerHTML = html;
                }

                async uploadSymbolFile() {
                    if (!this.isWebView) {
                        this.toast('error', '功能不可用', '符号表管理仅在桌面应用中可用');
                        return;
                    }

                    try {
                        const result = await window.pywebview.api.upload_symbol_file();
                        if (result.status === 'success') {
                            this.toast('success', '安装成功', result.message || '符号表已成功安装');
                            await this.loadSymbolStatus(); // 刷新状态

                            // 移除提示框（如果有）
                            const hintDiv = document.getElementById('symbolHint');
                            if (hintDiv) hintDiv.remove();

                            // 清除保存的符号表信息
                            this._pendingSymbolInfo = null;
                        } else if (result.status === 'cancelled') {
                            // 用户取消，不做处理
                        } else {
                            this.toast('error', '安装失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        console.error('上传符号表失败:', e);
                        this.toast('error', '安装失败', e.message || '未知错误');
                    }
                }

                async downloadSymbolFile() {
                    if (!this.isWebView) {
                        this.toast('error', '功能不可用', '符号表下载仅在桌面应用中可用');
                        return;
                    }

                    // 获取当前镜像的操作系统类型
                    let osType = 'linux'; // 默认
                    if (this.currentImage && this.currentImage.os_type) {
                        osType = this.currentImage.os_type.toLowerCase();
                    }

                    // 如果有保存的符号表信息，直接使用
                    if (this._pendingSymbolInfo) {
                        const symbolInfo = this._pendingSymbolInfo;
                        osType = symbolInfo.os_type.toLowerCase();
                    }

                    // 调用新的下载方法
                    await this.downloadSymbols(osType);
                }

                async downloadSymbols(osType) {
                    if (!this.isWebView) {
                        this.toast('error', '功能不可用', '符号表管理仅在桌面应用中可用');
                        return;
                    }

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像才能自动检测内核版本');
                        return;
                    }

                    const osTypeName = osType === 'linux' ? 'Linux' : 'macOS';

                    try {
                        this.toast('info', '开始下载', `正在从 GitHub 下载 ${osTypeName} 符号表...`);

                        const result = await window.pywebview.api.download_symbols_from_github(osType);

                        if (result.status === 'success') {
                            // 文件已存在且匹配的情况，显示 info 而不是 success
                            if (result.already_exists) {
                                this.toast('info', '符号表已存在', result.message || '当前镜像已有匹配的符号表');
                            } else {
                                this.toast('success', '下载成功', result.message || '符号表已成功安装');
                            }
                            await this.loadSymbolStatus(); // 刷新状态

                            // 移除提示框
                            const hintDiv = document.getElementById('symbolHint');
                            if (hintDiv) hintDiv.remove();

                            // 清除保存的符号表信息
                            this._pendingSymbolInfo = null;
                        } else {
                            this.toast('error', '下载失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        console.error('下载符号表失败:', e);
                        this.toast('error', '下载失败', e.message || '未知错误');
                    }
                }

                async downloadWindowsSymbols() {
                    if (!this.isWebView) {
                        this.toast('error', '功能不可用', '符号表管理仅在桌面应用中可用');
                        return;
                    }

                    if (!this.currentImage) {
                        this.toast('warning', '未加载镜像', '请先加载内存镜像才能自动检测内核版本');
                        return;
                    }

                    const osType = this.currentImage?.os_type?.toLowerCase() || '';
                    if (osType !== 'windows') {
                        this.toast('warning', '不是Windows镜像', '当前加载的不是Windows内存镜像');
                        return;
                    }

                    try {
                        this.toast('info', '开始下载', '正在从微软官方符号服务器下载Windows符号表...\n\n可能需要几分钟，请耐心等待。');

                        const result = await window.pywebview.api.download_windows_symbols();

                        if (result.status === 'success') {
                            // 文件已存在且匹配的情况，显示 info 而不是 success
                            if (result.already_exists) {
                                this.toast('info', '符号表已存在', result.message || '当前镜像已有匹配的符号表');
                            } else {
                                this.toast('success', '下载成功', result.message || 'Windows符号表已成功安装');
                            }

                            // 等待 toast 显示完成后再刷新状态
                            await new Promise(resolve => setTimeout(resolve, 500));
                            await this.loadSymbolStatus(); // 刷新状态

                            // 确保符号表管理对话框是打开的，如果没打开则打开它
                            const overlay = document.getElementById('symbolManagerOverlay');
                            if (overlay && overlay.classList.contains('hidden')) {
                                this.openSymbolManager();
                            }

                            // 移除提示框
                            const hintDiv = document.getElementById('symbolHint');
                            if (hintDiv) hintDiv.remove();
                        } else {
                            this.toast('error', '下载失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        console.error('下载Windows符号表失败:', e);
                        this.toast('error', '下载失败', e.message || '未知错误');
                    }
                }

                async _promptForKernelVersion(osType) {
                    return new Promise((resolve) => {
                        const version = prompt(
                            `请输入 ${osType.toUpperCase()} 内核版本:\n` +
                            `格式示例: 5.15.0-151-generic\n\n` +
                            `提示: 可以从内存镜像的 banner 信息中找到内核版本`,
                            ''
                        );
                        resolve(version ? version.trim() : null);
                    });
                }

                async checkAndPromptSymbols(pluginId) {
                    // 检查本地符号表状态，如果没有则弹出管理界面
                    try {
                        const statusResult = await window.pywebview.api.get_symbol_status();

                        if (statusResult.status === 'success') {
                            const symbols = statusResult.data.symbols;
                            const osType = this.currentImage?.os_type?.toLowerCase() || 'unknown';

                            // 检查对应操作系统的符号表
                            let hasSymbols = false;
                            if (osType === 'linux' && symbols.linux && symbols.linux.count > 0) {
                                hasSymbols = true;
                            } else if (osType === 'macos' && symbols.mac && symbols.mac.count > 0) {
                                hasSymbols = true;
                            }

                            if (hasSymbols) {
                                // 有符号表，但可能是版本不匹配
                                this.toast('warning', '符号表不匹配', `当前已有 ${osType.toUpperCase()} 符号表，但版本可能与镜像不匹配。`);
                            } else {
                                // 没有符号表，显示弹窗提示
                                this.showSymbolWarning(osType, pluginId);
                            }

                            // 打开符号表管理界面
                            this.openSymbolManager();
                        }
                    } catch (e) {
                        console.error('检查符号表状态失败:', e);
                        this.openSymbolManager();
                    }
                }

                showSymbolWarning(osType, pluginId = null) {
                    // 显示缺少符号表的右上角 toast 提示
                    const osTypeName = osType === 'macos' ? 'macOS' : (osType.charAt(0).toUpperCase() + osType.slice(1));
                    const pluginText = pluginId ? `\n分析插件: ${pluginId}` : '';

                    this.toast('warning', '缺少符号表', `您本地暂无该镜像所需的 ${osTypeName} 符号表${pluginText}\n\n请选择以下方式安装:\n• 点击"自动下载"从 GitHub 获取\n• 点击"安装符号表"手动上传`, 12000);
                }

                showSymbolStatusLoading() {
                    const statusList = document.getElementById('symbolStatusList');
                    if (!statusList) return;

                    statusList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #909399;">
                            <div class="spinner" style="
                                width: 40px;
                                height: 40px;
                                border: 3px solid #e4e7ed;
                                border-top-color: #409eff;
                                border-radius: 50%;
                                animation: spin 0.8s linear infinite;
                                margin: 0 auto 12px;
                            "></div>
                            <p style="margin: 0;">正在加载符号表状态...</p>
                            <style>
                                @keyframes spin {
                                    to { transform: rotate(360deg); }
                                }
                            </style>
                        </div>
                    `;
                }

                async openSymbolDir(osType) {
                    if (!this.isWebView) {
                        this.toast('error', '功能不可用', '此功能仅在桌面应用中可用');
                        return;
                    }

                    try {
                        const result = await window.pywebview.api.open_symbol_directory(osType);
                        if (result.status === 'success') {
                            this.toast('success', '打开成功', result.message || '目录已打开');
                        } else {
                            this.toast('error', '打开失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        console.error('打开目录失败:', e);
                        this.toast('error', '打开失败', e.message || '未知错误');
                    }
                }

                getMockResult(pluginId) {
                    const mockData = {
                        'pslist': [
                            { pid: 4, ppid: 0, name: 'System', threads: 124, handles: 0, session_id: 0, create_time: '2025-01-26 10:00:00' },
                            { pid: 896, ppid: 4, name: 'smss.exe', threads: 3, handles: 45, session_id: 0, create_time: '2025-01-26 10:00:05' },
                            { pid: 1024, ppid: 896, name: 'csrss.exe', threads: 12, handles: 234, session_id: 1, create_time: '2025-01-26 10:00:10' },
                            { pid: 1104, ppid: 896, name: 'wininit.exe', threads: 4, handles: 123, session_id: 0, create_time: '2025-01-26 10:00:12' },
                            { pid: 1180, ppid: 1104, name: 'services.exe', threads: 16, handles: 567, session_id: 0, create_time: '2025-01-26 10:00:15' },
                            { pid: 1256, ppid: 1104, name: 'lsass.exe', threads: 12, handles: 445, session_id: 0, create_time: '2025-01-26 10:00:18' },
                            { pid: 2456, ppid: 1180, name: 'svchost.exe', threads: 24, handles: 678, session_id: 0, create_time: '2025-01-26 10:01:00' },
                            { pid: 3568, ppid: 2456, name: 'docker.exe', threads: 8, handles: 234, session_id: 1, create_time: '2025-01-26 10:05:00' },
                            { pid: 6789, ppid: 4, name: 'explorer.exe', threads: 34, handles: 890, session_id: 1, create_time: '2025-01-26 10:10:00' },
                            { pid: 7890, ppid: 6789, name: 'chrome.exe', threads: 56, handles: 1234, session_id: 1, create_time: '2025-01-26 10:15:00' }
                        ],
                        'pstree': [
                            { pid: 4, ppid: 0, name: 'System', threads: 124, handles: 0, session_id: 0, create_time: '2025-01-26 10:00:00' },
                            { pid: 896, ppid: 4, name: 'smss.exe', threads: 3, handles: 45, session_id: 0, create_time: '2025-01-26 10:00:05' },
                            { pid: 1024, ppid: 896, name: 'csrss.exe', threads: 12, handles: 234, session_id: 1, create_time: '2025-01-26 10:00:10' },
                            { pid: 2456, ppid: 1180, name: 'svchost.exe', threads: 24, handles: 678, session_id: 0, create_time: '2025-01-26 10:01:00' },
                            { pid: 3568, ppid: 2456, name: 'docker.exe', threads: 8, handles: 234, session_id: 1, create_time: '2025-01-26 10:05:00' }
                        ],
                        'psscan': [
                            { pid: 4, ppid: 0, name: 'System', threads: 124, handles: 0, session_id: 0, create_time: '2025-01-26 10:00:00', status: 'active', hidden: false },
                            { pid: 2456, ppid: 1180, name: 'svchost.exe', threads: 24, handles: 678, session_id: 0, create_time: '2025-01-26 10:01:00', status: 'active', hidden: false },
                            { pid: 9999, ppid: 2456, name: 'hidden.exe', threads: 2, handles: 10, session_id: 0, create_time: '2025-01-26 09:55:00', status: 'terminated', hidden: true }
                        ],
                        'cmdline': [
                            { pid: 4, ppid: 0, name: 'System', command_line: 'System' },
                            { pid: 3568, ppid: 2456, name: 'docker.exe', command_line: '"C:\\Program Files\\Docker\\docker.exe" --run-service' },
                            { pid: 6789, ppid: 4, name: 'explorer.exe', command_line: 'C:\\Windows\\explorer.exe' },
                            { pid: 7890, ppid: 6789, name: 'chrome.exe', command_line: 'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe --type=renderer' },
                            { pid: 8901, ppid: 6789, name: 'python.exe', command_line: 'python.exe C:\\Users\\user\\script.py --arg1 value1' }
                        ],
                        'netscan': [
                            { pid: 7890, process_name: 'chrome.exe', protocol: 'TCP', local_address: '192.168.1.100', local_port: 54321, remote_address: '142.250.185.78', remote_port: 443, state: 'ESTABLISHED', create_time: '2025-01-26 10:30:00' },
                            { pid: 3568, process_name: 'docker.exe', protocol: 'TCP', local_address: '0.0.0.0', local_port: 2375, remote_address: '0.0.0.0', remote_port: 0, state: 'LISTENING', create_time: '2025-01-26 10:05:10' },
                            { pid: 5678, process_name: 'docker-proxy.exe', protocol: 'TCP', local_address: '0.0.0.0', local_port: 8080, remote_address: '0.0.0.0', remote_port: 0, state: 'LISTENING', create_time: '2025-01-26 10:06:05' },
                            { pid: 8901, process_name: 'python.exe', protocol: 'TCP', local_address: '127.0.0.1', local_port: 5000, remote_address: '0.0.0.0', remote_port: 0, state: 'LISTENING', create_time: '2025-01-26 10:25:00' }
                        ],
                        'filescan': [
                            { offset: '0xffffa8091a234567', file_name: 'passwords.txt', path: 'C:\\Users\\user\\Desktop\\passwords.txt', size: 1024, number_of_links: 1 },
                            { offset: '0xffffa8091b345678', file_name: 'flag.txt', path: 'C:\\Temp\\flag.txt', size: 45, number_of_links: 1 },
                            { offset: '0xffffa8091c456789', file_name: 'malware.exe', path: 'C:\\Users\\user\\Downloads\\malware.exe', size: 2048576, number_of_links: 1 }
                        ],
                        'hivelist': [
                            { offset: '0xffffa8091a234567', name: '\\REGISTRY\\MACHINE\\SYSTEM', path: '\\Device\\HarddiskVolume1\\Windows\\System32\\config\\SYSTEM', hive_type: 'System' },
                            { offset: '0xffffa8091b345678', name: '\\REGISTRY\\MACHINE\\SOFTWARE', path: '\\Device\\HarddiskVolume1\\Windows\\System32\\config\\SOFTWARE', hive_type: 'Software' },
                            { offset: '0xffffa8091c456789', name: '\\REGISTRY\\USER\\S-1-5-21-123456789', path: '\\Device\\HarddiskVolume1\\Users\\user\\NTUSER.DAT', hive_type: 'User' }
                        ],
                        'malfind': [
                            { pid: 2456, process_name: 'svchost.exe', address: '0x1a2b3c4d5e6f', size: 4096, protection: 'PAGE_EXECUTE_READWRITE', suspicious: true, reason: 'Injected code in system process' }
                        ]
                    };

                    return mockData[pluginId] || [];
                }

                displayResults(results, pluginId) {
                    const panel = document.getElementById('resultsPanel');
                    const emptyState = document.getElementById('resultsEmpty');
                    const tableContainer = document.getElementById('resultsTableContainer');
                    const thead = document.getElementById('resultsTableHead');
                    const tbody = document.getElementById('resultsTableBody');

                    // 保存当前数据
                    this.currentResults = results;
                    this.currentPluginId = pluginId;

                    // 检查是否有错误
                    if (results && results.length > 0 && results[0]._error) {
                        const errorData = results[0];
                        if (panel) panel.classList.remove('hidden');
                        if (emptyState) emptyState.classList.add('hidden');
                        if (tableContainer) tableContainer.classList.add('hidden');

                        // 更新标题
                        const titleEl = document.getElementById('resultsTitle');
                        if (titleEl) titleEl.textContent = this.getPluginDisplayName(pluginId) + ' - 错误';

                        // 显示错误信息
                        if (thead) thead.innerHTML = '';
                        if (tbody) {
                            const errorTitle = errorData._error === 'not_supported' ? '插件不支持当前系统' :
                                             errorData._error === 'symbol_not_found' ? '符号表错误' : '执行错误';
                            tbody.innerHTML = `
                                <tr>
                                    <td colspan="100%" style="padding: 30px;">
                                        <div style="max-width: 600px; margin: 0 auto;">
                                            <h3 style="color: #f87171; margin-bottom: 15px;">${errorTitle}</h3>
                                            <pre style="background: var(--bg-secondary); padding: 15px; border-radius: 8px; overflow-x: auto; white-space: pre-wrap; font-size: 13px; line-height: 1.6; color: var(--text-normal);">${errorData._message}</pre>
                                        </div>
                                    </td>
                                </tr>
                            `;
                        }
                        return;
                    }

                    // 更新搜索框状态（页缓存文件需要手动搜索）
                    this.updateSearchBoxState();

                    // 显示面板
                    if (panel) panel.classList.remove('hidden');
                    if (emptyState) emptyState.classList.add('hidden');
                    if (tableContainer) tableContainer.classList.remove('hidden');

                    // 更新标题
                    const titleEl = document.getElementById('resultsTitle');
                    if (titleEl) titleEl.textContent = this.getPluginDisplayName(pluginId);

                    // 处理注册表导航（面包屑和返回按钮）
                    const backBtn = document.getElementById('registryBackBtn');
                    const breadcrumb = document.getElementById('registryBreadcrumb');

                    if (pluginId === 'printkey' && this.currentRegistryContext) {
                        // 显示返回按钮和面包屑
                        if (backBtn) {
                            backBtn.classList.remove('hidden');
                            // 绑定点击事件（只绑定一次）
                            if (!backBtn.hasAttribute('data-bound')) {
                                backBtn.addEventListener('click', () => this.goBackRegistry());
                                backBtn.setAttribute('data-bound', 'true');
                            }
                        }
                        if (breadcrumb) {
                            breadcrumb.textContent = this.getRegistryBreadcrumb();
                            breadcrumb.classList.remove('hidden');
                        }
                    } else {
                        // 隐藏返回按钮和面包屑
                        if (backBtn) backBtn.classList.add('hidden');
                        if (breadcrumb) breadcrumb.classList.add('hidden');
                    }

                    // 更新统计
                    const countEl = document.getElementById('resultCount');
                    const timeEl = document.getElementById('executionTime');
                    if (countEl) countEl.textContent = results.length;
                    if (timeEl) timeEl.textContent = this.executionStartTime ? ((Date.now() - this.executionStartTime) / 1000).toFixed(2) + 's' : '-';

                    // 构建表格
                    this.buildTable(thead, tbody, results, pluginId);
                }

                buildTable(thead, tbody, results, pluginId) {
                    const columns = this.getTableColumns(pluginId);

                    if (!columns || columns.length === 0 || !results || results.length === 0) {
                        if (thead) thead.innerHTML = '';
                        if (tbody) tbody.innerHTML = '<tr><td colspan="100%" style="text-align:center;color:var(--text-muted);padding:20px;">暂无数据</td></tr>';
                        this.updatePaginationControls();
                        this.hideDumpAllButton();
                        return;
                    }

                    // 应用搜索和排序
                    let displayData = this.applySearchAndSort(results);

                    // 应用分页
                    if (this.viewMode === 'pagination') {
                        const startIndex = (this.currentPage - 1) * this.pageSize;
                        const endIndex = startIndex + this.pageSize;
                        displayData = displayData.slice(startIndex, endIndex);
                    }

                    // 判断是否需要添加操作列（进程列表、进程树、进程扫描、文件扫描、DLL列表、页缓存文件、进程详情、ELF文件、打开文件）
                    // 注意：macOS 不支持进程/文件下载，所以不显示操作列
                    const needsActionPlugins = ['pslist', 'pstree', 'psscan', 'linux_pslist', 'linux_pstree', 'linux_psscan', 'linux_psaux', 'filescan', 'dlllist', 'linux_pagecache_files', 'linux_elfs', 'linux_lsof'];
                    const needsActionColumn = needsActionPlugins.includes(pluginId);

                    // 证书列表特殊处理：只显示导出按钮，不显示操作列
                    if (pluginId === 'certificates') {
                        this.showDumpAllButton(pluginId, results.length, '全部导出证书');
                    } else if (needsActionColumn) {
                        if (pluginId === 'filescan') {
                            this.showDumpAllButton(pluginId, results.length, '全部提取文件');
                            this.showExtractEventlogButton();
                        } else if (pluginId === 'dlllist') {
                            this.showDumpAllButton(pluginId, results.length, '全部提取DLL');
                        } else if (pluginId === 'linux_elfs') {
                            this.showDumpAllButton(pluginId, results.length, '全部提取ELF');
                        } else if (pluginId === 'linux_lsof') {
                            this.showDumpAllButton(pluginId, results.length, '全部下载文件');
                        } else {
                            this.showDumpAllButton(pluginId, results.length, '全部下载');
                        }
                    } else {
                        this.hideDumpAllButton();
                        this.hideExtractEventlogButton();
                    }

                    // 构建表头（添加序号列，支持排序）
                    if (thead) {
                        thead.innerHTML = '<tr><th style="width:50px;">序号</th>' +
                            columns.map((col, index) => {
                                const sortClass = this.sortColumn === col.key ? `sort-${this.sortDirection} sortable` : 'sortable';
                                return `<th class="${sortClass}" data-column="${col.key}" data-index="${index}">
                                    ${col.label}<span class="sort-indicator"></span>
                                </th>`;
                            }).join('') +
                            (needsActionColumn ? '<th style="width:120px;">操作</th>' : '') +
                            '</tr>';

                        // 绑定排序事件
                        thead.querySelectorAll('.sortable').forEach(th => {
                            th.addEventListener('click', () => this.handleSort(th.dataset.column));
                        });
                    }

                    // 计算全局序号（考虑分页）
                    const globalStartIndex = this.viewMode === 'pagination' ? (this.currentPage - 1) * this.pageSize : 0;

                    // 构建表格内容（添加序号）
                    if (tbody) {
                        tbody.innerHTML = displayData.map((row, index) => {
                            // hivelist 和 printkey 的行都可以点击
                            const isClickable = pluginId === 'hivelist' || pluginId === 'printkey';
                            const rowClass = isClickable ? 'clickable-row' : '';
                            return '<tr class="' + rowClass + '" data-row-index="' + index + '">' +
                                `<td class="row-number">${globalStartIndex + index + 1}</td>` +
                                columns.map(col => {
                                    const value = row[col.key];
                                    const formatted = col.format ? col.format(value) : (value !== undefined ? String(value) : '-');
                                    let classes = col.monospace ? 'monospace' : '';
                                    if (col.wrap) classes += ' wrap-text';
                                    let style = '';
                                    if (col.width) {
                                        // 如果设置了 wrap，同时设置 min-width 和 max-width
                                        // 如果没有设置 wrap，使用 min-width 保证最小宽度，允许水平滚动
                                        if (col.wrap) {
                                            style = `min-width:${col.width}px;max-width:${col.width}px;`;
                                        } else {
                                            style = `min-width:${col.width}px;max-width:none;`;
                                        }
                                    }
                                    return `<td class="${classes}" style="${style}">${this.escapeHtml(formatted)}</td>`;
                                }).join('') +
                                (needsActionColumn ? this.buildActionCell(row, pluginId) : '') +
                                '</tr>';
                        }).join('');

                        // 为hivelist添加点击事件
                        if (pluginId === 'hivelist') {
                            tbody.querySelectorAll('.clickable-row').forEach(tr => {
                                tr.style.cursor = 'pointer';
                                tr.addEventListener('click', () => {
                                    const rowIndex = parseInt(tr.dataset.rowIndex);
                                    const row = displayData[rowIndex];
                                    this.viewHiveDetails(row);
                                });
                            });
                        }

                        // 为printkey添加点击事件 - 允许继续深入子键
                        if (pluginId === 'printkey') {
                            tbody.querySelectorAll('.clickable-row').forEach(tr => {
                                const rowIndex = parseInt(tr.dataset.rowIndex);
                                const row = displayData[rowIndex];

                                // 只对 Type=Key 的行添加点击事件（使用 _is_key 字段或检查 type）
                                if (row._is_key || row.type === 'Key') {
                                    tr.style.cursor = 'pointer';
                                    tr.title = `点击查看 ${row.name} 的内容`;
                                    tr.addEventListener('click', (e) => {
                                        e.preventDefault();
                                        this.viewRegistrySubkey(row);
                                    });
                                }
                            });
                        }
                    }

                    this.updatePaginationControls();
                }

                buildActionCell(row, pluginId) {
                    // 构建操作列
                    if (pluginId === 'filescan') {
                        // 文件扫描：只显示提取按钮
                        const offset = this.escapeHtml(row.offset || '');
                        const path = row.path || 'unknown';
                        // 从路径中提取文件名
                        const fileName = path.split('\\').pop().split('/').pop();

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn file-btn" onclick="app.extractFile('${offset}', '${fileName.replace(/'/g, "\\'")}')" title="提取文件">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                            <polyline points="14 2 14 8 20 8"/>
                                            <line x1="16" y1="13" x2="8" y2="13"/>
                                            <line x1="16" y1="17" x2="8" y2="17"/>
                                            <polyline points="10 9 9 9 8 9"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else if (pluginId === 'linux_pagecache_files') {
                        // Linux页缓存文件：显示提取按钮
                        const filePath = this.escapeHtml(row.file_path || row.path || '');
                        const fileName = filePath.split('/').pop();

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn file-btn" onclick="app.extractPagecacheFile('${filePath.replace(/'/g, "\\'")}')" title="提取文件">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else if (pluginId === 'linux_elfs') {
                        // ELF文件列表：显示提取按钮
                        const pid = row.pid || '0';
                        const start = this.escapeHtml(row.start || '');
                        const file_path = this.escapeHtml(row.file_path || row.path || 'unknown');
                        const fileName = file_path.split('/').pop();

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn file-btn" onclick="app.extractElfFile('${pid}', '${start}', '${fileName.replace(/'/g, "\\'")}')" title="提取ELF文件">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else if (pluginId === 'linux_lsof') {
                        // 打开文件列表：显示下载按钮（仅 Linux 支持）
                        const filePath = this.escapeHtml(row.path || row.file_path || 'unknown');
                        const fileName = filePath.split('/').pop();

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn file-btn" onclick="app.extractLsofFile('${filePath.replace(/'/g, "\\'")}', '${pluginId}')" title="下载文件">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else if (pluginId === 'dlllist') {
                        // DLL列表：显示提取DLL按钮
                        const pid = row.pid;
                        const name = this.escapeHtml(row.name || row.module_name || 'unknown');
                        const base = this.escapeHtml(row.base_address || '');

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn file-btn" onclick="app.extractDll('${pid}', '${base}', '${name.replace(/'/g, "\\'")}')" title="提取DLL">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    } else {
                        // 进程相关（pslist, pstree, psscan等）：显示内存导出按钮
                        const pid = row.pid;
                        const name = this.escapeHtml(row.name || row.image_file_name || 'unknown');

                        return `
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <button class="table-action-btn memory-btn" onclick="app.dumpProcess(${pid}, '${name.replace(/'/g, "\\'")}')" title="导出进程内存">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                            <polyline points="7,10 12,15 17,10"/>
                                            <line x1="12" y1="15" x2="12" y2="3"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        `;
                    }
                }

                async dumpProcess(pid, processName) {
                    // 导出进程内存（支持 Windows 和 macOS）
                    if (!this.api) {
                        this.toast('error', '无法导出', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;
                    console.log(`用户选择的导出目录: ${outputDir}`);

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        this.toast('info', '正在导出...', `正在导出进程 ${processName} (PID: ${pid}) 的内存`);

                        const result = await this.api.dump_process_memory(pid, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                // macOS/Linux 可能返回多个文件
                                if (data.output_files && data.output_files.length > 0) {
                                    const sizeMB = (data.total_size / 1024 / 1024).toFixed(2);
                                    const fileCount = data.count;
                                    const osType = data.os_type || 'Unknown';

                                    if (osType === 'macOS' || osType === 'Linux') {
                                        // macOS 和 Linux 都生成多个 VMA 文件
                                        this.toast('success', '导出成功',
                                            `进程 ${processName} 已导出 (${osType})\n生成 ${fileCount} 个内存区域文件\n总大小: ${sizeMB} MB`);
                                    } else {
                                        // Windows 生成单个文件
                                        this.toast('success', '导出成功',
                                            `进程 ${processName} 已导出\n文件: ${data.output_files[0]}\n大小: ${sizeMB} MB`);
                                    }
                                } else {
                                    // 兼容旧格式（单个文件）
                                    const sizeMB = (data.size / 1024 / 1024).toFixed(2);
                                    this.toast('success', '导出成功',
                                        `进程 ${processName} 已导出\n文件: ${data.output_file}\n大小: ${sizeMB} MB`);
                                }
                            } else if (data.status === 'unsupported') {
                                this.toast('warning', '暂不支持', data.error || '此系统不支持进程内存导出');
                            } else {
                                this.toast('error', '导出失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '导出失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '导出失败', e.message);
                    }
                }

                async extractFile(offset, fileName) {
                    // 提取文件（从文件扫描）
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        this.toast('info', '正在提取...', `正在提取文件 ${fileName}`);

                        const result = await this.api.extract_file(offset, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                this.toast('success', '提取成功',
                                    `文件已提取\n保存到: ${data.file}\n大小: ${(data.size/1024).toFixed(0)} KB`);
                            } else if (data.status === 'unsupported') {
                                // 不支持的功能显示为警告
                                this.toast('warning', '不支持此功能', data.error || '此平台不支持文件提取');
                            } else {
                                this.toast('error', '提取失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async extractDll(pid, base, dllName) {
                    // 提取单个DLL
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        this.toast('info', '正在提取...', `正在提取 DLL ${dllName}`);

                        const result = await this.api.extract_dll(pid, base, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                this.toast('success', '提取成功',
                                    `DLL 已提取\n文件: ${data.file}\n大小: ${(data.size/1024).toFixed(0)} KB`);
                            } else {
                                this.toast('error', '提取失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async extractPagecacheFile(filePath) {
                    // 提取Linux页缓存文件
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        this.toast('info', '正在提取...', `正在提取文件 ${filePath}`);

                        const result = await this.api.extract_pagecache_file(filePath, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                this.toast('success', '提取成功',
                                    `文件已提取\n保存到: ${data.file}\n大小: ${(data.size/1024).toFixed(0)} KB`);
                            } else if (data.status === 'unsupported') {
                                this.toast('warning', '不支持此功能', data.error || '此平台不支持页缓存文件提取');
                            } else {
                                this.toast('error', '提取失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async extract_elf_files(pid = null) {
                    // 提取 Linux ELF 文件
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        const pidMsg = pid ? ` (PID: ${pid})` : '';
                        this.toast('info', '正在提取...', `正在提取 ELF 文件${pidMsg}`);

                        const result = await this.api.extract_elf_files(pid ? String(pid) : null, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                const count = data.count || 0;
                                const sizeMB = (data.total_size / 1024 / 1024).toFixed(1);
                                this.toast('success', '提取成功',
                                    `已提取 ${count} 个 ELF 文件\n总大小: ${sizeMB} MB\n保存位置: ${outputDir}`);
                            } else if (data.status === 'unsupported') {
                                this.toast('warning', '不支持', data.error || '此功能仅支持 Linux 系统');
                            } else {
                                this.toast('error', '提取失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async dump_files(filterPattern = null, ignoreCase = false, pid = null) {
                    // 提取 Linux 页缓存文件
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        const pidMsg = pid ? ` (PID: ${pid})` : '';
                        const filterMsg = filterPattern ? `\n过滤: ${filterPattern}` : '';
                        this.toast('info', '正在提取...', `正在提取页缓存文件${pidMsg}${filterMsg}`);

                        const result = await this.api.dump_files(filterPattern, ignoreCase, pid ? String(pid) : null, outputDir);

                        if (result.status === 'success') {
                            const data = result.data;
                            if (data.status === 'success') {
                                const count = data.count || 0;
                                const sizeMB = (data.total_size / 1024 / 1024).toFixed(2);
                                this.toast('success', '提取成功',
                                    `已提取 ${count} 个文件\n总大小: ${sizeMB} MB\n保存位置: ${outputDir}`);
                            } else if (data.status === 'unsupported') {
                                this.toast('warning', '不支持', data.error || '此功能仅支持 Linux 系统');
                            } else {
                                this.toast('error', '提取失败', data.error || '未知错误');
                            }
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async dump_certificates() {
                    // 导出所有证书
                    if (!this.api) {
                        this.toast('error', '无法导出', '请使用完整模式');
                        return;
                    }

                    // 选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    try {
                        this.toast('info', '正在导出...', '正在导出证书，请稍候...');

                        const result = await this.api.export_certificates(outputDir);

                        if (result.status === 'success') {
                            const count = result.data.count || 0;
                            const totalSize = this.formatSize(result.data.total_size || 0);
                            this.toast('success', '导出成功',
                                `已导出 ${count} 个证书\n总大小: ${totalSize}\n保存位置: ${outputDir}`);
                        } else {
                            this.toast('error', '导出失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.toast('error', '导出失败', e.message);
                    }
                }

                showDumpAllButton(pluginId, totalCount, buttonText = null) {
                    // 显示全部下载按钮
                    const dumpAllBtn = document.getElementById('dumpAllBtn');
                    const dumpAllText = document.getElementById('dumpAllText');
                    if (dumpAllBtn) {
                        dumpAllBtn.classList.remove('hidden');
                        dumpAllBtn.style.display = '';
                        if (dumpAllText) {
                            if (buttonText) {
                                dumpAllText.textContent = `${buttonText} (${totalCount})`;
                            } else {
                                dumpAllText.textContent = `全部下载 (${totalCount})`;
                            }
                        }
                    }
                }

                hideDumpAllButton() {
                    // 隐藏全部导出按钮
                    const dumpAllBtn = document.getElementById('dumpAllBtn');
                    if (dumpAllBtn) {
                        dumpAllBtn.classList.add('hidden');
                        dumpAllBtn.style.display = 'none';
                    }
                }

                showExtractEventlogButton() {
                    // 显示提取事件日志按钮
                    const extractEventlogBtn = document.getElementById('extractEventlogBtn');
                    if (extractEventlogBtn) {
                        extractEventlogBtn.classList.remove('hidden');
                    }
                }

                hideExtractEventlogButton() {
                    // 隐藏提取事件日志按钮
                    const extractEventlogBtn = document.getElementById('extractEventlogBtn');
                    if (extractEventlogBtn) {
                        extractEventlogBtn.classList.add('hidden');
                    }
                }

                async extractEventlogs() {
                    // 提取事件日志文件
                    this.toast('info', '提示', '开始提取事件日志...');

                    if (!this.currentResults || this.currentResults.length === 0) {
                        this.toast('error', '无法提取', '没有可提取的文件');
                        return;
                    }

                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    // 过滤出事件日志文件（.evt 或 .evtx）
                    const eventlogFiles = this.currentResults.filter(item => {
                        const path = item.path || '';
                        return path.toLowerCase().match(/\.(evt|evtx)$/);
                    });

                    if (eventlogFiles.length === 0) {
                        this.toast('warning', '未找到事件日志', '当前扫描结果中没有 .evt 或 .evtx 文件');
                        return;
                    }

                    this.toast('info', '找到文件', `发现 ${eventlogFiles.length} 个事件日志文件`);

                    // 过滤出核心事件日志文件
                    const coreEventLogs = [
                        'Application',      // 应用程序日志
                        'System',            // 系统日志
                        'Security',          // 安全日志
                        'Microsoft-Windows-Windows Defender/Operational',  // Defender 杀毒扫描日志
                        'Microsoft-Windows-Windows Defender/WHC'  // Defender 其他日志
                    ];
                    const filteredFiles = eventlogFiles.filter(item => {
                        const fullPath = (item.path || '').toLowerCase();
                        const fileName = fullPath.split('\\').pop().split('/').pop();
                        const nameWithoutExt = fileName.replace(/\.(evt|evtx)$/i, '');

                        // 检查是否匹配核心日志
                        return coreEventLogs.some(log => {
                            const logLower = log.toLowerCase();
                            // 精确匹配文件名
                            if (nameWithoutExt === logLower.replace(/\//g, '-').replace(/\\/, '-')) {
                                return true;
                            }
                            // 路径包含匹配（针对 Defender 日志）
                            if (fullPath.includes(logLower.replace(/\//g, '\\').replace(/\//g, '/'))) {
                                return true;
                            }
                            return false;
                        });
                    });

                    if (filteredFiles.length === 0) {
                        // 如果没有找到核心日志，提取所有
                        this.toast('warning', '未找到核心日志', '未找到核心事件日志，将提取所有文件');
                    } else {
                        this.toast('info', '筛选完成', `将提取 ${filteredFiles.length} 个核心事件日志文件`);
                        // 使用筛选后的文件列表
                        eventlogFiles.length = 0;
                        eventlogFiles.push(...filteredFiles);
                    }

                    // 选择输出目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        return; // 用户取消或出错
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    const extractEventlogBtn = document.getElementById('extractEventlogBtn');
                    let successCount = 0;
                    let failCount = 0;
                    let errorList = [];

                    // 禁用按钮，显示进度
                    extractEventlogBtn.disabled = true;
                    const originalText = extractEventlogBtn.innerHTML;

                    extractEventlogBtn.innerHTML = `
                        <svg class="spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48-8.48l2.83-2.83M2 12h4m12 0h4M4.93 19.07l2.83 2.83m8.48-8.48l2.83-2.83"/>
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span id="progressText">提取中... (0/${eventlogFiles.length})</span>
                    `;

                    // 添加取消按钮
                    const cancelButton = document.createElement('button');
                    cancelButton.className = 'cancel-btn';
                    cancelButton.textContent = '取消';
                    cancelButton.style.cssText = 'margin-left: 8px; padding: 4px 12px; font-size: 12px;';
                    extractEventlogBtn.parentNode.appendChild(cancelButton);

                    let cancelled = false;
                    cancelButton.onclick = () => {
                        cancelled = true;
                        cancelButton.disabled = true;
                        cancelButton.textContent = '取消中...';
                    };

                    try {
                        // 逐个处理，显示进度
                        for (let i = 0; i < eventlogFiles.length; i++) {
                            // 检查是否取消
                            if (cancelled) {
                                this.toast('warning', '已取消', `已处理 ${i + 1}/${eventlogFiles.length} 个文件\n成功: ${successCount}, 失败: ${failCount}`);
                                break;
                            }

                            const file = eventlogFiles[i];
                            const offset = file.offset || '';
                            const fileName = file.path ? file.path.split('\\').pop().split('/').pop() : `eventlog_${i}.evt`;

                            // 更新进度
                            const progressText = document.getElementById('progressText');
                            if (progressText) {
                                progressText.textContent = `提取中... (${i + 1}/${eventlogFiles.length})`;
                            }

                            try {
                                // 调用后端提取文件
                                const result = await this.api.dump_file(offset, outputDir, fileName);

                                if (result.status === 'success') {
                                    successCount++;
                                } else {
                                    failCount++;
                                    errorList.push({ item: fileName, error: result.message || '未知错误' });
                                }
                            } catch (e) {
                                failCount++;
                                errorList.push({ item: fileName, error: e.message });
                            }

                            // 每5个文件输出一次进度日志
                            if ((i + 1) % 5 === 0 || i === eventlogFiles.length - 1) {
                                console.log(`进度: ${i + 1}/${eventlogFiles.length}, 成功: ${successCount}, 失败: ${failCount}`);
                            }
                        }

                        // 移除取消按钮
                        if (cancelButton && cancelButton.parentNode) {
                            cancelButton.parentNode.removeChild(cancelButton);
                        }

                        // 恢复按钮
                        extractEventlogBtn.disabled = false;
                        extractEventlogBtn.innerHTML = originalText;

                        // 显示结果
                        if (cancelled) {
                            // 已取消，不显示额外提示
                        } else if (failCount === 0) {
                            this.toast('success', '全部完成', `成功提取 ${successCount} 个事件日志文件\n保存到: ${outputDir}`);
                        } else if (successCount === 0) {
                            this.toast('error', '全部失败', `${failCount} 个文件提取失败\n${errorList.slice(0, 3).map(e => `${e.item}: ${e.error}`).join('\n')}`);
                        } else {
                            const errorMsg = errorList.slice(0, 3).map(e => `${e.item}: ${e.error}`).join('\n');
                            const moreMsg = errorList.length > 3 ? `\n...还有 ${errorList.length - 3} 个失败` : '';
                            this.toast('warning', '部分完成',
                                `成功: ${successCount} 个\n失败: ${failCount} 个\n\n失败列表:\n${errorMsg}${moreMsg}\n\n保存到: ${outputDir}`);
                        }

                    } catch (e) {
                        // 移除取消按钮
                        if (cancelButton && cancelButton.parentNode) {
                            cancelButton.parentNode.removeChild(cancelButton);
                        }

                        extractEventlogBtn.disabled = false;
                        extractEventlogBtn.innerHTML = originalText;
                        this.toast('error', '批量操作失败', e.message);
                    }
                }

                async dumpAllProcesses() {
                    // 批量导出/提取所有项目
                    if (!this.currentResults || this.currentResults.length === 0) {
                        this.toast('error', '无法导出', '没有可导出的项目');
                        return;
                    }

                    if (!this.api) {
                        this.toast('error', '无法导出', '请使用完整模式');
                        return;
                    }

                    const pluginId = this.activePlugin;
                    const totalItems = this.currentResults.length;

                    console.log('=== dumpAllProcesses called ===');
                    console.log('pluginId:', pluginId);
                    console.log('activePlugin:', this.activePlugin);

                    // ELF 文件和打开文件列表提取是单次操作，不需要循环
                    if (pluginId === 'linux_elfs') {
                        await this.extract_elf_files();
                        return;
                    }
                    if (pluginId === 'linux_lsof' || pluginId === 'mac_lsof') {
                        this.toast('info', '提示', '请使用操作列中的按钮单独下载文件');
                        return;
                    }
                    if (pluginId === 'linux_dumpfiles') {
                        await this.dump_files();
                        return;
                    }
                    if (pluginId === 'certificates') {
                        console.log('调用 dump_certificates()');
                        await this.dump_certificates();
                        return;
                    }

                    // 显示确认对话框
                    let actionText = '下载';
                    if (pluginId === 'filescan') {
                        actionText = '提取';
                    } else if (pluginId === 'dlllist') {
                        actionText = '提取';
                    }

                    const confirmed = await new Promise((resolve) => {
                        const overlay = document.getElementById('confirmOverlay');
                        const titleEl = document.getElementById('confirmTitle');
                        const messageEl = document.getElementById('confirmMessage');
                        const okBtn = document.getElementById('confirmOk');
                        const cancelBtn = document.getElementById('confirmCancel');

                        // 检查元素是否存在
                        if (!overlay || !titleEl || !messageEl || !okBtn || !cancelBtn) {
                            console.warn('确认对话框元素未找到，使用原生对话框');
                            const result = window.confirm(`即将${actionText} ${totalItems} 个项目\n\n这可能需要较长时间，建议确保有足够的存储空间。\n\n是否继续？`);
                            resolve(result);
                            return;
                        }

                        titleEl.textContent = '确认批量' + actionText;
                        messageEl.textContent = `即将${actionText} ${totalItems} 个项目\n\n这可能需要较长时间，建议确保有足够的存储空间。\n\n是否继续？`;
                        overlay.classList.remove('hidden');

                        const close = () => {
                            overlay.classList.add('hidden');
                        };

                        okBtn.onclick = () => {
                            close();
                            resolve(true);
                        };

                        cancelBtn.onclick = () => {
                            close();
                            resolve(false);
                        };

                        // ESC 键关闭
                        const handleEsc = (e) => {
                            if (e.key === 'Escape') {
                                close();
                                resolve(false);
                                document.removeEventListener('keydown', handleEsc);
                            }
                        };
                        document.addEventListener('keydown', handleEsc);
                    });

                    if (!confirmed) {
                        return;
                    }

                    // 让用户选择保存目录
                    const dirResult = await this.api.select_directory_dialog();
                    if (dirResult.status !== 'success') {
                        if (dirResult.status === 'cancelled') {
                            return;
                        }
                        this.toast('error', '目录选择失败', dirResult.message || '未知错误');
                        return;
                    }

                    const outputDir = dirResult.data.path;

                    // 创建目录
                    const createResult = await this.api.create_directory(outputDir);
                    if (createResult.status !== 'success') {
                        this.toast('error', '创建目录失败', createResult.message);
                        return;
                    }

                    const dumpAllBtn = document.getElementById('dumpAllBtn');
                    let successCount = 0;
                    let failCount = 0;
                    let errorList = [];

                    // 禁用按钮，显示进度
                    dumpAllBtn.disabled = true;
                    const originalText = dumpAllBtn.innerHTML;

                    // 根据插件类型设置不同的提示文字
                    let progressText = '下载中';
                    if (pluginId === 'filescan') {
                        progressText = '提取中';
                    } else if (pluginId === 'dlllist') {
                        progressText = '提取中';
                    }

                    dumpAllBtn.innerHTML = `
                        <svg class="spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48-8.48l2.83-2.83M2 12h4m12 0h4M4.93 19.07l2.83 2.83m8.48-8.48l2.83-2.83"/>
                            <circle cx="12" cy="12" r="10"/>
                        </svg>
                        <span id="progressText">${progressText}... (0/${totalItems})</span>
                    `;

                    // 添加取消按钮
                    const cancelButton = document.createElement('button');
                    cancelButton.className = 'cancel-btn';
                    cancelButton.textContent = '取消';
                    cancelButton.style.cssText = 'margin-left: 8px; padding: 4px 12px; font-size: 12px;';
                    dumpAllBtn.parentNode.appendChild(cancelButton);

                    let cancelled = false;
                    cancelButton.onclick = () => {
                        cancelled = true;
                        cancelButton.disabled = true;
                        cancelButton.textContent = '取消中...';
                    };

                    try {
                        // 逐个处理，显示进度
                        for (let i = 0; i < this.currentResults.length; i++) {
                            // 检查是否取消
                            if (cancelled) {
                                this.toast('warning', '已取消', `已处理 ${i + 1}/${totalItems} 个项目\n成功: ${successCount}, 失败: ${failCount}`);
                                break;
                            }

                            const item = this.currentResults[i];

                            // 更新进度
                            const progressTextEl = document.getElementById('progressText');
                            if (progressTextEl) {
                                progressTextEl.textContent = `${progressText}... (${i + 1}/${totalItems})`;
                            }

                            try {
                                let result;
                                if (pluginId === 'filescan') {
                                    // 提取文件
                                    const fileName = item.path ? item.path.split('\\').pop().split('/').pop() : 'unknown';
                                    result = await this.api.extract_file(item.offset, outputDir);
                                } else if (pluginId === 'dlllist') {
                                    // 提取DLL
                                    result = await this.api.extract_dll(String(item.pid), item.base_address, outputDir);
                                } else {
                                    // 导出进程内存
                                    const pid = item.pid;
                                    result = await this.api.dump_process_memory(pid, outputDir);
                                }

                                if (result.status === 'success') {
                                    successCount++;
                                } else {
                                    failCount++;
                                    errorList.push({
                                        index: i + 1,
                                        item: item.name || item.path || item.file_name || `项目${i + 1}`,
                                        error: result.message || result.data?.error || '未知错误'
                                    });
                                }
                            } catch (e) {
                                failCount++;
                                errorList.push({
                                    index: i + 1,
                                    item: item.name || item.path || item.file_name || `项目${i + 1}`,
                                    error: e.message
                                });
                            }

                            // 每10个更新一次提示，避免过于频繁
                            if ((i + 1) % 10 === 0 || i === this.currentResults.length - 1) {
                                console.log(`进度: ${i + 1}/${totalItems}, 成功: ${successCount}, 失败: ${failCount}`);
                            }
                        }

                        // 移除取消按钮
                        if (cancelButton && cancelButton.parentNode) {
                            cancelButton.parentNode.removeChild(cancelButton);
                        }

                        // 恢复按钮
                        dumpAllBtn.disabled = false;
                        dumpAllBtn.innerHTML = originalText;

                        // 显示结果
                        if (cancelled) {
                            // 已取消，不显示额外提示
                        } else if (failCount === 0) {
                            this.toast('success', '全部完成', `成功${actionText} ${successCount} 个项目\n保存到: ${outputDir}`);
                        } else if (successCount === 0) {
                            this.toast('error', '全部失败', `${failCount} 个项目${actionText}失败\n${errorList.slice(0, 3).map(e => `${e.item}: ${e.error}`).join('\n')}`);
                        } else {
                            const errorMsg = errorList.slice(0, 3).map(e => `${e.item}: ${e.error}`).join('\n');
                            const moreMsg = errorList.length > 3 ? `\n...还有 ${errorList.length - 3} 个失败` : '';
                            this.toast('warning', '部分完成',
                                `成功: ${successCount} 个\n失败: ${failCount} 个\n\n失败列表:\n${errorMsg}${moreMsg}\n\n保存到: ${outputDir}`);
                        }

                    } catch (e) {
                        // 移除取消按钮
                        if (cancelButton && cancelButton.parentNode) {
                            cancelButton.parentNode.removeChild(cancelButton);
                        }

                        dumpAllBtn.disabled = false;
                        dumpAllBtn.innerHTML = originalText;
                        this.toast('error', '批量操作失败', e.message);
                    }
                }

                async extractElfFile(pid, start, fileName) {
                    // 提取单个 ELF 文件
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    try {
                        this.showLoading('正在提取 ELF 文件...');
                        const result = await this.api.extract_elf_file(String(pid), start, fileName);
                        this.hideLoading();

                        if (result.status === 'success') {
                            this.toast('success', '提取成功', `ELF 文件已保存到: ${result.data.output_path}`);
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.hideLoading();
                        this.toast('error', '提取失败', e.message);
                    }
                }

                async extractLsofFile(filePath, pluginId) {
                    // 提取打开文件列表中的单个文件
                    if (!this.api) {
                        this.toast('error', '无法提取', '请使用完整模式');
                        return;
                    }

                    try {
                        this.showLoading('正在提取文件...');
                        const result = await this.api.extract_lsof_file(filePath, pluginId);
                        this.hideLoading();

                        if (result.status === 'success') {
                            this.toast('success', '提取成功', `文件已保存到: ${result.data.output_path}`);
                        } else {
                            this.toast('error', '提取失败', result.message || '未知错误');
                        }
                    } catch (e) {
                        this.hideLoading();
                        this.toast('error', '提取失败', e.message);
                    }
                }

                viewHiveDetails(hiveRow) {
                    // 查看注册表配置单元详情
                    const offset = hiveRow.offset;
                    const key = hiveRow.printkey_path || '';
                    const hivePath = hiveRow.path || hiveRow.name;

                    // 检查是否是同一个 hive（避免清空历史记录）
                    const isSameHive = this.currentRegistryContext &&
                                      this.currentRegistryContext.offset === offset;

                    if (!isSameHive) {
                        // 切换到不同 hive，清除导航历史
                        this.registryNavigationHistory = [];
                    }

                    // 保存当前注册表上下文，用于子键导航
                    this.currentRegistryContext = {
                        offset: offset,
                        currentPath: key,
                        hivePath: hivePath
                    };

                    this.toast('info', '正在加载...', `正在读取 ${hivePath} 的内容`);

                    // 调用printkey插件，同时传递 offset 和 key 参数
                    const params = { offset: offset };

                    // 注意：当从 hivelist 进入时，key 通常为空
                    // volatility3 的 printkey 插件在没有 key 参数时会显示 hive 根目录
                    if (key) {
                        params.key = key;
                    }

                    this.runPlugin('printkey', params);
                }

                viewRegistrySubkey(subkeyRow) {
                    // 查看注册表子键详情
                    if (!this.currentRegistryContext) {
                        this.toast('error', '错误', '缺少注册表上下文');
                        return;
                    }

                    // 初始化导航历史
                    if (!this.registryNavigationHistory) {
                        this.registryNavigationHistory = [];
                    }

                    // 保存当前状态到历史
                    this.registryNavigationHistory.push({
                        offset: this.currentRegistryContext.offset,
                        currentPath: this.currentRegistryContext.currentPath || '',
                        hivePath: this.currentRegistryContext.hivePath
                    });

                    const subkeyName = subkeyRow.name || '(Default)';
                    const currentPath = this.currentRegistryContext.currentPath || '';

                    // 构建新的完整路径：当前路径 + 子键名称
                    // 例如：当前空 -> 点击 SAM -> 新路径 "SAM"
                    // 例如：当前 "SAM" -> 点击 Domains -> 新路径 "SAM\Domains"
                    let newPath;
                    if (currentPath) {
                        newPath = currentPath + '\\' + subkeyName;
                    } else {
                        newPath = subkeyName;
                    }

                    // 更新当前上下文
                    this.currentRegistryContext.currentPath = newPath;

                    this.toast('info', '正在加载...', `正在读取 ${newPath}`);

                    // 调用printkey插件，传递完整路径
                    this.runPlugin('printkey', {
                        offset: this.currentRegistryContext.offset,
                        key: newPath
                    });
                }

                goBackRegistry() {
                    // 返回上一级注册表
                    const historyLength = this.registryNavigationHistory ? this.registryNavigationHistory.length : 0;

                    // 如果历史记录为空，说明已经在 hive 根目录
                    // 此时应该返回到 hivelist，而不是显示"已经是第一级"
                    if (!this.registryNavigationHistory || historyLength === 0) {
                        // 清空上下文，返回到 hivelist
                        this.currentRegistryContext = null;
                        this.registryNavigationHistory = [];

                        this.toast('info', '返回', '返回到注册表配置单元列表');

                        // 重新执行 hivelist
                        this.runPlugin('hivelist', {});
                        return;
                    }

                    // 弹出历史记录
                    const previousState = this.registryNavigationHistory.pop();

                    // 恢复上下文
                    this.currentRegistryContext = {
                        offset: previousState.offset,
                        currentPath: previousState.currentPath,
                        hivePath: previousState.hivePath
                    };

                    this.toast('info', '正在返回...', `正在返回到: ${previousState.currentPath || '(根目录)'}`);

                    // 调用printkey插件
                    const params = { offset: previousState.offset };
                    if (previousState.currentPath) {
                        params.key = previousState.currentPath;
                    }

                    this.runPlugin('printkey', params);
                }

                getRegistryBreadcrumb() {
                    // 获取注册表路径面包屑
                    if (!this.currentRegistryContext) {
                        return '';
                    }

                    const hiveName = this.currentRegistryContext.hivePath.split('\\').pop() || this.currentRegistryContext.hivePath;
                    const currentPath = this.currentRegistryContext.currentPath || '';

                    if (!currentPath) {
                        return hiveName;
                    }

                    // 解析路径（单反斜杠分割）
                    const pathParts = currentPath.split('\\').filter(p => p);
                    const fullPath = [hiveName, ...pathParts];

                    return fullPath.join(' > ');
                }

                applySearchAndSort(results) {
                    let data = [...results];

                    // 应用筛选条件
                    if (this.filters && this.filters.length > 0) {
                        data = data.filter(row => {
                            return this.filters.every(filter => {
                                const value = row[filter.column];
                                const filterValue = filter.value;

                                switch (filter.operator) {
                                    case 'contains':
                                        return value !== undefined && String(value).toLowerCase().includes(filterValue.toLowerCase());
                                    case 'not_contains':
                                        return value === undefined || !String(value).toLowerCase().includes(filterValue.toLowerCase());
                                    case 'equals':
                                        return String(value) === filterValue;
                                    case 'not_equals':
                                        return String(value) !== filterValue;
                                    case 'greater_than':
                                        return !isNaN(value) && !isNaN(filterValue) && Number(value) > Number(filterValue);
                                    case 'less_than':
                                        return !isNaN(value) && !isNaN(filterValue) && Number(value) < Number(filterValue);
                                    case 'greater_equal':
                                        return !isNaN(value) && !isNaN(filterValue) && Number(value) >= Number(filterValue);
                                    case 'less_equal':
                                        return !isNaN(value) && !isNaN(filterValue) && Number(value) <= Number(filterValue);
                                    case 'is_empty':
                                        return value === undefined || value === null || String(value).trim() === '';
                                    case 'is_not_empty':
                                        return value !== undefined && value !== null && String(value).trim() !== '';
                                    default:
                                        return true;
                                }
                            });
                        });
                    }

                    // 应用搜索
                    if (this.searchTerm) {
                        const term = this.searchTerm.toLowerCase();
                        data = data.filter(row => {
                            return Object.values(row).some(val =>
                                String(val).toLowerCase().includes(term)
                            );
                        });
                    }

                    // 应用排序
                    if (this.sortColumn) {
                        data.sort((a, b) => {
                            const aVal = a[this.sortColumn];
                            const bVal = b[this.sortColumn];

                            if (aVal === bVal) return 0;
                            if (aVal === undefined || aVal === null) return 1;
                            if (bVal === undefined || bVal === null) return -1;

                            let comparison = 0;
                            if (typeof aVal === 'number' && typeof bVal === 'number') {
                                comparison = aVal - bVal;
                            } else {
                                comparison = String(aVal).localeCompare(String(bVal));
                            }

                            return this.sortDirection === 'asc' ? comparison : -comparison;
                        });
                    }

                    return data;
                }

                handleSearch(term) {
                    this.searchTerm = term;
                    this.currentPage = 1;
                    this.refreshTable();
                }

                updateSearchBoxState() {
                    /** 根据当前插件更新搜索框行为
                     * 页缓存文件等数据量大的插件需要手动搜索
                     */
                    const tableSearch = document.getElementById('tableSearch');
                    const searchBtn = document.getElementById('searchBtn');
                    if (!tableSearch || !searchBtn) return;

                    const isPageCacheFiles = this.currentPluginId === 'linux_pagecache_files';

                    // 移除所有旧的事件监听器
                    const newSearchInput = tableSearch.cloneNode(true);
                    tableSearch.parentNode.replaceChild(newSearchInput, tableSearch);
                    const newSearchBtn = searchBtn.cloneNode(true);
                    searchBtn.parentNode.replaceChild(newSearchBtn, searchBtn);

                    // 重新获取元素引用
                    const input = document.getElementById('tableSearch');
                    const btn = document.getElementById('searchBtn');

                    if (isPageCacheFiles) {
                        // 显示搜索按钮，禁用实时搜索
                        btn.classList.remove('hidden');
                        input.placeholder = '输入搜索内容后点击按钮或回车...';

                        // 绑定搜索按钮点击事件
                        btn.addEventListener('click', () => {
                            this.handleSearch(input.value);
                        });

                        // 绑定回车键搜索
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                this.handleSearch(input.value);
                            }
                        });
                    } else {
                        // 隐藏搜索按钮，启用实时搜索
                        btn.classList.add('hidden');
                        input.placeholder = '搜索...';

                        // 使用防抖的实时搜索
                        const debouncedSearch = this.debounce((value) => this.handleSearch(value), 300);
                        input.addEventListener('input', (e) => debouncedSearch(e.target.value));
                    }
                }

                // 防抖函数
                debounce(func, wait) {
                    let timeout;
                    return function executedFunction(...args) {
                        const later = () => {
                            clearTimeout(timeout);
                            func(...args);
                        };
                        clearTimeout(timeout);
                        timeout = setTimeout(later, wait);
                    };
                }

                handleSort(column) {
                    if (this.sortColumn === column) {
                        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortColumn = column;
                        this.sortDirection = 'asc';
                    }
                    this.refreshTable();
                }

                refreshTable() {
                    if (!this.currentResults || !this.currentPluginId) return;
                    const thead = document.getElementById('resultsTableHead');
                    const tbody = document.getElementById('resultsTableBody');
                    this.buildTable(thead, tbody, this.currentResults, this.currentPluginId);
                }

                toggleViewMode() {
                    this.viewMode = this.viewMode === 'scroll' ? 'pagination' : 'scroll';
                    this.currentPage = 1;

                    const viewModeText = document.getElementById('viewModeText');
                    const pagination = document.getElementById('resultsPagination');
                    const tableContainer = document.getElementById('resultsTableContainer');

                    if (viewModeText) viewModeText.textContent = this.viewMode === 'scroll' ? '滚动' : '分页';

                    if (this.viewMode === 'pagination') {
                        if (pagination) pagination.classList.remove('hidden');
                        if (tableContainer) tableContainer.style.maxHeight = 'none';
                    } else {
                        if (pagination) pagination.classList.add('hidden');
                        if (tableContainer) tableContainer.style.maxHeight = '500px';
                    }

                    this.refreshTable();
                }

                getTotalPages() {
                    const filtered = this.applySearchAndSort(this.currentResults || []);
                    return Math.ceil(filtered.length / this.pageSize) || 1;
                }

                goToPage(page) {
                    const totalPages = this.getTotalPages();
                    if (page < 1) page = 1;
                    if (page > totalPages) page = totalPages;
                    this.currentPage = page;
                    this.refreshTable();
                }

                changePageSize(size) {
                    this.pageSize = size;
                    this.currentPage = 1;
                    this.refreshTable();
                }

                updatePaginationControls() {
                    const filtered = this.applySearchAndSort(this.currentResults || []);
                    const totalItems = filtered.length;
                    const totalPages = Math.ceil(totalItems / this.pageSize) || 1;
                    const startIndex = (this.currentPage - 1) * this.pageSize + 1;
                    const endIndex = Math.min(startIndex + this.pageSize - 1, totalItems);

                    // 更新分页信息
                    const paginationInfo = document.getElementById('paginationInfo');
                    if (paginationInfo) {
                        paginationInfo.textContent = totalItems > 0 ?
                            `显示 ${startIndex}-${endIndex} 共 ${totalItems} 条` :
                            '暂无数据';
                    }

                    // 更新页码输入
                    const pageInput = document.getElementById('pageInput');
                    if (pageInput) {
                        pageInput.value = this.currentPage;
                        pageInput.max = totalPages;
                    }

                    // 更新总页数
                    const totalPagesEl = document.getElementById('totalPages');
                    if (totalPagesEl) totalPagesEl.textContent = totalPages;

                    // 更新按钮状态
                    const firstPageBtn = document.getElementById('firstPageBtn');
                    const prevPageBtn = document.getElementById('prevPageBtn');
                    const nextPageBtn = document.getElementById('nextPageBtn');
                    const lastPageBtn = document.getElementById('lastPageBtn');

                    if (firstPageBtn) firstPageBtn.disabled = this.currentPage === 1;
                    if (prevPageBtn) prevPageBtn.disabled = this.currentPage === 1;
                    if (nextPageBtn) nextPageBtn.disabled = this.currentPage === totalPages;
                    if (lastPageBtn) lastPageBtn.disabled = this.currentPage === totalPages;
                }

                showConfirm(title, message) {
                    // 显示自定义确认对话框，返回 Promise
                    return new Promise((resolve) => {
                        const overlay = document.getElementById('confirmOverlay');
                        const titleEl = document.getElementById('confirmTitle');
                        const messageEl = document.getElementById('confirmMessage');
                        const okBtn = document.getElementById('confirmOk');
                        const cancelBtn = document.getElementById('confirmCancel');

                        titleEl.textContent = title;
                        messageEl.textContent = message;
                        overlay.classList.remove('hidden');

                        const close = () => {
                            overlay.classList.add('hidden');
                        };

                        okBtn.onclick = () => {
                            close();
                            resolve(true);
                        };

                        cancelBtn.onclick = () => {
                            close();
                            resolve(false);
                        };

                        // ESC 键关闭
                        const handleEsc = (e) => {
                            if (e.key === 'Escape') {
                                close();
                                resolve(false);
                                document.removeEventListener('keydown', handleEsc);
                            }
                        };
                        document.addEventListener('keydown', handleEsc);
                    });
                }

                showFilterDialog() {
                    if (!this.currentPluginId) {
                        this.toast('warning', '无数据', '请先执行分析');
                        return;
                    }

                    const columns = this.getTableColumns(this.currentPluginId);
                    if (!columns || columns.length === 0) {
                        this.toast('warning', '无列', '当前数据没有可筛选的列');
                        return;
                    }

                    // 创建对话框
                    const dialog = document.createElement('div');
                    dialog.className = 'filter-dialog';
                    dialog.innerHTML = `
                        <div class="filter-dialog-content">
                            <div class="filter-dialog-header">
                                <h3>高级筛选</h3>
                                <button class="filter-dialog-close" id="closeFilterBtn">&times;</button>
                            </div>
                            <div class="filter-dialog-body">
                                <div class="filter-conditions" id="filterConditions">
                                    ${this.filters.map((filter, index) => this.renderFilterCondition(filter, columns, index)).join('')}
                                </div>
                                <button class="filter-add-btn" id="addFilterBtn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    添加筛选条件
                                </button>
                            </div>
                            <div class="filter-dialog-footer">
                                <button class="filter-btn-secondary" id="clearFiltersBtn">清除全部</button>
                                <button class="filter-btn-primary" id="applyFiltersBtn">应用筛选</button>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(dialog);

                    // 绑定事件
                    const closeBtn = document.getElementById('closeFilterBtn');
                    const applyBtn = document.getElementById('applyFiltersBtn');
                    const clearBtn = document.getElementById('clearFiltersBtn');
                    const addBtn = document.getElementById('addFilterBtn');

                    const closeDialog = () => {
                        document.body.removeChild(dialog);
                    };

                    closeBtn.addEventListener('click', closeDialog);

                    applyBtn.addEventListener('click', () => {
                        this.applyFilters();
                        closeDialog();
                    });

                    clearBtn.addEventListener('click', () => {
                        this.filters = [];
                        this.currentPage = 1;
                        this.refreshTable();
                        this.updateFilterButton();
                        closeDialog();
                    });

                    addBtn.addEventListener('click', () => {
                        this.filters.push({ column: columns[0].key, operator: 'contains', value: '' });
                        this.updateFilterConditions();
                    });

                    // 点击对话框外部关闭
                    dialog.addEventListener('click', (e) => {
                        if (e.target === dialog) closeDialog();
                    });

                    // 初始化筛选条件事件
                    this.initFilterConditionEvents();
                }

                renderFilterCondition(filter, columns, index) {
                    const operatorOptions = [
                        { value: 'contains', label: '包含' },
                        { value: 'not_contains', label: '不包含' },
                        { value: 'equals', label: '等于' },
                        { value: 'not_equals', label: '不等于' },
                        { value: 'greater_than', label: '大于' },
                        { value: 'less_than', label: '小于' },
                        { value: 'greater_equal', label: '大于等于' },
                        { value: 'less_equal', label: '小于等于' },
                        { value: 'is_empty', label: '为空' },
                        { value: 'is_not_empty', label: '不为空' }
                    ];

                    return `
                        <div class="filter-condition" data-index="${index}">
                            <select class="filter-column">
                                ${columns.map(col => `<option value="${col.key}" ${filter.column === col.key ? 'selected' : ''}>${col.label}</option>`).join('')}
                            </select>
                            <select class="filter-operator">
                                ${operatorOptions.map(op => `<option value="${op.value}" ${filter.operator === op.value ? 'selected' : ''}>${op.label}</option>`).join('')}
                            </select>
                            <input type="text" class="filter-value" value="${filter.value || ''}" placeholder="值" ${filter.operator === 'is_empty' || filter.operator === 'is_not_empty' ? 'disabled' : ''}>
                            <button class="filter-remove-btn" data-index="${index}" title="删除此条件">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    `;
                }

                initFilterConditionEvents() {
                    // 删除按钮事件
                    document.querySelectorAll('.filter-remove-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const index = parseInt(btn.dataset.index);
                            this.filters.splice(index, 1);
                            this.updateFilterConditions();
                        });
                    });

                    // 列选择变化事件
                    document.querySelectorAll('.filter-column').forEach(select => {
                        select.addEventListener('change', (e) => {
                            const index = parseInt(e.target.closest('.filter-condition').dataset.index);
                            this.filters[index].column = e.target.value;
                        });
                    });

                    // 操作符变化事件
                    document.querySelectorAll('.filter-operator').forEach(select => {
                        select.addEventListener('change', (e) => {
                            const index = parseInt(e.target.closest('.filter-condition').dataset.index);
                            this.filters[index].operator = e.target.value;
                            const valueInput = e.target.closest('.filter-condition').querySelector('.filter-value');
                            if (e.target.value === 'is_empty' || e.target.value === 'is_not_empty') {
                                valueInput.disabled = true;
                                valueInput.value = '';
                            } else {
                                valueInput.disabled = false;
                            }
                        });
                    });

                    // 值输入变化事件
                    document.querySelectorAll('.filter-value').forEach(input => {
                        input.addEventListener('input', (e) => {
                            const index = parseInt(e.target.closest('.filter-condition').dataset.index);
                            this.filters[index].value = e.target.value;
                        });
                    });
                }

                updateFilterConditions() {
                    const columns = this.getTableColumns(this.currentPluginId);
                    const conditionsContainer = document.getElementById('filterConditions');
                    if (conditionsContainer) {
                        conditionsContainer.innerHTML = this.filters.map((filter, index) => this.renderFilterCondition(filter, columns, index)).join('');
                        this.initFilterConditionEvents();
                    }
                }

                applyFilters() {
                    // 移除空的筛选条件
                    this.filters = this.filters.filter(f => f.value !== '' || f.operator === 'is_empty' || f.operator === 'is_not_empty');
                    this.currentPage = 1;
                    this.refreshTable();
                    this.updateFilterButton();

                    const filteredCount = this.applySearchAndSort(this.currentResults || []).length;
                    this.toast('success', '筛选已应用', `筛选后剩余 ${filteredCount} 条记录`);
                }

                updateFilterButton() {
                    const filterBtn = document.getElementById('filterBtn');
                    if (filterBtn) {
                        if (this.filters.length > 0) {
                            filterBtn.classList.add('has-filter');
                            filterBtn.title = `筛选 (${this.filters.length} 个条件)`;
                        } else {
                            filterBtn.classList.remove('has-filter');
                            filterBtn.title = '筛选';
                        }
                    }
                }

                getTableColumns(pluginId) {
                    const columnMap = {
                        'pslist': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'threads', label: '线程' },
                            { key: 'handles', label: '句柄' },
                            { key: 'create_time', label: '创建时间' }
                        ],
                        'pstree': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'threads', label: '线程', monospace: true },
                            { key: 'handles', label: '句柄', monospace: true },
                            { key: 'session_id', label: '会话', monospace: true },
                            { key: 'wow64', label: 'Wow64', monospace: true },
                            { key: 'create_time', label: '创建时间' },
                            { key: 'exit_time', label: '退出时间' },
                            { key: 'command_line', label: '命令行' }
                        ],
                        'psscan': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'threads', label: '线程', monospace: true },
                            { key: 'handles', label: '句柄', monospace: true },
                            { key: 'session_id', label: '会话', monospace: true },
                            { key: 'create_time', label: '创建时间' }
                        ],
                        'dlllist': [
                            { key: 'pid', label: 'PID', monospace: true, width: 80 },
                            { key: 'process_name', label: '进程名', width: 120 },
                            { key: 'base_address', label: '基址', monospace: true, width: 110 },
                            { key: 'size', label: '大小', width: 80 },
                            { key: 'name', label: 'DLL名称', wrap: true },
                            { key: 'path', label: '路径', wrap: true }
                        ],
                        'handles': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程名' },
                            { key: 'handle_value', label: '句柄值', monospace: true },
                            { key: 'type', label: '类型' },
                            { key: 'name', label: '名称' }
                        ],
                        'cmdline': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'command_line', label: '命令行' }
                        ],
                        'envars': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程名' },
                            { key: 'variable', label: '变量名' },
                            { key: 'value', label: '值', wrap: true }
                        ],
                        'getsids': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程名' },
                            { key: 'sid', label: 'SID', monospace: true },
                            { key: 'attributes', label: '属性' }
                        ],
                        'netscan': [
                            { key: 'protocol', label: '协议' },
                            { key: 'local_address', label: '本地地址', monospace: true },
                            { key: 'local_port', label: '本地端口', monospace: true },
                            { key: 'remote_address', label: '远程地址', monospace: true },
                            { key: 'remote_port', label: '远程端口', monospace: true },
                            { key: 'state', label: '状态' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程' },
                            { key: 'create_time', label: '创建时间' }
                        ],
                        'svcscan': [
                            { key: 'order', label: '序号', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '服务名', width: 130 },
                            { key: 'display', label: '显示名称' },
                            { key: 'type', label: '服务类型', wrap: true, width: 200 },
                            { key: 'state', label: '状态', format: v => {
                                const colors = {
                                    'running': 'success',
                                    'stopped': 'error',
                                    'paused': 'warning'
                                };
                                const color = colors[v?.toLowerCase()] || 'normal';
                                return `<span class="tag ${color}">${v}</span>`;
                            }},
                            { key: 'start', label: '启动类型', wrap: true, width: 150 },
                            { key: 'binary', label: '可执行文件' }
                        ],
                        'filescan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'path', label: '路径', wrap: true }
                        ],
                        'eventlog': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'path', label: '路径', wrap: true }
                        ],
                        'hivelist': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'path', label: '路径' },
                            { key: 'hive_type', label: '类型' }
                        ],
                        'printkey': [
                            { key: 'key', label: '键名', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'type', label: '类型' },
                            { key: 'data', label: '数据', monospace: true, wrap: true },
                            { key: 'last_write_time', label: '最后写入时间' }
                        ],
                        'certificates': [
                            { key: 'path', label: '证书路径', monospace: true, wrap: true },
                            { key: 'section', label: '证书区域' },
                            { key: 'id', label: '证书ID', monospace: true },
                            { key: 'name', label: '证书名称' },
                            { key: 'hive', label: '配置单元', monospace: true }
                        ],
                        'malfind': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程名' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'size', label: '大小', format: v => this.formatSize(v) },
                            { key: 'protection', label: '保护', monospace: true },
                            { key: 'suspicious', label: '可疑', format: v => v ? '<span class="tag error">是</span>' : '<span class="tag success">否</span>' }
                        ],
                        'hashdump': [
                            { key: 'username', label: '用户名' },
                            { key: 'rid', label: 'RID', monospace: true },
                            { key: 'hash_lm', label: 'LM哈希', monospace: true },
                            { key: 'hash_ntlm', label: 'NTLM哈希', monospace: true }
                        ],
                        'lsadump': [
                            { key: 'key', label: '密钥名称' },
                            { key: 'value', label: '值', monospace: true }
                        ],
                        'cachedump': [
                            { key: 'username', label: '用户名' },
                            { key: 'domain', label: '域' },
                            { key: 'domain_name', label: '域名' },
                            { key: 'hash_ntlm', label: 'NTLM哈希', monospace: true }
                        ],
                        // Windows 新增插件列定义
                        'cmdscan': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'console_info', label: '控制台信息', monospace: true },
                            { key: 'property', label: '属性' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'data', label: '数据', wrap: true }
                        ],
                        'consoles': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'console_info', label: '控制台信息', monospace: true },
                            { key: 'property', label: '属性' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'data', label: '数据', wrap: true }
                        ],
                        'psxview': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'pslist', label: 'PsList', monospace: true },
                            { key: 'psscan', label: 'PsScan', monospace: true },
                            { key: 'thrdscan', label: 'ThrdScan', monospace: true },
                            { key: 'csrss', label: 'Csrss', monospace: true },
                            { key: 'exit_time', label: '退出时间' }
                        ],
                        'ldrmodules': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'base', label: '基址', monospace: true },
                            { key: 'inload', label: 'InLoad', monospace: true },
                            { key: 'ininit', label: 'InInit', monospace: true },
                            { key: 'inmem', label: 'InMem', monospace: true },
                            { key: 'mappedpath', label: '路径', wrap: true }
                        ],
                        // Windows 恶意软件检测（新版本）
                        'hollowprocesses': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'create_time', label: '创建时间' }
                        ],
                        'svcdiff': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'display_type', label: '显示类型' },
                            { key: 'start_type', label: '启动类型' },
                            { key: 'binary_path', label: '路径', wrap: true },
                            { key: 'service_type', label: '服务类型' }
                        ],
                        'unhooked_system_calls': [
                            { key: 'function', label: '函数', monospace: true, wrap: true },
                            { key: 'distinct_implementations', label: '不同实现数', monospace: true },
                            { key: 'total_implementations', label: '总实现数', monospace: true },
                            { key: 'different_processes', label: '不同进程', wrap: true }
                        ],
                        'processghosting': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'create_time', label: '创建时间' },
                            { key: 'exit_time', label: '退出时间' }
                        ],
                        'malware_psxview': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'pslist', label: 'PsList', monospace: true },
                            { key: 'psscan', label: 'PsScan', monospace: true },
                            { key: 'thrdscan', label: 'ThrdScan', monospace: true },
                            { key: 'csrss', label: 'Csrss', monospace: true },
                            { key: 'exit_time', label: '退出时间' }
                        ],
                        'pebmasquerade': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '进程名', width: 120 },
                            { key: 'seaudit_name', label: 'SeAudit名称', width: 120 },
                            { key: 'peb_path', label: 'PEB路径', wrap: true },
                            { key: 'path_spoofed', label: '路径伪装', monospace: true, width: 80 },
                            { key: 'cmdline_spoofed', label: '命令行伪装', monospace: true, width: 80 }
                        ],
                        'callbacks': [
                            { key: 'type', label: '类型' },
                            { key: 'callback', label: '回调', monospace: true },
                            { key: 'module', label: '模块' },
                            { key: 'symbol', label: '符号', wrap: true },
                            { key: 'detail', label: '详情', wrap: true }
                        ],
                        'privileges': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'value', label: '值', monospace: true },
                            { key: 'privilege', label: '权限', wrap: true },
                            { key: 'attributes', label: '属性' },
                            { key: 'description', label: '描述', wrap: true }
                        ],
                        'sessions': [
                            { key: 'session_id', label: '会话ID', monospace: true },
                            { key: 'session_type', label: '会话类型', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'user_name', label: '用户名', wrap: true },
                            { key: 'create_time', label: '创建时间' }
                        ],
                        'threads': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'tid', label: 'TID', monospace: true },
                            { key: 'start_address', label: '起始地址', monospace: true },
                            { key: 'start_path', label: '起始路径', wrap: true },
                            { key: 'win32_start_address', label: 'Win32地址', monospace: true },
                            { key: 'win32_start_path', label: 'Win32路径', wrap: true },
                            { key: 'create_time', label: '创建时间' },
                            { key: 'exit_time', label: '退出时间' }
                        ],
                        'vadinfo': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程', width: 150 },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'start_vpn', label: '起始VPN', monospace: true },
                            { key: 'end_vpn', label: '结束VPN', monospace: true },
                            { key: 'tag', label: '标签', width: 80 },
                            { key: 'protection', label: '保护', monospace: true },
                            { key: 'commit_charge', label: '提交 charge', monospace: true },
                            { key: 'private_memory', label: '私有内存', monospace: true },
                            { key: 'parent', label: '父级', monospace: true },
                            { key: 'file', label: '文件', width: 400, wrap: true },
                            { key: 'file_output', label: '文件输出', width: 100 }
                        ],
                        'mutantscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称', wrap: true }
                        ],
                        'modscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'base', label: '基址', monospace: true },
                            { key: 'size', label: '大小', monospace: true },
                            { key: 'name', label: '名称', width: 150 },
                            { key: 'path', label: '路径', width: 400, wrap: true },
                            { key: 'file_output', label: '文件输出', width: 100 }
                        ],
                        'ssdt': [
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'service', label: '服务' },
                            { key: 'symbol', label: '符号', wrap: true }
                        ],
                        'driverscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'start', label: '起始', monospace: true },
                            { key: 'size', label: '大小', monospace: true },
                            { key: 'service_key', label: '服务键', wrap: true },
                            { key: 'driver_name', label: '驱动名', wrap: true },
                            { key: 'name', label: '名称', wrap: true }
                        ],
                        'drivermodule': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'known_exception', label: '已知异常' },
                            { key: 'driver_name', label: '驱动名', wrap: true },
                            { key: 'service_key', label: '服务键', wrap: true },
                            { key: 'alternative_name', label: '别名', wrap: true }
                        ],
                        'driverirp': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'driver_name', label: '驱动名', wrap: true },
                            { key: 'irp', label: 'IRP', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'module', label: '模块' },
                            { key: 'symbol', label: '符号', wrap: true }
                        ],
                        'shimcachemem': [
                            { key: 'order', label: '顺序', monospace: true },
                            { key: 'last_modified', label: '最后修改' },
                            { key: 'last_update', label: '最后更新' },
                            { key: 'exec_flag', label: '执行标志', monospace: true },
                            { key: 'file_size', label: '文件大小', monospace: true },
                            { key: 'file_path', label: '文件路径', wrap: true }
                        ],
                        'mftscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'record_type', label: '记录类型' },
                            { key: 'record_number', label: '记录号', monospace: true },
                            { key: 'link_count', label: '链接数', monospace: true },
                            { key: 'mft_type', label: 'MFT类型' },
                            { key: 'permissions', label: '权限' },
                            { key: 'attribute_type', label: '属性类型' },
                            { key: 'created', label: '创建时间' },
                            { key: 'modified', label: '修改时间' },
                            { key: 'updated', label: '更新时间' },
                            { key: 'accessed', label: '访问时间' },
                            { key: 'filename', label: '文件名', wrap: true }
                        ],
                        'mbrscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'disk_signature', label: '磁盘签名' },
                            { key: 'bootcode_md5', label: '启动代码MD5' },
                            { key: 'full_mbr_md5', label: '完整MBR MD5' },
                            { key: 'partition_index', label: '分区索引', monospace: true },
                            { key: 'bootable', label: '可启动', monospace: true },
                            { key: 'partition_type', label: '分区类型' },
                            { key: 'sector_size', label: '扇区大小', monospace: true },
                            { key: 'disasm', label: '反汇编', wrap: true }
                        ],
                        'crashinfo': [
                            { key: 'signature', label: '签名' },
                            { key: 'major_version', label: '主版本', monospace: true },
                            { key: 'minor_version', label: '次版本', monospace: true },
                            { key: 'directory_table_base', label: '目录表基址', monospace: true },
                            { key: 'pfn_data_base', label: 'PFN数据库', monospace: true },
                            { key: 'ps_loaded_module_list', label: '模块列表', monospace: true },
                            { key: 'ps_active_process_head', label: '进程链表头', monospace: true }
                        ],
                        'deskscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'window_station', label: '窗口站', wrap: true },
                            { key: 'session', label: '会话', monospace: true },
                            { key: 'desktop', label: '桌面' },
                            { key: 'process', label: '进程' },
                            { key: 'pid', label: 'PID', monospace: true }
                        ],
                        'desktops': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'window_station', label: '窗口站', wrap: true },
                            { key: 'session', label: '会话', monospace: true },
                            { key: 'desktop', label: '桌面' },
                            { key: 'process', label: '进程' },
                            { key: 'pid', label: 'PID', monospace: true }
                        ],
                        'devicetree': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'type', label: '类型' },
                            { key: 'driver_name', label: '驱动名', wrap: true },
                            { key: 'device_name', label: '设备名', wrap: true },
                            { key: 'driver_name_of_att_device', label: '附加设备驱动名', wrap: true },
                            { key: 'device_type', label: '设备类型' }
                        ],
                        'bigpools': [
                            { key: 'allocation', label: '分配地址', monospace: true },
                            { key: 'tag', label: '标签', monospace: true },
                            { key: 'pool_type', label: '池类型' },
                            { key: 'number_of_bytes', label: '字节数', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'skeleton_key_check': [
                            { key: 'status', label: '状态' },
                            { key: 'message', label: '消息', wrap: true }
                        ],
                        'suspicious_threads': [
                            { key: 'process', label: '进程' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'tid', label: 'TID', monospace: true },
                            { key: 'context', label: '上下文' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'vad_path', label: 'VAD路径', wrap: true },
                            { key: 'note', label: '备注', wrap: true }
                        ],
                        'truecrypt': [
                            { key: 'type', label: '类型' },
                            { key: 'password', label: '密码', monospace: true }
                        ],
                        'userassist': [
                            { key: 'hive_offset', label: '配置单元偏移', monospace: true },
                            { key: 'hive_name', label: '配置单元', width: 200 },
                            { key: 'path', label: '路径', width: 400 },
                            { key: 'last_write_time', label: '最后写入时间' },
                            { key: 'type', label: '类型' },
                            { key: 'name', label: '名称', width: 300 },
                            { key: 'id', label: 'ID' },
                            { key: 'count', label: '计数', monospace: true },
                            { key: 'focus_count', label: '焦点计数', monospace: true },
                            { key: 'time_focused', label: '焦点时间' },
                            { key: 'last_updated', label: '最后更新' },
                            { key: 'raw_data', label: '原始数据', monospace: true }
                        ],
                        'scheduled_tasks': [
                            { key: 'task_name', label: '任务名称', width: 200 },
                            { key: 'principal_id', label: '主体ID', width: 100 },
                            { key: 'display_name', label: '显示名称', width: 200 },
                            { key: 'enabled', label: '已启用', width: 80 },
                            { key: 'creation_time', label: '创建时间', width: 180 },
                            { key: 'last_run_time', label: '最后运行时间', width: 180 },
                            { key: 'last_successful_run_time', label: '最后成功运行时间', width: 180 },
                            { key: 'trigger_type', label: '触发器类型', width: 100 },
                            { key: 'trigger_description', label: '触发器描述', width: 400 },
                            { key: 'action_type', label: '操作类型', width: 100 },
                            { key: 'action', label: '操作', width: 200 },
                            { key: 'action_arguments', label: '操作参数', width: 200 },
                            { key: 'action_context', label: '操作上下文', width: 150 },
                            { key: 'working_directory', label: '工作目录', width: 300 },
                            { key: 'key_name', label: '键名', width: 300, monospace: true }
                        ],
                        'amcache': [
                            { key: 'entry_type', label: '条目类型', width: 100 },
                            { key: 'path', label: '路径', width: 350 },
                            { key: 'company', label: '公司', width: 200 },
                            { key: 'last_modify_time', label: '最后修改时间', width: 180 },
                            { key: 'last_modify_time2', label: '最后修改时间2', width: 180 },
                            { key: 'install_time', label: '安装时间', width: 180 },
                            { key: 'compile_time', label: '编译时间', width: 180 },
                            { key: 'sha1', label: 'SHA1', width: 280, monospace: true },
                            { key: 'service', label: '服务', width: 150 },
                            { key: 'product_name', label: '产品名称', width: 200 },
                            { key: 'product_version', label: '产品版本', width: 120 }
                        ],
                        // Linux 插件列定义
                        'linux_pslist': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'uid', label: 'UID', monospace: true },
                            { key: 'gid', label: 'GID', monospace: true },
                            { key: 'start_time', label: '启动时间' }
                        ],
                        'linux_bash': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'time', label: '时间' },
                            { key: 'command', label: '命令', wrap: true }
                        ],
                        'linux_envars': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'comm', label: '进程' },
                            { key: 'key', label: '变量名' },
                            { key: 'value', label: '值', wrap: true }
                        ],
                        'linux_elfs': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'start', label: '起始地址', monospace: true },
                            { key: 'end', label: '结束地址', monospace: true },
                            { key: 'file_path', label: '文件路径', wrap: true }
                        ],
                        'linux_lsof': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'tid', label: 'TID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'fd', label: 'FD', monospace: true },
                            { key: 'path', label: '路径', width: 400, wrap: true },
                            { key: 'device', label: '设备' },
                            { key: 'inode', label: 'Inode', monospace: true },
                            { key: 'file_type', label: '类型' },
                            { key: 'mode', label: '模式', monospace: true },
                            { key: 'changed', label: '更改时间', width: 160 },
                            { key: 'modified', label: '修改时间', width: 160 },
                            { key: 'accessed', label: '访问时间', width: 160 },
                            { key: 'size', label: '大小', monospace: true }
                        ],
                        'linux_malfind': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'start', label: '起始地址', monospace: true },
                            { key: 'end', label: '结束地址', monospace: true },
                            { key: 'protection', label: '保护', monospace: true },
                            { key: 'permissions', label: '权限', monospace: true },
                            { key: 'constant', label: '常量', monospace: true },
                            { key: 'mapping', label: '映射' }
                        ],
                        'linux_malware_malfind': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'start', label: '起始地址', monospace: true },
                            { key: 'end', label: '结束地址', monospace: true },
                            { key: 'protection', label: '保护', monospace: true },
                            { key: 'permissions', label: '权限', monospace: true },
                            { key: 'constant', label: '常量', monospace: true },
                            { key: 'mapping', label: '映射' }
                        ],
                        'linux_pstree': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'ppid', label: 'PPID', monospace: true }
                        ],
                        'linux_netstat': [
                            { key: 'netns', label: 'NetNS', monospace: true },
                            { key: 'process_name', label: '进程' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'proto', label: '协议' },
                            { key: 'source_addr', label: '本地地址', monospace: true },
                            { key: 'source_port', label: '本地端口', monospace: true },
                            { key: 'dest_addr', label: '远程地址', monospace: true },
                            { key: 'dest_port', label: '远程端口', monospace: true },
                            { key: 'state', label: '状态' }
                        ],
                        'netstat': [
                            { key: 'protocol', label: '协议' },
                            { key: 'local_address', label: '本地地址', monospace: true },
                            { key: 'local_port', label: '本地端口', monospace: true },
                            { key: 'foreign_address', label: '远程地址', monospace: true },
                            { key: 'foreign_port', label: '远程端口', monospace: true },
                            { key: 'state', label: '状态' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process_name', label: '进程' }
                        ],
                        // macOS 插件列定义
                        'mac_pslist': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'uid', label: 'UID', monospace: true },
                            { key: 'gid', label: 'GID', monospace: true },
                            { key: 'start_time', label: '启动时间' }
                        ],
                        'mac_pstree': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' }
                        ],
                        'mac_bash': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'command_time', label: '命令时间' },
                            { key: 'command', label: '命令', wrap: true }
                        ],
                        'mac_netstat': [
                            { key: 'protocol', label: '协议' },
                            { key: 'local_address', label: '本地地址', monospace: true },
                            { key: 'local_port', label: '本地端口', monospace: true },
                            { key: 'remote_address', label: '远程地址', monospace: true },
                            { key: 'remote_port', label: '远程端口', monospace: true },
                            { key: 'state', label: '状态' }
                        ],
                        'mac_malfind': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'start', label: '起始地址', monospace: true },
                            { key: 'end', label: '结束地址', monospace: true },
                            { key: 'protection', label: '保护', monospace: true },
                            { key: 'hexdump', label: '十六进制', monospace: true },
                            { key: 'disasm', label: '反汇编', monospace: true }
                        ],
                        // Linux 新增插件
                        'linux_psscan': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'tid', label: 'TID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'exit_state', label: '退出状态', monospace: true }
                        ],
                        'linux_psaux': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'ppid', label: 'PPID', monospace: true },
                            { key: 'comm', label: '进程名' },
                            { key: 'args', label: '命令行参数', wrap: true }
                        ],
                        'linux_sockstat': [
                            { key: 'netns', label: 'NetNS', monospace: true },
                            { key: 'process_name', label: '进程' },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'proto', label: '协议' },
                            { key: 'source_addr', label: '本地地址', monospace: true },
                            { key: 'source_port', label: '本地端口', monospace: true },
                            { key: 'dest_addr', label: '远程地址', monospace: true },
                            { key: 'dest_port', label: '远程端口', monospace: true },
                            { key: 'state', label: '状态' }
                        ],
                        'linux_ip_addr': [
                            { key: 'netns', label: 'NetNS', monospace: true },
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'interface', label: '接口' },
                            { key: 'mac', label: 'MAC地址', monospace: true },
                            { key: 'promiscuous', label: '混杂模式' },
                            { key: 'ip', label: 'IP地址', monospace: true },
                            { key: 'prefix', label: '前缀', monospace: true },
                            { key: 'scope_type', label: '作用域' },
                            { key: 'type', label: '类型' },
                            { key: 'state', label: '状态' }
                        ],
                        'linux_ip_link': [
                            { key: 'interface', label: '接口' },
                            { key: 'mac', label: 'MAC地址', monospace: true },
                            { key: 'state', label: '状态' },
                            { key: 'mtu', label: 'MTU', monospace: true },
                            { key: 'qdisc', label: '队列规则' }
                        ],
                        'linux_pagecache_files': [
                            { key: 'file_path', label: '文件路径', width: 300, wrap: true },
                            { key: 'file_type', label: '类型', width: 100 },
                            { key: 'inode_size', label: '大小', monospace: true },
                            { key: 'file_mode', label: '权限', monospace: true, width: 100 },
                            { key: 'mountpoint', label: '挂载点', width: 120 },
                            { key: 'access_time', label: '访问时间', width: 140 },
                            { key: 'modification_time', label: '修改时间', width: 140 },
                            { key: 'change_time', label: '更改时间', width: 140 }
                        ],
                        'linux_mountinfo': [
                            { key: 'mount_id', label: '挂载ID', monospace: true },
                            { key: 'parent_id', label: '父ID', monospace: true },
                            { key: 'major_minor', label: '主:次设备号', monospace: true },
                            { key: 'root', label: '根' },
                            { key: 'mount_point', label: '挂载点', width: 300 },
                            { key: 'options', label: '挂载选项', width: 200 },
                            { key: 'optional_fields', label: '可选字段' },
                            { key: 'separator', label: '分隔符' },
                            { key: 'filesystem_type', label: '文件系统类型' },
                            { key: 'mount_source', label: '挂载源', width: 200 },
                            { key: 'super_options', label: '超级块选项', width: 200 }
                        ],
                        'linux_maps': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'start', label: '起始', monospace: true },
                            { key: 'end', label: '结束', monospace: true },
                            { key: 'permissions', label: '权限', monospace: true },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '文件路径', wrap: true }
                        ],
                        'linux_capabilities': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'name', label: '进程名' },
                            { key: 'capabilities', label: '能力', monospace: true }
                        ],
                        'linux_check_afinfo': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'family', label: '协议族' },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_check_afinfo': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'family', label: '协议族' },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_check_creds': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'issue', label: '问题' }
                        ],
                        'linux_malware_check_creds': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'issue', label: '问题' }
                        ],
                        'linux_check_idt': [
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'expected', label: '期望', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_check_idt': [
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'expected', label: '期望', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_check_modules': [
                            { key: 'name', label: '模块名' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_check_modules': [
                            { key: 'name', label: '模块名' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_check_syscall': [
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_check_syscall': [
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_iomem': [
                            { key: 'start', label: '起始', monospace: true },
                            { key: 'end', label: '结束', monospace: true },
                            { key: 'description', label: '描述' }
                        ],
                        'linux_keyboard_notifiers': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'callback', label: '回调', monospace: true }
                        ],
                        'linux_malware_keyboard_notifiers': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'callback', label: '回调', monospace: true }
                        ],
                        'linux_kmsg': [
                            { key: 'timestamp', label: '时间戳' },
                            { key: 'message', label: '消息' }
                        ],
                        'linux_lsmod': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '模块名', width: 150 },
                            { key: 'code_size', label: '代码大小', monospace: true },
                            { key: 'taints', label: '污染标记', width: 250 },
                            { key: 'load_arguments', label: '加载参数', width: 400 },
                            { key: 'file_output', label: '文件输出', width: 100 }
                        ],
                        'linux_tty_check': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'tty', label: 'TTY', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_tty_check': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'tty', label: 'TTY', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_hidden_modules': [
                            { key: 'name', label: '模块名' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'size', label: '大小', monospace: true }
                        ],
                        'linux_malware_netfilter': [
                            { key: 'hook', label: '挂钩点' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'function', label: '函数' },
                            { key: 'status', label: '状态' }
                        ],
                        'linux_malware_modxview': [
                            { key: 'name', label: '模块名', width: 150 },
                            { key: 'address', label: '地址', monospace: true },
                            { key: 'in_procfs', label: 'In procfs', width: 100 },
                            { key: 'in_sysfs', label: 'In sysfs', width: 100 },
                            { key: 'in_scan', label: 'In scan', width: 100 },
                            { key: 'taints', label: '污染标记', width: 250 }
                        ],
                        'linux_vmayarascan': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'rule', label: '规则' },
                            { key: 'matches', label: '匹配数', monospace: true }
                        ],
                        // macOS 新增插件
                        'mac_psaux': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程名' },
                            { key: 'argc', label: '参数数量', monospace: true },
                            { key: 'arguments', label: '参数', wrap: true }
                        ],
                        'mac_ifconfig': [
                            { key: 'interface', label: '接口' },
                            { key: 'mac_address', label: 'MAC地址', monospace: true },
                            { key: 'ip_address', label: 'IP地址', monospace: true },
                            { key: 'status', label: '状态' }
                        ],
                        'mac_lsof': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'fd', label: 'FD', monospace: true },
                            { key: 'file_path', label: '文件路径', wrap: true }
                        ],
                        'mac_list_files': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'path', label: '路径', wrap: true }
                        ],
                        'mac_mount': [
                            { key: 'device', label: '设备', wrap: true },
                            { key: 'mount_point', label: '挂载点', wrap: true },
                            { key: 'type', label: '类型' }
                        ],
                        'mac_maps': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程' },
                            { key: 'start', label: '起始', monospace: true },
                            { key: 'end', label: '结束', monospace: true },
                            { key: 'permissions', label: '权限', monospace: true },
                            { key: 'map_name', label: '映射名', wrap: true },
                            { key: 'file_output', label: '文件输出', monospace: true }
                        ],
                        'mac_check_syscall': [
                            { key: 'table_address', label: '表地址', monospace: true },
                            { key: 'table_name', label: '表名', wrap: true },
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'handler_address', label: '处理器地址', monospace: true },
                            { key: 'handler_module', label: '处理器模块', wrap: true },
                            { key: 'handler_symbol', label: '处理器符号' }
                        ],
                        'mac_check_sysctl': [
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'number', label: '编号', monospace: true },
                            { key: 'perms', label: '权限', monospace: true },
                            { key: 'handler_address', label: '处理器地址', monospace: true },
                            { key: 'value', label: '值', monospace: true },
                            { key: 'handler_module', label: '处理器模块', wrap: true },
                            { key: 'handler_symbol', label: '处理器符号' }
                        ],
                        'mac_check_trap_table': [
                            { key: 'table_address', label: '表地址', monospace: true },
                            { key: 'table_name', label: '表名', wrap: true },
                            { key: 'index', label: '索引', monospace: true },
                            { key: 'handler_address', label: '处理器地址', monospace: true },
                            { key: 'handler_module', label: '处理器模块', wrap: true },
                            { key: 'handler_symbol', label: '处理器符号' }
                        ],
                        'mac_dmesg': [
                            { key: 'line', label: '消息', wrap: true }
                        ],
                        'mac_kauth_listeners': [
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'idata', label: 'IData', monospace: true },
                            { key: 'callback_address', label: '回调地址', monospace: true },
                            { key: 'module', label: '模块', wrap: true },
                            { key: 'symbol', label: '符号' }
                        ],
                        'mac_kauth_scopes': [
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'idata', label: 'IData', monospace: true },
                            { key: 'listeners', label: '监听器', monospace: true },
                            { key: 'callback_address', label: '回调地址', monospace: true },
                            { key: 'module', label: '模块', wrap: true },
                            { key: 'symbol', label: '符号' }
                        ],
                        'mac_kevents': [
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'process', label: '进程', wrap: true },
                            { key: 'ident', label: '标识', monospace: true },
                            { key: 'filter', label: '过滤器', wrap: true },
                            { key: 'context', label: '上下文', monospace: true }
                        ],
                        'mac_lsmod': [
                            { key: 'offset', label: '偏移', monospace: true },
                            { key: 'name', label: '名称' },
                            { key: 'size', label: '大小', monospace: true }
                        ],
                        'mac_socket_filters': [
                            { key: 'filter', label: '过滤器', wrap: true },
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'member', label: '成员', wrap: true },
                            { key: 'socket', label: '套接字', monospace: true },
                            { key: 'handler', label: '处理器', monospace: true },
                            { key: 'module', label: '模块', wrap: true },
                            { key: 'symbol', label: '符号' }
                        ],
                        'mac_timers': [
                            { key: 'function', label: '函数', wrap: true },
                            { key: 'param_0', label: '参数0', monospace: true },
                            { key: 'param_1', label: '参数1', monospace: true },
                            { key: 'deadline', label: '截止时间', monospace: true },
                            { key: 'entry_time', label: '进入时间', monospace: true },
                            { key: 'module', label: '模块', wrap: true },
                            { key: 'symbol', label: '符号' }
                        ],
                        'mac_trustedbsd': [
                            { key: 'member', label: '成员', wrap: true },
                            { key: 'policy_name', label: '策略名称', wrap: true },
                            { key: 'handler_address', label: '处理器地址', monospace: true },
                            { key: 'handler_module', label: '处理器模块', wrap: true },
                            { key: 'handler_symbol', label: '处理器符号' }
                        ],
                        'mac_vfsevents': [
                            { key: 'name', label: '名称', wrap: true },
                            { key: 'pid', label: 'PID', monospace: true },
                            { key: 'events', label: '事件', monospace: true }
                        ]
                    };

                    return columnMap[pluginId] || [];
                }

                getPluginDisplayName(pluginId) {
                    const names = {
                        // Windows 插件
                        'pslist': '进程列表',
                        'pstree': '进程树',
                        'psscan': '进程扫描',
                        'dlllist': 'DLL列表',
                        'handles': '句柄列表',
                        'cmdline': '命令行参数',
                        'envars': '环境变量',
                        'getsids': '安全标识符(SIDs)',
                        'netscan': '网络连接',
                        'netstat': '网络连接(Netstat)',
                        'svcscan': '服务扫描',
                        'filescan': '文件扫描',
                        'hivelist': '注册表配置单元',
                        'printkey': '注册表键值',
                        'certificates': '证书列表',
                        'malfind': '恶意代码查找',
                        'hashdump': '密码哈希',
                        'lsadump': 'LSA密钥',
                        'cachedump': '域缓存凭据',
                        // Windows 新增插件
                        'cmdscan': 'CMD命令历史',
                        'consoles': '控制台历史',
                        'psxview': '进程隐藏检测',
                        'ldrmodules': 'DLL隐藏检测',
                        'callbacks': '回调检测',
                        'privileges': '进程权限',
                        'sessions': '会话信息',
                        'threads': '线程信息',
                        'vadinfo': '内存区域',
                        'mutantscan': '互斥体扫描',
                        'modscan': '模块扫描',
                        'ssdt': '系统调用表',
                        'driverscan': '驱动扫描',
                        'drivermodule': '驱动模块检测',
                        'driverirp': '驱动IRP',
                        // Windows 恶意软件检测（新版本）
                        'hollowprocesses': '空心进程',
                        'svcdiff': '服务差异检测',
                        'unhooked_system_calls': '系统调用检测',
                        'processghosting': '进程幽灵检测',
                        'malware_psxview': '进程隐藏检测(PsXView)',
                        'pebmasquerade': 'PEB伪装检测',
                        'shimcachemem': 'Shim缓存',
                        'mftscan': 'MFT扫描',
                        'mbrscan': 'MBR扫描',
                        'crashinfo': '崩溃信息',
                        'deskscan': '桌面扫描',
                        'desktops': '桌面信息',
                        'devicetree': '设备树',
                        'bigpools': '内存池',
                        'skeleton_key_check': 'Skeleton Key检测',
                        'suspicious_threads': '可疑线程',
                        'truecrypt': 'TrueCrypt密码',
                        'userassist': 'UserAssist',
                        'scheduled_tasks': '计划任务',
                        'amcache': 'AmCache',
                        // Linux 插件
                        'linux_pslist': '进程列表',
                        'linux_pstree': '进程树',
                        'linux_bash': 'Bash历史',
                        'linux_envars': '环境变量',
                        'linux_elfs': 'ELF文件',
                        'linux_dumpfiles': '页缓存文件',
                        'linux_lsof': '打开文件',
                        'linux_netstat': '网络连接',
                        'linux_malfind': '恶意代码查找',
                        // macOS 插件
                        'mac_pslist': '进程列表',
                        'mac_pstree': '进程树',
                        'mac_bash': 'Shell历史',
                        'mac_netstat': '网络连接',
                        'mac_malfind': '恶意代码查找',
                        // Linux 新增插件
                        'linux_psscan': '进程扫描',
                        'linux_psaux': '进程详情',
                        'linux_sockstat': '进程网络连接',
                        'linux_mountinfo': '挂载信息',
                        'linux_maps': '内存映射',
                        'linux_capabilities': '进程能力',
                        'linux_check_afinfo': '协议族检查',
                        'linux_check_creds': '凭据检查',
                        'linux_check_idt': 'IDT检查',
                        'linux_check_modules': '内核模块检查',
                        'linux_check_syscall': '系统调用检查',
                        'linux_iomem': 'I/O内存',
                        'linux_keyboard_notifiers': '键盘通知器',
                        'linux_kmsg': '内核消息',
                        'linux_lsmod': '内核模块',
                        'linux_tty_check': 'TTY检查',
                        'linux_vmayarascan': 'Yara扫描',
                        // macOS 新增插件
                        'mac_psaux': '进程详情',
                        'mac_ifconfig': '网络接口',
                        'mac_lsof': '打开文件',
                        'mac_list_files': '文件列表',
                        'mac_mount': '挂载信息',
                        'mac_maps': '内存映射',
                        'mac_check_syscall': '系统调用检查',
                        'mac_check_sysctl': 'Sysctl检查',
                        'mac_check_trap_table': '陷阱表检查',
                        'mac_dmesg': '内核消息',
                        'mac_kauth_listeners': 'Kauth监听器',
                        'mac_kauth_scopes': 'Kauth作用域',
                        'mac_kevents': '内核事件',
                        'mac_lsmod': '内核模块',
                        'mac_socket_filters': '套接字过滤器',
                        'mac_timers': '定时器',
                        'mac_trustedbsd': 'TrustedBSD',
                        'mac_vfsevents': 'VFS事件'
                    };
                    return names[pluginId] || pluginId.toUpperCase();
                }

                setActivePlugin(pluginId) {
                    // 设置当前活动的插件ID
                    this.activePlugin = pluginId;

                    document.querySelectorAll('.sidebar-btn[data-plugin]').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.plugin === pluginId) {
                            btn.classList.add('active');
                        }
                    });

                    // 清空搜索框和搜索条件
                    const tableSearch = document.getElementById('tableSearch');
                    if (tableSearch) {
                        tableSearch.value = '';
                    }
                    this.searchTerm = '';
                    this.filters = [];
                    this.currentPage = 1;
                    this.sortColumn = null;
                    this.sortDirection = 'asc';
                }

                setSystemStatus(text, type) {
                    const dot = document.getElementById('systemStatusDot');
                    const statusText = document.getElementById('systemStatusText');

                    if (dot) {
                        dot.className = 'status-dot';
                        if (type !== 'normal') dot.classList.add(type);
                    }
                    if (statusText) statusText.textContent = text;
                }

                showLoading(text) {
                    const loadingText = document.getElementById('loadingText');
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if (loadingText) loadingText.textContent = text;
                    if (loadingOverlay) loadingOverlay.classList.remove('hidden');
                }

                hideLoading() {
                    const loadingOverlay = document.getElementById('loadingOverlay');
                    if (loadingOverlay) loadingOverlay.classList.add('hidden');
                }

                // ==================== Volatility 3 检测和安装 ====================

                async checkVolatility3() {
                    if (!this.api) return true; // 演示模式，不需要检测

                    try {
                        const result = await this.api.check_volatility3();
                        if (result.status === 'success' && result.data.installed) {
                            return true;
                        } else {
                            // 显示安装提示对话框，传入检测结果
                            this.showVolatility3InstallDialog(result.data || {});
                            return false;
                        }
                    } catch (error) {
                        console.error('检测 Volatility 3 失败:', error);
                        // 检测失败时也显示安装提示
                        this.showVolatility3InstallDialog({});
                        return false;
                    }
                }

                showVolatility3InstallDialog(detectionResult = {}) {
                    const platform = detectionResult.platform || 'Unknown';
                    const installCommand = detectionResult.install_command || 'pip install volatility3';

                    // 根据平台获取安装说明
                    let platformNote = '';
                    if (platform === 'Windows') {
                        platformNote = 'Windows 系统将使用 pip 安装 Volatility 3。';
                    } else if (platform === 'Darwin') {
                        platformNote = 'macOS 系统将使用 pip3 安装 Volatility 3。';
                    } else if (platform === 'Linux') {
                        platformNote = 'Linux 系统将使用 pip3 --user 安装 Volatility 3。';
                    }

                    const overlay = document.createElement('div');
                    overlay.className = 'vol3-install-overlay';
                    overlay.innerHTML = `
                        <div class="vol3-install-dialog">
                            <div class="vol3-install-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <h2>需要安装 Volatility 3</h2>
                            <p>析镜需要 Volatility 3 框架来进行内存分析。</p>
                            <p class="vol3-install-note">${platformNote}</p>
                            <div class="vol3-install-actions">
                                <button class="vol3-install-btn" id="installVol3Btn">
                                    <span>一键安装</span>
                                </button>
                                <button class="vol3-install-btn secondary" id="closeVol3Dialog">
                                    稍后安装
                                </button>
                            </div>
                            <p class="vol3-install-hint">手动安装命令：<code>${installCommand}</code></p>
                        </div>
                    `;
                    document.body.appendChild(overlay);

                    // 绑定事件
                    document.getElementById('installVol3Btn').addEventListener('click', () => {
                        this.installVolatility3();
                    });
                    document.getElementById('closeVol3Dialog').addEventListener('click', () => {
                        overlay.remove();
                    });
                }

                async installVolatility3() {
                    if (!this.api) return;

                    const btn = document.getElementById('installVol3Btn');
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '<span class="installing">安装中...</span>';
                    }

                    try {
                        const result = await this.api.install_volatility3();
                        if (result.status === 'success') {
                            // 安装成功，移除对话框
                            const overlay = document.querySelector('.vol3-install-overlay');
                            if (overlay) overlay.remove();

                            // 显示成功提示
                            this.showToast('success', '安装成功', result.message);
                            this.setSystemStatus('Volatility 3 就绪', 'active');
                        } else {
                            // 安装失败
                            if (btn) {
                                btn.disabled = false;
                                btn.innerHTML = '<span>重试安装</span>';
                            }
                            this.showToast('error', '安装失败', result.message);
                        }
                    } catch (error) {
                        console.error('安装 Volatility 3 失败:', error);
                        if (btn) {
                            btn.disabled = false;
                            btn.innerHTML = '<span>重试安装</span>';
                        }
                        this.showToast('error', '安装失败', String(error));
                    }
                }

                _showLoadingToast(message) {
                    const container = document.getElementById('toastContainer');
                    if (!container) return null;

                    const toast = document.createElement('div');
                    toast.className = 'toast loading-toast';
                    toast.innerHTML = `
                        <div class="toast-icon info">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin">
                                <circle cx="12" cy="12" r="10" stroke-dasharray="32" stroke-dashoffset="8"/>
                            </svg>
                        </div>
                        <div class="toast-content">
                            <div class="toast-title">处理中</div>
                            <div class="toast-message">${message}</div>
                        </div>
                    `;

                    container.appendChild(toast);
                    return toast;
                }

                _hideLoadingToast(toast) {
                    if (toast) {
                        toast.classList.add('removing');
                        setTimeout(() => toast.remove(), 300);
                    }
                }

                toast(type, title, message) {
                    const container = document.getElementById('toastContainer');
                    if (!container) return;

                    const icons = {
                        success: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>',
                        error: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
                        warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
                        info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'
                    };

                    const toast = document.createElement('div');
                    toast.className = 'toast';
                    toast.innerHTML = `
                        <div class="toast-icon ${type}">${icons[type]}</div>
                        <div class="toast-content">
                            <div class="toast-title">${title}</div>
                            <div class="toast-message">${message}</div>
                        </div>
                        <button class="toast-close">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    `;

                    container.appendChild(toast);

                    toast.querySelector('.toast-close').addEventListener('click', () => {
                        toast.classList.add('removing');
                        setTimeout(() => toast.remove(), 300);
                    });

                    setTimeout(() => {
                        toast.classList.add('removing');
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                }

                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                formatSize(bytes) {
                    if (!bytes || bytes === 0) return '0 B';
                    const k = 1024;
                    const sizes = ['B', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }
            }

            // 初始化应用
            const app = new ForensicsApp();
            window.app = app;
            window.forensicsApp = app;  // 暴露给 HTML 中的 onclick 使用

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => app.init());
            } else {
                app.init();
            }

            // 暴露 Components 和 Utils
            window.Components = {
                modal: (options) => {
                },
                confirm: (options) => {
                    return Promise.resolve(false);
                },
                prompt: (options) => {
                    return Promise.resolve(null);
                }
            };
            window.Utils = {
                formatTime: (ts) => '-',
                formatSize: (bytes) => bytes ? bytes + ' B' : '0 B',
                escapeHtml: (text) => String(text),
                delay: (ms) => new Promise(r => setTimeout(r, ms))
            };
        })();
    </script>
</body>
</html>
